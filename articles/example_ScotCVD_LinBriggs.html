<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Lin and Briggs (2025) Scottish CVD DES using WARDEN • WARDEN</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Lin and Briggs (2025) Scottish CVD DES using WARDEN">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZEDNGW5QRP"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ZEDNGW5QRP');
</script><!-- Google tag (gtag.js) -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">WARDEN</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="View Index"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Core Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/warden_explained.html">Warden Explained</a></li>
    <li><a class="dropdown-item" href="../articles/example_ssd.html">Sick-Sicker-Dead Model (SSD)</a></li>
    <li><a class="dropdown-item" href="../articles/example_ssd_constrained.html">Resource Constrained SSD model</a></li>
    <li><a class="dropdown-item" href="../articles/inputs_selector.html">How to Use the Automatic Input Selector</a></li>
    <li><a class="dropdown-item" href="../articles/example_eBC.html">Early Breast Cancer</a></li>
    <li><a class="dropdown-item" href="../articles/example_ipd.html">Using Individual Patient Data</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other Tutorials and Best Practices</h6></li>
    <li><a class="dropdown-item" href="../articles/example_markov.html">Cohort Markov Model</a></li>
    <li><a class="dropdown-item" href="../articles/example_avoiding_cycles.html">How to Avoid Using Cycles to Speed Up Model</a></li>
    <li><a class="dropdown-item" href="../articles/example_uncertainty.html">Structural and Parametric Uncertainty</a></li>
    <li><a class="dropdown-item" href="../articles/example_ssd_stream.html">Random Number Streams &amp; Luck Adjustment (SSD model)</a></li>
    <li><a class="dropdown-item" href="../articles/example_ssd_sobol.html">Quasi-Random Sobol Sequence vs. Purely Random (SSD model)</a></li>
    <li><a class="dropdown-item" href="../articles/example_colon_degeling.html">Degeling (2025) using WARDEN instead of simmer</a></li>
    <li><a class="dropdown-item" href="../articles/example_ScotCVD_LinBriggs.html">Lin and Briggs (2025) Scottish CVD DES using WARDEN'</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jsanchezalv/WARDEN" aria-label="View on Github"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="example_ScotCVD_LinBriggs_files/kePrint-0.0.1/kePrint.js"></script><link href="example_ScotCVD_LinBriggs_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Lin and Briggs (2025) Scottish CVD DES using WARDEN</h1>
                        <h4 data-toc-skip class="author">Javier Sanchez
Alvarez</h4>
            
            <h4 data-toc-skip class="date">February 27, 2026</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jsanchezalv/WARDEN/blob/main/vignettes/articles/example_ScotCVD_LinBriggs.Rmd" class="external-link"><code>vignettes/articles/example_ScotCVD_LinBriggs.Rmd</code></a></small>
      <div class="d-none name"><code>example_ScotCVD_LinBriggs.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document makes use of the code provided by <a href="https://link.springer.com/article/10.1007/s40273-025-01560-6" class="external-link">Lin
and Briggs (2025)</a> which use R ad-hoc created functions to translate
an existing Markov Scottish CVD model into a DES model. We showcase how
the same model would be written with WARDEN.</p>
<p>Note that the model used is not resource constrained, so in WARDEN we
would use with the <code>constrained = FALSE</code> argument (which is
FALSE by default).</p>
<div class="section level3">
<h3 id="main-options">Main options<a class="anchor" aria-label="anchor" href="#main-options"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jsanchezalv.github.io/WARDEN/">WARDEN</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chjackson/flexsurv" class="external-link">flexsurv</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: survival</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'kableExtra'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     group_rows</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"readxl"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Loading required package: readxl</span></span>
<span><span class="co">#&gt; Warning in library(package, lib.loc = lib.loc, character.only = TRUE,</span></span>
<span><span class="co">#&gt; logical.return = TRUE, : there is no package called 'readxl'</span></span>
<span><span class="co">#&gt; Installing package into '/home/runner/work/_temp/Library'</span></span>
<span><span class="co">#&gt; (as 'lib' is unspecified)</span></span>
<span><span class="co">#&gt; also installing the dependencies 'rematch', 'hms', 'prettyunits', 'cellranger', 'cpp11', 'progress'</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"here"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Loading required package: here</span></span>
<span><span class="co">#&gt; Warning in library(package, lib.loc = lib.loc, character.only = TRUE,</span></span>
<span><span class="co">#&gt; logical.return = TRUE, : there is no package called 'here'</span></span>
<span><span class="co">#&gt; Installing package into '/home/runner/work/_temp/Library'</span></span>
<span><span class="co">#&gt; (as 'lib' is unspecified)</span></span>
<span><span class="co">#&gt; here() starts at /home/runner/work/WARDEN/WARDEN</span></span>
<span></span>
<span><span class="co"># Age in year (continuous)</span></span>
<span><span class="co"># Normal distribution</span></span>
<span><span class="va">list_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">60</span>, sd <span class="op">=</span> <span class="fl">0</span>, dist <span class="op">=</span> <span class="st">"rnorm"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Scottish Index of Multiple Deprivation (continuous, range: 0 to 100)</span></span>
<span><span class="co"># Beta distribution</span></span>
<span><span class="va">list_SIMD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">60.8</span>, sd <span class="op">=</span> <span class="fl">15</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">100</span>, dist <span class="op">=</span> <span class="st">"rbeta"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># % of diabetes (proportion, range: from 0 to 1)</span></span>
<span><span class="co"># Bernoulli distribution for each patient</span></span>
<span><span class="va">list_Diabetes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">0</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># % of family history (proportion, range: from 0 to 1)</span></span>
<span><span class="co"># Bernoulli distribution for each patient</span></span>
<span><span class="va">list_FH</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">0</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># No. of cigarette per day (continuous)</span></span>
<span><span class="co"># Gamma distribution</span></span>
<span><span class="va">list_CPD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">20</span>, sd <span class="op">=</span> <span class="fl">0</span>, dist <span class="op">=</span> <span class="st">"rgamma"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Systolic blood pressure (continuous)</span></span>
<span><span class="co"># Normal distribution</span></span>
<span><span class="va">list_SBP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">160</span>, sd <span class="op">=</span> <span class="fl">0</span>, dist <span class="op">=</span> <span class="st">"rnorm"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Total cholesterol (continuous)</span></span>
<span><span class="co"># Normal distribution</span></span>
<span><span class="va">list_TC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">7</span>, sd <span class="op">=</span> <span class="fl">0</span>, dist <span class="op">=</span> <span class="st">"rnorm"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># High density cholesterol (continuous)</span></span>
<span><span class="co"># Normal distribution</span></span>
<span><span class="va">list_HDL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">1</span>, sd <span class="op">=</span> <span class="fl">0</span>, dist <span class="op">=</span> <span class="st">"rnorm"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># % of male (proportion, range: from 0 to 1)</span></span>
<span><span class="co"># Bernoulli distribution for each patient</span></span>
<span><span class="va">list_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">0.5</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># maximum = 100</span></span>
<span><span class="co"># time spline variables for cost models were reported up to t = 100 </span></span>
<span><span class="co"># (Lawson 2016. Appendix. Table A7 A8 A9 A10 A11 A12)</span></span>
<span></span>
<span><span class="va">disc</span> <span class="op">&lt;-</span> <span class="fl">0.035</span> <span class="co"># disc &lt;-0 for undiscounted</span></span>
<span></span>
<span><span class="co"># treatment effects on ldl and hdl</span></span>
<span><span class="va">list_tx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ldleffect <span class="op">=</span> <span class="fl">0.26</span>, </span>
<span>                hdleffect <span class="op">=</span> <span class="fl">1.04</span>, </span>
<span>                cost <span class="op">=</span> <span class="fl">13</span>, </span>
<span>                disu <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">sheet_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/excel_sheets.html" class="external-link">excel_sheets</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"data/CVDparameters.xlsx"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">list_coef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">sheet_names</span><span class="op">)</span>, </span>
<span>                    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"data/CVDparameters.xlsx"</span><span class="op">)</span>, sheet <span class="op">=</span> <span class="va">x</span>, col_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">list_coef</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">sheet_names</span></span>
<span></span>
<span><span class="va">list_coef2</span> <span class="op">&lt;-</span> <span class="va">list_coef</span></span>
<span></span>
<span><span class="va">calib</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>f1 <span class="op">=</span> <span class="fl">0.96</span>,</span>
<span>              multi_m <span class="op">=</span> <span class="fl">0.99</span>,</span>
<span>              multi_f <span class="op">=</span> <span class="fl">1.05</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Constant adjustment</span></span>
<span><span class="va">j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_m</span><span class="op">$</span><span class="va">covariate</span> <span class="op">==</span> <span class="st">"constant"</span><span class="op">)</span></span>
<span><span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_m</span><span class="op">[</span><span class="va">j</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_m</span><span class="op">[</span><span class="va">j</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> </span>
<span>  <span class="va">calib</span><span class="op">$</span><span class="va">multi_m</span></span>
<span><span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_f</span><span class="op">[</span><span class="va">j</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_f</span><span class="op">[</span><span class="va">j</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> </span>
<span>  <span class="va">calib</span><span class="op">$</span><span class="va">multi_f</span></span>
<span></span>
<span><span class="co"># coefficient adjustment for TC and HDL for nonCVDdeath first event for male</span></span>
<span><span class="va">j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_m</span><span class="op">$</span><span class="va">covariate</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TC"</span>, <span class="st">"HDL"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_m</span><span class="op">[</span><span class="va">j</span>, <span class="st">"first_event_nonCVD_death"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># coefficient adjustment for TC CBVD and nonCVDdeath first events for female</span></span>
<span><span class="va">j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_m</span><span class="op">$</span><span class="va">covariate</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"TC"</span><span class="op">)</span></span>
<span><span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_f</span><span class="op">[</span><span class="va">j</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"first_event_nonfatal_CBVD"</span>, <span class="st">"first_event_nonCVD_death"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span></span>
<span><span class="va">list_coef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">list_coef</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">keep</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">list_u_norms</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    u_norms_m <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>      age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;25"</span>, <span class="st">"25-34"</span>, <span class="st">"35-44"</span>, <span class="st">"45-54"</span>, <span class="st">"55-64"</span>, <span class="st">"65-74"</span>, <span class="st">"&gt;74"</span><span class="op">)</span>,</span>
<span>      age_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span>, <span class="fl">35</span>, <span class="fl">45</span>, <span class="fl">55</span>, <span class="fl">65</span>, <span class="fl">75</span><span class="op">)</span>,</span>
<span>      age_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">35</span>, <span class="fl">45</span>, <span class="fl">55</span>, <span class="fl">65</span>, <span class="fl">75</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>      Index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span>
<span>        from <span class="op">=</span> <span class="fl">25</span>, to <span class="op">=</span> <span class="fl">75</span>, by <span class="op">=</span> <span class="fl">10</span></span>
<span>      <span class="op">)</span><span class="op">)</span>,</span>
<span>      utility <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.831</span>, <span class="fl">0.823</span>, <span class="fl">0.820</span>, <span class="fl">0.806</span>, <span class="fl">0.801</span>, <span class="fl">0.788</span>, <span class="fl">0.774</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    u_norms_f <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>      age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;25"</span>, <span class="st">"25-34"</span>, <span class="st">"35-44"</span>, <span class="st">"45-54"</span>, <span class="st">"55-64"</span>, <span class="st">"65-74"</span>, <span class="st">"&gt;74"</span><span class="op">)</span>,</span>
<span>      age_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span>, <span class="fl">35</span>, <span class="fl">45</span>, <span class="fl">55</span>, <span class="fl">65</span>, <span class="fl">75</span><span class="op">)</span>,</span>
<span>      age_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">35</span>, <span class="fl">45</span>, <span class="fl">55</span>, <span class="fl">65</span>, <span class="fl">75</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>      Index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span>
<span>        from <span class="op">=</span> <span class="fl">25</span>, to <span class="op">=</span> <span class="fl">75</span>, by <span class="op">=</span> <span class="fl">10</span></span>
<span>      <span class="op">)</span><span class="op">)</span>,</span>
<span>      utility <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.809</span>, <span class="fl">0.811</span>, <span class="fl">0.802</span>, <span class="fl">0.785</span>, <span class="fl">0.787</span>, <span class="fl">0.777</span>, <span class="fl">0.721</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">list_coef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="va">list_coef</span>, <span class="va">list_u_norms</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">list_u_norms</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#RCS derived coefficients, directly from running the original code</span></span>
<span><span class="va">nl_RCS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  nl_RCS_pre <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    male <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">7</span>, <span class="fl">17</span><span class="op">)</span>,</span>
<span>      coef_a_1j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        `(Intercept)` <span class="op">=</span> <span class="op">-</span><span class="fl">0.0355554000000008</span>,</span>
<span>        C_ti1 <span class="op">=</span> <span class="fl">0.0533331869047627</span>,</span>
<span>        x2 <span class="op">=</span> <span class="op">-</span><span class="fl">0.0266666285714288</span>,</span>
<span>        x3 <span class="op">=</span> <span class="fl">0.00444444166666668</span></span>
<span>      <span class="op">)</span>,</span>
<span>      coef_a_2j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        `(Intercept)` <span class="op">=</span> <span class="fl">2.25111027435915</span>,</span>
<span>        C_ti1 <span class="op">=</span> <span class="op">-</span><span class="fl">0.926666325718771</span>,</span>
<span>        x2 <span class="op">=</span> <span class="fl">0.113333293706297</span>,</span>
<span>        x3 <span class="op">=</span> <span class="op">-</span><span class="fl">0.002222220901321</span></span>
<span>      <span class="op">)</span>,</span>
<span>      coef_a_3j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`(Intercept)` <span class="op">=</span> <span class="op">-</span><span class="fl">8.66666405454546</span>,</span>
<span>                    C_ti1 <span class="op">=</span> <span class="fl">0.999999754545455</span><span class="op">)</span>,</span>
<span>      r2_check <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.999999999999985</span>, <span class="fl">0.999999999999987</span>,</span>
<span>                   <span class="fl">0.999999999999926</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    female <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">8</span>, <span class="fl">17</span><span class="op">)</span>,</span>
<span>      coef_a_1j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        `(Intercept)` <span class="op">=</span> <span class="op">-</span><span class="fl">0.0355553999999988</span>,</span>
<span>        C_ti1 <span class="op">=</span> <span class="fl">0.0533331869047611</span>,</span>
<span>        x2 <span class="op">=</span> <span class="op">-</span><span class="fl">0.0266666285714284</span>,</span>
<span>        x3 <span class="op">=</span> <span class="fl">0.00444444166666666</span></span>
<span>      <span class="op">)</span>,</span>
<span>      coef_a_2j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        `(Intercept)` <span class="op">=</span> <span class="fl">3.75704726107239</span>,</span>
<span>        C_ti1 <span class="op">=</span> <span class="op">-</span><span class="fl">1.3688915683761</span>,</span>
<span>        x2 <span class="op">=</span> <span class="fl">0.151111334498837</span>,</span>
<span>        x3 <span class="op">=</span> <span class="op">-</span><span class="fl">0.00296296891996898</span></span>
<span>      <span class="op">)</span>,</span>
<span>      coef_a_3j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`(Intercept)` <span class="op">=</span> <span class="op">-</span><span class="fl">10.8</span>,</span>
<span>                    C_ti1 <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span>,</span>
<span>      r2_check <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.999999999999995</span>, <span class="fl">0.999999999999996</span>,</span>
<span>                   <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nl_RCS_postCHD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    male <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">14</span><span class="op">)</span>,</span>
<span>      coef_a_1j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        `(Intercept)` <span class="op">=</span> <span class="op">-</span><span class="fl">0.00591723333333363</span>,</span>
<span>        C_ti1 <span class="op">=</span> <span class="fl">0.0177515847883601</span>,</span>
<span>        x2 <span class="op">=</span> <span class="op">-</span><span class="fl">0.0177515103174604</span>,</span>
<span>        x3 <span class="op">=</span> <span class="fl">0.00591716203703705</span></span>
<span>      <span class="op">)</span>,</span>
<span>      coef_a_2j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        `(Intercept)` <span class="op">=</span> <span class="fl">2.07101078181822</span>,</span>
<span>        C_ti1 <span class="op">=</span> <span class="op">-</span><span class="fl">1.02071181916788</span>,</span>
<span>        x2 <span class="op">=</span> <span class="fl">0.155325643795095</span>,</span>
<span>        x3 <span class="op">=</span> <span class="op">-</span><span class="fl">0.00369823198653204</span></span>
<span>      <span class="op">)</span>,</span>
<span>      coef_a_3j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`(Intercept)` <span class="op">=</span> <span class="op">-</span><span class="fl">8.07693209999999</span>, C_ti1 <span class="op">=</span> <span class="fl">1.15384662727273</span><span class="op">)</span>,</span>
<span>      r2_check <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.999999999999999</span>, <span class="fl">0.999999999999992</span>, <span class="fl">0.999999999999465</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    female <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">12</span><span class="op">)</span>,</span>
<span>      coef_a_1j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        `(Intercept)` <span class="op">=</span> <span class="op">-</span><span class="fl">0.00826453999999968</span>,</span>
<span>        C_ti1 <span class="op">=</span> <span class="fl">0.0247935047619046</span>,</span>
<span>        x2 <span class="op">=</span> <span class="op">-</span><span class="fl">0.0247934285714285</span>,</span>
<span>        x3 <span class="op">=</span> <span class="fl">0.00826446666666666</span></span>
<span>      <span class="op">)</span>,</span>
<span>      coef_a_2j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        `(Intercept)` <span class="op">=</span> <span class="fl">1.61511016623365</span>,</span>
<span>        C_ti1 <span class="op">=</span> <span class="op">-</span><span class="fl">0.949231624530986</span>,</span>
<span>        x2 <span class="op">=</span> <span class="fl">0.170011662337658</span>,</span>
<span>        x3 <span class="op">=</span> <span class="op">-</span><span class="fl">0.00472254343434329</span></span>
<span>      <span class="op">)</span>,</span>
<span>      coef_a_3j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`(Intercept)` <span class="op">=</span> <span class="op">-</span><span class="fl">6.54546038181818</span>,</span>
<span>                    C_ti1 <span class="op">=</span> <span class="fl">1.09090950909091</span><span class="op">)</span>,</span>
<span>      r2_check <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.999999999999997</span>, <span class="fl">0.999999999999993</span>,</span>
<span>                   <span class="fl">0.999999999999926</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nl_RCS_postCBVD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    male <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,</span>
<span>                <span class="fl">5</span>, <span class="fl">12</span><span class="op">)</span>,</span>
<span>      coef_a_1j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        `(Intercept)` <span class="op">=</span> <span class="op">-</span><span class="fl">0.00826453999999968</span>,</span>
<span>        C_ti1 <span class="op">=</span> <span class="fl">0.0247935047619046</span>,</span>
<span>        x2 <span class="op">=</span> <span class="op">-</span><span class="fl">0.0247934285714285</span>,</span>
<span>        x3 <span class="op">=</span> <span class="fl">0.00826446666666666</span></span>
<span>      <span class="op">)</span>,</span>
<span>      coef_a_2j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        `(Intercept)` <span class="op">=</span> <span class="fl">1.61511016623365</span>,</span>
<span>        C_ti1 <span class="op">=</span> <span class="op">-</span><span class="fl">0.949231624530986</span>,</span>
<span>        x2 <span class="op">=</span> <span class="fl">0.170011662337658</span>,</span>
<span>        x3 <span class="op">=</span> <span class="op">-</span><span class="fl">0.00472254343434329</span></span>
<span>      <span class="op">)</span>,</span>
<span>      coef_a_3j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`(Intercept)` <span class="op">=</span> <span class="op">-</span><span class="fl">6.54546038181818</span>, C_ti1 <span class="op">=</span> <span class="fl">1.09090950909091</span><span class="op">)</span>,</span>
<span>      r2_check <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.999999999999997</span>, <span class="fl">0.999999999999993</span>, <span class="fl">0.999999999999926</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    female <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">12</span><span class="op">)</span>,</span>
<span>      coef_a_1j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        `(Intercept)` <span class="op">=</span> <span class="op">-</span><span class="fl">0.00826453999999968</span>,</span>
<span>        C_ti1 <span class="op">=</span> <span class="fl">0.0247935047619046</span>,</span>
<span>        x2 <span class="op">=</span> <span class="op">-</span><span class="fl">0.0247934285714285</span>,</span>
<span>        x3 <span class="op">=</span> <span class="fl">0.00826446666666666</span></span>
<span>      <span class="op">)</span>,</span>
<span>      coef_a_2j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        `(Intercept)` <span class="op">=</span> <span class="fl">1.61511016623365</span>,</span>
<span>        C_ti1 <span class="op">=</span> <span class="op">-</span><span class="fl">0.949231624530986</span>,</span>
<span>        x2 <span class="op">=</span> <span class="fl">0.170011662337658</span>,</span>
<span>        x3 <span class="op">=</span> <span class="op">-</span><span class="fl">0.00472254343434329</span></span>
<span>      <span class="op">)</span>,</span>
<span>      coef_a_3j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`(Intercept)` <span class="op">=</span> <span class="op">-</span><span class="fl">6.54546038181818</span>,</span>
<span>                    C_ti1 <span class="op">=</span> <span class="fl">1.09090950909091</span><span class="op">)</span>,</span>
<span>      r2_check <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.999999999999997</span>, <span class="fl">0.999999999999993</span>,</span>
<span>                   <span class="fl">0.999999999999926</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>scipen <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>tibble.print_max <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="conversion-to-warden">Conversion to WARDEN<a class="anchor" aria-label="anchor" href="#conversion-to-warden"></a>
</h2>
<div class="section level3">
<h3 id="inputs">Inputs<a class="anchor" aria-label="anchor" href="#inputs"></a>
</h3>
<p>As with any model, we need to load inputs, set initial TTE, event
reactions, utilities/costs, etc. We’ll use the <code><a href="../reference/pick_val_v.html">pick_val_v()</a></code>
function to have all inputs set-up at once.</p>
<p>Though the model is a cohort one except for the SIMD variable, we
assume here that we could use one with individual variation, so we
define the parameters at the individual level instead of pre-loading
them as a cohort (though we could do that as well). Since we do not have
any uncertainty around the cohort parameters, we assume those are
excluded from the PSA as in the original publication.</p>
<p>Normally, we would model each of the different events independently,
i.e., we would allow the model to naturally choose and express the
competitive risks (we would have an event for “nonfatal_CHD”, another
for “nonfatal_CBVD”, etc), but for the sake of replication we will
proceed as in the original paper, merging them into event 1 and event
2.</p>
<p>We create the time to event for the first event within the
patient-arm level inputs.</p>
<p>We also create 3 ad-hoc functions to handle the restricted cube
spline.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#helper functions for the restricted cube</span></span>
<span></span>
<span><span class="va">rcs_du_v</span> <span class="op">&lt;-</span>  <span class="kw">function</span><span class="op">(</span><span class="va">du_all</span>, <span class="va">du</span>, <span class="va">t2</span>, <span class="va">b5</span>, <span class="va">b6</span>, <span class="va">a0</span>, <span class="va">a1</span>, <span class="va">a2</span>, <span class="va">a3</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">l_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t2</span><span class="op">)</span></span>
<span>  <span class="va">l_du</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">du</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Polynomial term per time (length T)</span></span>
<span>  <span class="va">poly_t</span> <span class="op">&lt;-</span> <span class="va">a3</span> <span class="op">*</span> <span class="va">t2</span><span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="va">a2</span> <span class="op">*</span> <span class="va">t2</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">a1</span> <span class="op">*</span> <span class="va">t2</span> <span class="op">+</span> <span class="va">a0</span></span>
<span>  </span>
<span>  <span class="co"># Linear predictor matrix T × M</span></span>
<span>  <span class="co"># Each row t: du + b5*t + b6*poly(t)</span></span>
<span>  <span class="va">lp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="va">t2</span>, <span class="va">b5</span>, <span class="st">"*"</span><span class="op">)</span> <span class="op">+</span>            <span class="co"># B5 term: T×M</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="va">poly_t</span>, <span class="va">b6</span>, <span class="st">"*"</span><span class="op">)</span> <span class="op">+</span>         <span class="co"># B6 * poly term: T×M</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">du</span>, <span class="va">l_t</span>, <span class="va">l_du</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>   <span class="co"># add du</span></span>
<span>  </span>
<span>  <span class="co"># Apply pnorm elementwise</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">lp</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Weighted sum over DU_ALL (matrix multiply)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">p</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">du_all</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">disu_sec_vec</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time</span>, <span class="va">DU_ALL</span>, <span class="va">DU</span>, <span class="va">B5</span>, <span class="va">B6</span>, <span class="va">nl_RCS_ch</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>   <span class="co"># Segment indicator</span></span>
<span>  <span class="va">seg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span></span>
<span>    <span class="va">time</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="va">nl_RCS_ch</span><span class="op">$</span><span class="va">knots</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    right <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Preallocate spline coefficients (per time)</span></span>
<span>  <span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Segment 2</span></span>
<span>  <span class="va">s2</span> <span class="op">&lt;-</span> <span class="va">seg</span> <span class="op">==</span> <span class="fl">2</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">A</span><span class="op">[</span><span class="va">s2</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">nl_RCS_ch</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, ncol <span class="op">=</span> <span class="fl">4</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Segment 3</span></span>
<span>  <span class="va">s3</span> <span class="op">&lt;-</span> <span class="va">seg</span> <span class="op">==</span> <span class="fl">3</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">s3</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">A</span><span class="op">[</span><span class="va">s3</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">nl_RCS_ch</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, ncol <span class="op">=</span> <span class="fl">4</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">s3</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="fu">rcs_du_v</span><span class="op">(</span></span>
<span>    t2  <span class="op">=</span> <span class="va">time</span>,</span>
<span>    du_all <span class="op">=</span> <span class="va">DU_ALL</span>,</span>
<span>    du <span class="op">=</span> <span class="va">DU</span>,</span>
<span>    b5 <span class="op">=</span> <span class="va">B5</span>,</span>
<span>    b6 <span class="op">=</span> <span class="va">B6</span>,</span>
<span>    a0 <span class="op">=</span> <span class="va">A</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>    a1 <span class="op">=</span> <span class="va">A</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>    a2 <span class="op">=</span> <span class="va">A</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>,</span>
<span>    a3 <span class="op">=</span> <span class="va">A</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rcs_cost_f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time</span>, <span class="va">nl_RCS_ch</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">i1</span> <span class="op">&lt;-</span> <span class="va">time</span> <span class="op">&lt;</span> <span class="va">nl_RCS_ch</span><span class="op">$</span><span class="va">knots</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">i2</span> <span class="op">&lt;-</span> <span class="va">time</span> <span class="op">&gt;=</span> <span class="va">nl_RCS_ch</span><span class="op">$</span><span class="va">knots</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">time</span> <span class="op">&lt;</span> <span class="va">nl_RCS_ch</span><span class="op">$</span><span class="va">knots</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">i3</span> <span class="op">&lt;-</span> <span class="va">time</span> <span class="op">&gt;=</span> <span class="va">nl_RCS_ch</span><span class="op">$</span><span class="va">knots</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">time</span> <span class="op">&lt;</span> <span class="va">nl_RCS_ch</span><span class="op">$</span><span class="va">knots</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="va">i4</span> <span class="op">&lt;-</span> <span class="va">time</span> <span class="op">&gt;=</span> <span class="va">nl_RCS_ch</span><span class="op">$</span><span class="va">knots</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Segment 1: below first knot → zero</span></span>
<span>  <span class="va">out</span><span class="op">[</span><span class="va">i1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  </span>
<span>  <span class="co"># Segment 2: cubic spline piece 2</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">i2</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">t</span> <span class="op">&lt;-</span> <span class="va">time</span><span class="op">[</span><span class="va">i2</span><span class="op">]</span></span>
<span>    <span class="va">out</span><span class="op">[</span><span class="va">i2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">nl_RCS_ch</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">t</span>, <span class="va">t</span><span class="op">^</span><span class="fl">2</span>, <span class="va">t</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Segment 3: cubic spline piece 3</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">i3</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">t</span> <span class="op">&lt;-</span> <span class="va">time</span><span class="op">[</span><span class="va">i3</span><span class="op">]</span></span>
<span>    <span class="va">out</span><span class="op">[</span><span class="va">i3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">nl_RCS_ch</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">t</span>, <span class="va">t</span><span class="op">^</span><span class="fl">2</span>, <span class="va">t</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Segment 4: linear tail</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">i4</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">t</span> <span class="op">&lt;-</span> <span class="va">time</span><span class="op">[</span><span class="va">i4</span><span class="op">]</span></span>
<span>    <span class="va">out</span><span class="op">[</span><span class="va">i4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">nl_RCS_ch</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">t</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">out</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#reform parameters so it's clearer for model</span></span>
<span><span class="va">l_CVD_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>parameter_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                                      <span class="st">"first_event_nonfatal_CHD_m"</span>,</span>
<span>                                      <span class="st">"first_event_nonfatal_CBVD_m"</span>,</span>
<span>                                      <span class="st">"first_event_CVD_death_m"</span>, </span>
<span>                                      <span class="st">"first_event_nonCVD_death_m"</span>,</span>
<span>                                      <span class="st">"post_CHD_m"</span>,</span>
<span>                                      <span class="st">"post_CBVD_m"</span>,</span>
<span>                                      <span class="st">"first_event_nonfatal_CHD_f"</span>,</span>
<span>                                      <span class="st">"first_event_nonfatal_CBVD_f"</span>,</span>
<span>                                      <span class="st">"first_event_CVD_death_f"</span>, </span>
<span>                                      <span class="st">"first_event_nonCVD_death_f"</span>,</span>
<span>                                      <span class="st">"post_CHD_f"</span>,</span>
<span>                                      <span class="st">"post_CBVD_f"</span></span>
<span>                                      <span class="op">)</span>,</span>
<span>                 base_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_m</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_m</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_m</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_m</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">post_event_coef_m</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">post_event_coef_m</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_f</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_f</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_f</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_f</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">post_event_coef_f</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">post_event_coef_f</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>                   <span class="op">)</span>,</span>
<span>                 PSA_dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"mvrnorm"</span>,</span>
<span>                                 <span class="st">"mvrnorm"</span>,</span>
<span>                                 <span class="st">"mvrnorm"</span>,</span>
<span>                                 <span class="st">"mvrnorm"</span>,</span>
<span>                                 <span class="st">"mvrnorm"</span>,</span>
<span>                                 <span class="st">"mvrnorm"</span>,</span>
<span>                                 <span class="st">"mvrnorm"</span>,</span>
<span>                                 <span class="st">"mvrnorm"</span>,</span>
<span>                                 <span class="st">"mvrnorm"</span>,</span>
<span>                                 <span class="st">"mvrnorm"</span>,</span>
<span>                                 <span class="st">"mvrnorm"</span>,</span>
<span>                                 <span class="st">"mvrnorm"</span></span>
<span>                                <span class="op">)</span>,</span>
<span>                 a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_m</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_m</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_m</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_m</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">post_event_coef_m</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">post_event_coef_m</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_f</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_f</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_f</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">first_event_coef_f</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">post_event_coef_m</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">post_event_coef_m</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>                   <span class="op">)</span>,</span>
<span>                 b<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">cov_firstE_CHD_m</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">cov_firstE_CBVD_m</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">cov_fatal_CVD_m</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">cov_fatal_nonCVD_m</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">cov_surv_postCHD_m</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">cov_surv_postCBVD_m</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">cov_firstE_CHD_f</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">cov_firstE_CBVD_f</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">cov_fatal_CVD_f</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">cov_fatal_nonCVD_f</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">cov_surv_postCHD_f</span>,</span>
<span>                    <span class="va">list_coef</span><span class="op">$</span><span class="va">cov_surv_postCBVD_f</span></span>
<span>                   <span class="op">)</span>,</span>
<span>                 n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>                 psa_indicators <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>                 <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">common_all_inputs</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span>input <span class="op">=</span> <span class="op">{</span></span>
<span>                      <span class="va">drc</span>       <span class="op">&lt;-</span> <span class="va">disc</span></span>
<span>                      <span class="va">drq</span>       <span class="op">&lt;-</span> <span class="va">disc</span></span>
<span>                      <span class="va">ldleffect</span> <span class="op">&lt;-</span> <span class="fl">0.26</span></span>
<span>                      <span class="va">hdleffect</span> <span class="op">&lt;-</span> <span class="fl">1.04</span> </span>
<span>                      <span class="va">cost_tx</span>    <span class="op">&lt;-</span> <span class="fl">13</span></span>
<span>                      <span class="va">cost</span>      <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>                      <span class="va">disu</span>      <span class="op">&lt;-</span> <span class="fl">0.001</span></span>
<span>                      <span class="va">f1</span>        <span class="op">&lt;-</span> <span class="fl">0.96</span></span>
<span>                      <span class="va">multi_m</span>   <span class="op">&lt;-</span> <span class="fl">0.99</span></span>
<span>                      <span class="va">multi_f</span>   <span class="op">&lt;-</span> <span class="fl">1.05</span></span>
<span>                      <span class="va">time_horizon</span> <span class="op">&lt;-</span> <span class="va">tm</span></span>
<span>                      </span>
<span>                      <span class="co">#patient level (not needed to have the stats part since sd is 0 except for SIMD, but we leave it as example since it does not impact results)</span></span>
<span>                      <span class="va">age_v</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">npats</span>, <span class="va">list_age</span><span class="op">$</span><span class="va">mean</span>, <span class="va">list_age</span><span class="op">$</span><span class="va">sd</span><span class="op">)</span></span>
<span>                      <span class="va">SIMD_v</span>     <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rbeta_mse.html">rbeta_mse</a></span><span class="op">(</span><span class="va">npats</span>, <span class="va">list_SIMD</span><span class="op">$</span><span class="va">mean</span><span class="op">/</span><span class="fl">100</span>, <span class="va">list_SIMD</span><span class="op">$</span><span class="va">sd</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span></span>
<span>                      <span class="va">Diabetes_v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">npats</span>, <span class="fl">1</span>, <span class="va">list_Diabetes</span><span class="op">$</span><span class="va">prop</span><span class="op">)</span></span>
<span>                      <span class="va">FH_v</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">npats</span>, <span class="fl">1</span>, <span class="va">list_FH</span><span class="op">$</span><span class="va">prop</span><span class="op">)</span></span>
<span>                      <span class="va">CPD_v</span>      <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rgamma_mse.html">rgamma_mse</a></span><span class="op">(</span><span class="va">npats</span>, <span class="va">list_CPD</span><span class="op">$</span><span class="va">mean</span>, <span class="va">list_CPD</span><span class="op">$</span><span class="va">sd</span><span class="op">)</span></span>
<span>                      <span class="va">SBP_v</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">npats</span>, <span class="va">list_SBP</span><span class="op">$</span><span class="va">mean</span>, <span class="va">list_SBP</span><span class="op">$</span><span class="va">sd</span><span class="op">)</span></span>
<span>                      <span class="va">TC_v</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">npats</span>, <span class="va">list_TC</span><span class="op">$</span><span class="va">mean</span>, <span class="va">list_TC</span><span class="op">$</span><span class="va">sd</span><span class="op">)</span></span>
<span>                      <span class="va">HDL_v</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">npats</span>, <span class="va">list_HDL</span><span class="op">$</span><span class="va">mean</span>, <span class="va">list_HDL</span><span class="op">$</span><span class="va">sd</span><span class="op">)</span></span>
<span>                      <span class="va">sex_v</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">npats</span>, <span class="fl">1</span>, <span class="va">list_sex</span><span class="op">$</span><span class="va">prop</span><span class="op">)</span></span>
<span>                      <span class="va">status_v</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">npats</span><span class="op">)</span></span>
<span>                      </span>
<span>                      <span class="co"># CVD coefs</span></span>
<span>                      <span class="fu"><a href="../reference/pick_val_v.html">pick_val_v</a></span><span class="op">(</span></span>
<span>                        base<span class="op">=</span> <span class="va">l_CVD_inputs</span><span class="op">[[</span><span class="st">"base_value"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                        psa <span class="op">=</span> <span class="fu"><a href="../reference/pick_psa.html">pick_psa</a></span><span class="op">(</span></span>
<span>                            <span class="va">l_CVD_inputs</span><span class="op">[[</span><span class="st">"PSA_dist"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                            <span class="va">l_CVD_inputs</span><span class="op">[[</span><span class="st">"n"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                            <span class="va">l_CVD_inputs</span><span class="op">[[</span><span class="st">"a"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                            <span class="va">l_CVD_inputs</span><span class="op">[[</span><span class="st">"b"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                        psa_ind     <span class="op">=</span> <span class="va">psa_bool</span>,</span>
<span>                        sens_ind    <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                        names_out   <span class="op">=</span> <span class="va">l_CVD_inputs</span><span class="op">[[</span><span class="st">"parameter_name"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                        indicator   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">12</span><span class="op">)</span>, </span>
<span>                        indicator_psa <span class="op">=</span> <span class="va">l_CVD_inputs</span><span class="op">[[</span><span class="st">"psa_indicators"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                        deploy_env <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>                      <span class="op">)</span> </span>
<span>                      </span>
<span>                      <span class="va">ldleffect</span> <span class="op">&lt;-</span> <span class="fl">0.26</span> </span>
<span>                      <span class="va">hdleffect</span> <span class="op">&lt;-</span> <span class="fl">1.04</span> </span>
<span>                      <span class="va">disu</span> <span class="op">&lt;-</span> <span class="fl">0.001</span></span>
<span>                      <span class="va">odd_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span>,<span class="fl">2</span><span class="op">)</span></span>
<span>                      <span class="va">even_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">10</span>,<span class="fl">2</span><span class="op">)</span></span>
<span>                      <span class="va">q_total</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>                      </span>
<span><span class="op">}</span><span class="op">)</span>  </span>
<span></span>
<span></span>
<span><span class="va">common_pt_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span>input<span class="op">=</span><span class="op">{</span></span>
<span>    <span class="va">sex</span> <span class="op">&lt;-</span> <span class="va">sex_v</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">bs_age</span> <span class="op">&lt;-</span> <span class="va">age_v</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> </span>
<span>    <span class="va">age</span> <span class="op">&lt;-</span> <span class="va">bs_age</span></span>
<span>    <span class="va">SIMD</span> <span class="op">&lt;-</span> <span class="va">SIMD_v</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>    <span class="va">Diabetes</span> <span class="op">&lt;-</span> <span class="va">Diabetes_v</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> </span>
<span>    <span class="va">FH</span> <span class="op">&lt;-</span> <span class="va">FH_v</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> </span>
<span>    <span class="va">CPD</span> <span class="op">&lt;-</span> <span class="va">CPD_v</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> </span>
<span>    <span class="va">SBP</span> <span class="op">&lt;-</span> <span class="va">SBP_v</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> </span>
<span>    <span class="va">status</span> <span class="op">&lt;-</span> <span class="va">status_v</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> </span>
<span>    <span class="va">u_norms</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="va">list_coef</span><span class="op">$</span><span class="va">u_norms_m</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="va">list_coef</span><span class="op">$</span><span class="va">u_norms_f</span><span class="op">}</span></span>
<span>    <span class="va">v_du</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="va">list_coef</span><span class="op">$</span><span class="va">coef_u_m</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="va">list_coef</span><span class="op">$</span><span class="va">coef_u_f</span><span class="op">}</span></span>
<span>    <span class="va">v_du</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">v_du</span>,<span class="fl">0</span><span class="op">)</span> <span class="co">#append 0 for time horizon case</span></span>
<span>    <span class="va">second_event_du_coef</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="va">list_coef</span><span class="op">$</span><span class="va">second_event_coef_m</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="va">list_coef</span><span class="op">$</span><span class="va">second_event_coef_f</span><span class="op">}</span></span>
<span>    <span class="va">coef_c1</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="va">list_coef</span><span class="op">$</span><span class="va">coef_c1_m</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="va">list_coef</span><span class="op">$</span><span class="va">coef_c1_f</span><span class="op">}</span></span>
<span>    <span class="va">coef_c1_pre</span> <span class="op">&lt;-</span> <span class="va">coef_c1</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">coef_c1_post</span> <span class="op">&lt;-</span> <span class="va">coef_c1</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">coef_c2</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="va">list_coef</span><span class="op">$</span><span class="va">coef_c2_m</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="va">list_coef</span><span class="op">$</span><span class="va">coef_c2_f</span><span class="op">}</span></span>
<span>    <span class="va">post_CHD</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="va">post_CHD_m</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="va">post_CHD_f</span><span class="op">}</span></span>
<span>    <span class="va">post_CBVD</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="va">post_CBVD_m</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="va">post_CBVD_f</span><span class="op">}</span></span>
<span>    <span class="va">rnd_v_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span>    <span class="va">rnd_v_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">unique_pt_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span>input <span class="op">=</span> <span class="op">{</span></span>
<span>    <span class="va">treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">arm</span> <span class="op">==</span> <span class="st">"int"</span><span class="op">)</span></span>
<span>    <span class="va">TC</span>  <span class="op">&lt;-</span> <span class="va">TC_v</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span><span class="va">TC_v</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="va">HDL_v</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">treatment</span> <span class="op">*</span> <span class="va">ldleffect</span></span>
<span>    <span class="va">HDL</span> <span class="op">&lt;-</span> <span class="va">HDL_v</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="va">hdleffect</span> <span class="op">^</span> <span class="va">treatment</span></span>
<span>    </span>
<span>    <span class="va">m_pat_ch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">SIMD</span>, <span class="va">Diabetes</span>, <span class="va">FH</span>, <span class="va">CPD</span>, <span class="va">SBP</span>, <span class="va">TC</span>, <span class="va">HDL</span>, <span class="fl">1</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span>
<span>    <span class="va">first_event_nonfatal_CHD</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="va">first_event_nonfatal_CHD_m</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="va">first_event_nonfatal_CHD_f</span><span class="op">}</span> </span>
<span>    <span class="va">lp_first_event_nonfatal_CHD</span> <span class="op">&lt;-</span> <span class="va">m_pat_ch</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">first_event_nonfatal_CHD</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span> <span class="op">*</span> <span class="va">f1</span></span>
<span>    </span>
<span>    <span class="va">first_event_nonfatal_CBVD</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="va">first_event_nonfatal_CBVD_m</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="va">first_event_nonfatal_CBVD_f</span><span class="op">}</span> </span>
<span>    <span class="va">lp_first_event_nonfatal_CBVD</span> <span class="op">&lt;-</span> <span class="va">m_pat_ch</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">first_event_nonfatal_CBVD</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span> <span class="op">*</span> <span class="va">f1</span></span>
<span>    </span>
<span>    <span class="va">first_event_CVD_death</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="va">first_event_CVD_death_m</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="va">first_event_CVD_death_f</span><span class="op">}</span></span>
<span>    <span class="va">lp_first_event_CVD_death</span> <span class="op">&lt;-</span> <span class="va">m_pat_ch</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">first_event_CVD_death</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span> <span class="op">*</span> <span class="va">f1</span></span>
<span>    </span>
<span>    <span class="va">first_event_nonCVD_death</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="va">first_event_nonCVD_death_m</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="va">first_event_nonCVD_death_f</span><span class="op">}</span></span>
<span>    <span class="va">lp_first_event_nonCVD_death</span> <span class="op">&lt;-</span> <span class="va">m_pat_ch</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">first_event_nonCVD_death</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span> <span class="op">*</span> <span class="va">f1</span></span>
<span>    </span>
<span>    <span class="va">t_firstE_nonfatal_CHD</span>  <span class="op">&lt;-</span> <span class="fu"><a href="http://chjackson.github.io/flexsurv-dev/reference/Gompertz.html" class="external-link">qgompertz</a></span><span class="op">(</span><span class="va">rnd_v_1</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">lp_first_event_nonfatal_CHD</span><span class="op">)</span>,  shape <span class="op">=</span> <span class="va">first_event_nonfatal_CHD</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="va">t_firstE_nonfatal_CBVD</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://chjackson.github.io/flexsurv-dev/reference/Gompertz.html" class="external-link">qgompertz</a></span><span class="op">(</span><span class="va">rnd_v_1</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">lp_first_event_nonfatal_CBVD</span><span class="op">)</span>, shape <span class="op">=</span> <span class="va">first_event_nonfatal_CBVD</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="va">t_firstE_CVD_death</span>     <span class="op">&lt;-</span> <span class="fu"><a href="http://chjackson.github.io/flexsurv-dev/reference/Gompertz.html" class="external-link">qgompertz</a></span><span class="op">(</span><span class="va">rnd_v_1</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">lp_first_event_CVD_death</span><span class="op">)</span>,     shape <span class="op">=</span> <span class="va">first_event_CVD_death</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="va">t_firstE_nonCVD_death</span>  <span class="op">&lt;-</span> <span class="fu"><a href="http://chjackson.github.io/flexsurv-dev/reference/Gompertz.html" class="external-link">qgompertz</a></span><span class="op">(</span><span class="va">rnd_v_1</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">lp_first_event_nonCVD_death</span><span class="op">)</span>,  shape <span class="op">=</span> <span class="va">first_event_nonCVD_death</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">v_first_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">t_firstE_nonfatal_CHD</span>,<span class="va">t_firstE_nonfatal_CBVD</span>, <span class="va">t_firstE_CVD_death</span>, <span class="va">t_firstE_nonCVD_death</span>, <span class="va">time_horizon</span><span class="op">)</span> </span>
<span>    </span>
<span>    <span class="va">status_1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">v_first_times</span><span class="op">)</span></span>
<span>    <span class="va">tte_first</span> <span class="op">&lt;-</span> <span class="va">v_first_times</span><span class="op">[</span><span class="va">status_1</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="va">seq_ch</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">status_1</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="va">odd_seq</span><span class="op">}</span><span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">status_1</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span><span class="op">{</span><span class="va">even_seq</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="cn">NA</span><span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">b5</span> <span class="op">&lt;-</span> <span class="va">second_event_du_coef</span><span class="op">[</span><span class="va">seq_ch</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">b6</span> <span class="op">&lt;-</span> <span class="va">second_event_du_coef</span><span class="op">[</span><span class="va">seq_ch</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="events">Events<a class="anchor" aria-label="anchor" href="#events"></a>
</h3>
<div class="section level4">
<h4 id="add-initial-events">Add Initial Events<a class="anchor" aria-label="anchor" href="#add-initial-events"></a>
</h4>
<p>We set up event times.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">init_event_list</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/add_tte.html">add_tte</a></span><span class="op">(</span>arm<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int"</span>,<span class="st">"comp"</span><span class="op">)</span>, evts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"start"</span>,<span class="st">"event_1"</span>,<span class="st">"event_2"</span><span class="op">)</span>, input<span class="op">=</span><span class="op">{</span></span>
<span>  <span class="va">start</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="va">event_1</span> <span class="op">&lt;-</span> <span class="va">tte_first</span></span>
<span>  <span class="va">event_2</span> <span class="op">&lt;-</span> <span class="cn">Inf</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="add-reaction-to-the-events">Add Reaction to the Events<a class="anchor" aria-label="anchor" href="#add-reaction-to-the-events"></a>
</h4>
<p>This is where the biggest differences are between WARDEN and the
original model. WARDEN simulates each patient individually, while the
original paper takes advantage of full patient vectorization to speed
things up, at the cost of 1) transparency, and 2) lack of adaptability
to other model structures. This is particularly impactful in this model
as both costs and utilities have a restricted cubic spline approach,
which means we take advantage of the <code>adj_val</code> function to
process these functions over time. In this particular case, we use the
argument <code>vectorized_f</code> to accelerate the process because our
functions can handle time as a vector. In any case this process can be
computationally heavy, and in our case we choose to update these values
monthly, as the imprecision is expected to be minimal.</p>
<p>With WARDEN, we would suggest for programmers to model each event
individually, e.g., CHD, CBVD, time horizon, and even potentially
secondary events if needed. Competing events can easily be deactivated,
etc, and it would make the model more transparent, easier to read, debug
and understand.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">evt_react_list</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"start"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="co">#cost</span></span>
<span>                 <span class="va">linpred_cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">SIMD</span>, <span class="va">FH</span>, <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">coef_c1_pre</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span>,<span class="op">]</span></span>
<span>                 <span class="va">linpred_cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">status_1</span><span class="op">&gt;</span><span class="fl">4</span>,<span class="fl">0</span>,<span class="va">linpred_cost</span><span class="op">[</span><span class="va">status_1</span><span class="op">]</span><span class="op">)</span></span>
<span>                 <span class="va">coef_cost_1</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">status_1</span><span class="op">&gt;</span><span class="fl">4</span>,<span class="fl">0</span>,<span class="va">coef_c1_pre</span><span class="op">[</span><span class="fl">1</span>,<span class="va">status_1</span><span class="op">]</span><span class="op">)</span></span>
<span>                 <span class="va">coef_cost_2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">status_1</span><span class="op">&gt;</span><span class="fl">4</span>,<span class="fl">0</span>,<span class="va">coef_c1_pre</span><span class="op">[</span><span class="fl">2</span>,<span class="va">status_1</span><span class="op">]</span><span class="op">)</span></span>
<span>                 <span class="va">cost_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adj_val.html">adj_val</a></span><span class="op">(</span></span>
<span>                      <span class="va">curtime</span>,</span>
<span>                      <span class="fu"><a href="../reference/next_event.html">next_event</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">time</span>,</span>
<span>                      by <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">12</span>,</span>
<span>                      <span class="op">(</span><span class="va">.time</span><span class="op">-</span><span class="va">curtime</span><span class="op">)</span> <span class="op">*</span> <span class="va">coef_cost_1</span> <span class="op">+</span></span>
<span>                        <span class="va">coef_cost_2</span> <span class="op">*</span> <span class="fu">rcs_cost_f</span><span class="op">(</span><span class="op">(</span><span class="va">.time</span><span class="op">-</span><span class="va">curtime</span><span class="op">)</span>, <span class="va">nl_RCS</span><span class="op">[[</span><span class="st">"nl_RCS_pre"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">-</span><span class="va">sex</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                      discount <span class="op">=</span> <span class="va">drc</span>,</span>
<span>                      vectorized_f <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>                 <span class="op">)</span></span>
<span>                 </span>
<span>                 <span class="va">cost</span> <span class="op">&lt;-</span> <span class="va">linpred_cost</span> <span class="op">+</span> </span>
<span>                   <span class="va">cost_2</span> <span class="op">+</span></span>
<span>                   <span class="va">cost_tx</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">arm</span><span class="op">==</span><span class="st">"int"</span><span class="op">)</span></span>
<span>                   </span>
<span></span>
<span>                 <span class="co">#utility</span></span>
<span>                 <span class="co">#use adj_val to calculate the utility changing over time between curtime and next event time due to age change</span></span>
<span>                 <span class="va">adj_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adj_val.html">adj_val</a></span><span class="op">(</span></span>
<span>                      <span class="va">curtime</span>,</span>
<span>                      <span class="fu"><a href="../reference/next_event.html">next_event</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">time</span>,</span>
<span>                      by <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">12</span>,</span>
<span>                      <span class="op">{</span><span class="va">cutoff</span> <span class="op">&lt;-</span> <span class="va">.time</span> <span class="op">+</span> <span class="va">bs_age</span></span>
<span>                       <span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/findInterval.html" class="external-link">findInterval</a></span><span class="op">(</span><span class="va">cutoff</span>, <span class="va">u_norms</span><span class="op">$</span><span class="va">age_max</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>                       </span>
<span>                       <span class="co"># Clamp to bounds</span></span>
<span>                       <span class="va">pos</span><span class="op">[</span><span class="va">pos</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">u_norms</span><span class="op">$</span><span class="va">utility</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>                       </span>
<span>                       <span class="va">u_norms</span><span class="op">$</span><span class="va">utility</span><span class="op">[</span><span class="va">pos</span><span class="op">]</span><span class="op">}</span>,</span>
<span>                      discount <span class="op">=</span> <span class="va">drq</span>,</span>
<span>                      vectorized_f <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>                 <span class="op">)</span></span>
<span>                 <span class="va">q_total</span> <span class="op">&lt;-</span> <span class="va">adj_factor</span> <span class="op">-</span> <span class="va">disu</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">arm</span><span class="op">==</span><span class="st">"int"</span><span class="op">)</span></span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"event_1"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>              <span class="kw">if</span><span class="op">(</span><span class="va">status_1</span><span class="op">&gt;</span><span class="fl">2</span><span class="op">)</span><span class="op">{</span> <span class="co">#if death stop</span></span>
<span>                <span class="va">curtime</span> <span class="op">&lt;-</span> <span class="cn">Inf</span></span>
<span>                </span>
<span>              <span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span>                <span class="va">age</span> <span class="op">&lt;-</span> <span class="va">age</span> <span class="op">+</span> <span class="va">curtime</span></span>
<span>                <span class="va">m_pat_ch_2</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">SIMD</span>, <span class="va">FH</span>, <span class="fl">1</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span>                 </span>
<span>                <span class="va">lp_post_CHD</span> <span class="op">&lt;-</span> <span class="va">m_pat_ch_2</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">post_CHD</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span>                <span class="va">lp_post_CBVD</span> <span class="op">&lt;-</span> <span class="va">m_pat_ch_2</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">post_CBVD</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span>                </span>
<span>                <span class="va">t_postSurv_CHD</span>  <span class="op">&lt;-</span> <span class="fu"><a href="http://chjackson.github.io/flexsurv-dev/reference/Gompertz.html" class="external-link">qgompertz</a></span><span class="op">(</span><span class="va">rnd_v_2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">lp_post_CHD</span><span class="op">)</span>, shape <span class="op">=</span> <span class="va">post_CHD</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>                <span class="va">t_postSurv_CBVD</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://chjackson.github.io/flexsurv-dev/reference/Gompertz.html" class="external-link">qgompertz</a></span><span class="op">(</span><span class="va">rnd_v_2</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">lp_post_CBVD</span><span class="op">)</span>, shape <span class="op">=</span> <span class="va">post_CBVD</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>                </span>
<span>                <span class="va">t_second</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">status_1</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">t_postSurv_CHD</span>, <span class="va">t_postSurv_CBVD</span><span class="op">)</span></span>
<span>                </span>
<span>                <span class="va">v_second_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">t_second</span>, <span class="va">time_horizon</span> <span class="op">-</span> <span class="va">curtime</span><span class="op">)</span> </span>
<span>                <span class="va">status_2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">v_second_times</span><span class="op">)</span></span>
<span>                <span class="va">tte_second</span> <span class="op">&lt;-</span> <span class="va">v_second_times</span><span class="op">[</span><span class="va">status_2</span><span class="op">]</span></span>
<span>                <span class="va">status_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.infinite</a></span><span class="op">(</span><span class="va">tte_second</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">status_2</span><span class="op">)</span></span>
<span>                <span class="fu"><a href="../reference/modify_event.html">modify_event</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>event_2 <span class="op">=</span> <span class="va">tte_second</span> <span class="op">+</span> <span class="va">curtime</span><span class="op">)</span><span class="op">)</span></span>
<span>                </span>
<span>                <span class="co">#cost</span></span>
<span>                <span class="va">linpred_cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">SIMD</span>, <span class="va">FH</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">coef_c1_post</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span>,<span class="op">]</span></span>
<span>                <span class="va">linpred_cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">status_1</span><span class="op">&gt;</span><span class="fl">4</span>,<span class="fl">0</span>,<span class="va">linpred_cost</span><span class="op">[</span><span class="va">status_1</span><span class="op">]</span><span class="op">)</span></span>
<span>                <span class="va">coef_cost_1</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">status_1</span><span class="op">&gt;</span><span class="fl">4</span>,<span class="fl">0</span>,<span class="va">coef_c1_post</span><span class="op">[</span><span class="fl">1</span>,<span class="va">status_1</span><span class="op">]</span><span class="op">)</span></span>
<span>                <span class="va">coef_cost_2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">status_1</span><span class="op">&gt;</span><span class="fl">4</span>,<span class="fl">0</span>,<span class="va">coef_c1_post</span><span class="op">[</span><span class="fl">2</span>,<span class="va">status_1</span><span class="op">]</span><span class="op">)</span></span>
<span>                </span>
<span>                <span class="co">#use adj_val to calculate the cost changing over time between curtime and next event time</span></span>
<span>                <span class="va">cost_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adj_val.html">adj_val</a></span><span class="op">(</span></span>
<span>                     <span class="va">curtime</span>,</span>
<span>                     <span class="fu"><a href="../reference/next_event.html">next_event</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">time</span>,</span>
<span>                     by <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">12</span>,</span>
<span>                     <span class="op">(</span><span class="va">.time</span><span class="op">-</span><span class="va">curtime</span><span class="op">)</span> <span class="op">*</span> <span class="va">coef_cost_1</span> <span class="op">+</span></span>
<span>                       <span class="va">coef_cost_2</span> <span class="op">*</span> <span class="fu">rcs_cost_f</span><span class="op">(</span><span class="op">(</span><span class="va">.time</span><span class="op">-</span><span class="va">curtime</span><span class="op">)</span>, <span class="va">nl_RCS</span><span class="op">[[</span><span class="va">status_1</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">-</span><span class="va">sex</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                     discount <span class="op">=</span> <span class="va">drc</span>,</span>
<span>                     vectorized_f <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>                <span class="op">)</span></span>
<span>                </span>
<span>                <span class="va">cost</span> <span class="op">&lt;-</span> <span class="va">linpred_cost</span> <span class="op">+</span> <span class="va">cost_2</span> </span>
<span>                </span>
<span>                <span class="co">#utility</span></span>
<span>                <span class="va">lp_disusecond</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">SIMD</span>, <span class="va">FH</span>, <span class="fl">1</span><span class="op">)</span>,ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">second_event_du_coef</span><span class="op">[</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span> </span>
<span>                <span class="va">lp_disusecond</span> <span class="op">&lt;-</span> <span class="va">lp_disusecond</span><span class="op">[</span><span class="va">seq_ch</span><span class="op">]</span></span>
<span>               </span>
<span>                <span class="co">#use adj_val to calculate the utility changing over time between curtime and next event time due to age change and due to disutilities because of secondary events</span></span>
<span>                <span class="va">adj_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adj_val.html">adj_val</a></span><span class="op">(</span></span>
<span>                      <span class="va">curtime</span>,</span>
<span>                      <span class="fu"><a href="../reference/next_event.html">next_event</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">time</span>,</span>
<span>                      by <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">12</span>,</span>
<span>                      <span class="op">{</span><span class="va">cutoff</span> <span class="op">&lt;-</span> <span class="va">.time</span> <span class="op">+</span> <span class="va">bs_age</span></span>
<span>                       <span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/findInterval.html" class="external-link">findInterval</a></span><span class="op">(</span><span class="va">cutoff</span>, <span class="va">u_norms</span><span class="op">$</span><span class="va">age_max</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>                       </span>
<span>                       <span class="co"># Clamp to bounds</span></span>
<span>                       <span class="va">pos</span><span class="op">[</span><span class="va">pos</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">u_norms</span><span class="op">$</span><span class="va">utility</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>                       </span>
<span>                      <span class="va">out</span> <span class="op">&lt;-</span> <span class="va">u_norms</span><span class="op">$</span><span class="va">utility</span><span class="op">[</span><span class="va">pos</span><span class="op">]</span> <span class="op">-</span></span>
<span>                      <span class="fu">disu_sec_vec</span><span class="op">(</span><span class="va">.time</span> <span class="op">-</span> <span class="va">curtime</span>,<span class="va">v_du</span><span class="op">[</span><span class="op">-</span><span class="fl">6</span><span class="op">]</span>, <span class="va">lp_disusecond</span>, <span class="va">b5</span>, <span class="va">b6</span>, <span class="va">nl_RCS</span><span class="op">[[</span><span class="va">status_1</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">-</span><span class="va">sex</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>                      <span class="va">out</span></span>
<span>                        <span class="op">}</span></span>
<span>                      ,</span>
<span>                      discount <span class="op">=</span> <span class="va">drq</span>,</span>
<span>                      vectorized_f <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>                <span class="op">)</span></span>
<span>                <span class="va">q_total</span> <span class="op">&lt;-</span> <span class="va">adj_factor</span> <span class="op">-</span> <span class="va">v_du</span><span class="op">[</span><span class="va">status_1</span><span class="op">]</span> </span>
<span>              <span class="op">}</span></span>
<span>                 </span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"event_2"</span>, <span class="co">#which is death</span></span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="va">curtime</span> <span class="op">&lt;-</span> <span class="cn">Inf</span></span>
<span>               <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="costs-and-utilities">Costs and Utilities<a class="anchor" aria-label="anchor" href="#costs-and-utilities"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">util_ongoing</span> <span class="op">&lt;-</span> <span class="st">"q_total"</span></span>
<span></span>
<span><span class="va">cost_ongoing</span> <span class="op">&lt;-</span> <span class="st">"cost"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model">Model<a class="anchor" aria-label="anchor" href="#model"></a>
</h3>
<div class="section level4">
<h4 id="model-execution">Model Execution<a class="anchor" aria-label="anchor" href="#model-execution"></a>
</h4>
<p>Note that because of the patient-level loop approach, this model is
2x slower to run than the original one (37 seconds vs. 77 seconds).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sim.html">run_sim</a></span><span class="op">(</span>  </span>
<span>  npats<span class="op">=</span><span class="fl">30000</span>,                              </span>
<span>  n_sim<span class="op">=</span><span class="fl">1</span>,                                  </span>
<span>  psa_bool <span class="op">=</span> <span class="cn">FALSE</span>,                         </span>
<span>  arm_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"comp"</span><span class="op">)</span>,            </span>
<span>  common_all_inputs <span class="op">=</span> <span class="va">common_all_inputs</span>,    </span>
<span>  common_pt_inputs <span class="op">=</span> <span class="va">common_pt_inputs</span>,      </span>
<span>  unique_pt_inputs <span class="op">=</span> <span class="va">unique_pt_inputs</span>,</span>
<span>  init_event_list <span class="op">=</span> <span class="va">init_event_list</span>,        </span>
<span>  evt_react_list <span class="op">=</span> <span class="va">evt_react_list</span>,         </span>
<span>  util_ongoing_list <span class="op">=</span> <span class="va">util_ongoing</span>,</span>
<span>  cost_ongoing_list <span class="op">=</span> <span class="va">cost_ongoing</span>,</span>
<span>  ipd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis number: 1</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Patient-arm data aggregated across events by selecting the last value for input_out items.</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 71.54s</span></span>
<span><span class="co">#&gt; Time to run analysis 1: 71.54s</span></span>
<span><span class="co">#&gt; Total time to run: 71.54s</span></span>
<span><span class="co">#&gt; Simulation finalized;</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="post-processing-of-model-outputs">Post-processing of Model Outputs<a class="anchor" aria-label="anchor" href="#post-processing-of-model-outputs"></a>
</h3>
<div class="section level4">
<h4 id="summary-of-example-results">Summary of Example Results<a class="anchor" aria-label="anchor" href="#summary-of-example-results"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="fu"><a href="../reference/summary_results_det.html">summary_results_det</a></span><span class="op">(</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, arm <span class="op">=</span><span class="st">"int"</span>, wtp <span class="op">=</span> <span class="fl">20000</span><span class="op">)</span> <span class="co">#print first simulation</span></span>
<span><span class="co">#&gt;                      int     comp</span></span>
<span><span class="co">#&gt; costs           20205.52 20010.74</span></span>
<span><span class="co">#&gt; dcosts              0.00   194.78</span></span>
<span><span class="co">#&gt; lys                11.57    11.36</span></span>
<span><span class="co">#&gt; dlys                0.00     0.22</span></span>
<span><span class="co">#&gt; qalys               8.86     8.69</span></span>
<span><span class="co">#&gt; dqalys              0.00     0.17</span></span>
<span><span class="co">#&gt; ICER                  NA   905.60</span></span>
<span><span class="co">#&gt; ICUR                  NA  1125.02</span></span>
<span><span class="co">#&gt; INMB                  NA  3267.88</span></span>
<span><span class="co">#&gt; costs_undisc    31193.46 31010.77</span></span>
<span><span class="co">#&gt; dcosts_undisc       0.00   182.69</span></span>
<span><span class="co">#&gt; lys_undisc         16.13    15.79</span></span>
<span><span class="co">#&gt; dlys_undisc         0.00     0.34</span></span>
<span><span class="co">#&gt; qalys_undisc       12.27    11.99</span></span>
<span><span class="co">#&gt; dqalys_undisc       0.00     0.28</span></span>
<span><span class="co">#&gt; ICER_undisc           NA   531.00</span></span>
<span><span class="co">#&gt; ICUR_undisc           NA   654.73</span></span>
<span><span class="co">#&gt; INMB_undisc           NA  5397.84</span></span>
<span><span class="co">#&gt; cost            20205.52 20010.74</span></span>
<span><span class="co">#&gt; dcost               0.00   194.78</span></span>
<span><span class="co">#&gt; cost_undisc     31193.46 31010.77</span></span>
<span><span class="co">#&gt; dcost_undisc        0.00   182.69</span></span>
<span><span class="co">#&gt; q_total             8.86     8.69</span></span>
<span><span class="co">#&gt; dq_total            0.00     0.17</span></span>
<span><span class="co">#&gt; q_total_undisc     12.27    11.99</span></span>
<span><span class="co">#&gt; dq_total_undisc     0.00     0.28</span></span>
<span></span>
<span><span class="va">psa_ipd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"merged_df"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">psa_ipd</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>bootstrap_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:right;">
pat_id
</th>
<th style="text-align:left;">
arm
</th>
<th style="text-align:right;">
total_lys
</th>
<th style="text-align:right;">
total_qalys
</th>
<th style="text-align:right;">
total_costs
</th>
<th style="text-align:right;">
total_lys_undisc
</th>
<th style="text-align:right;">
total_qalys_undisc
</th>
<th style="text-align:right;">
total_costs_undisc
</th>
<th style="text-align:right;">
cost
</th>
<th style="text-align:right;">
q_total
</th>
<th style="text-align:right;">
cost_undisc
</th>
<th style="text-align:right;">
nexttime
</th>
<th style="text-align:right;">
number_events
</th>
<th style="text-align:right;">
simulation
</th>
<th style="text-align:right;">
sensitivity
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
15.82
</td>
<td style="text-align:right;">
12.09
</td>
<td style="text-align:right;">
41097
</td>
<td style="text-align:right;">
22.84
</td>
<td style="text-align:right;">
17.46
</td>
<td style="text-align:right;">
59338
</td>
<td style="text-align:right;">
41097
</td>
<td style="text-align:right;">
12.09
</td>
<td style="text-align:right;">
59338
</td>
<td style="text-align:right;">
45.7
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
11.08
</td>
<td style="text-align:right;">
8.78
</td>
<td style="text-align:right;">
13798
</td>
<td style="text-align:right;">
13.95
</td>
<td style="text-align:right;">
11.06
</td>
<td style="text-align:right;">
17373
</td>
<td style="text-align:right;">
13798
</td>
<td style="text-align:right;">
8.78
</td>
<td style="text-align:right;">
17373
</td>
<td style="text-align:right;">
27.9
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
18.51
</td>
<td style="text-align:right;">
14.24
</td>
<td style="text-align:right;">
27839
</td>
<td style="text-align:right;">
29.43
</td>
<td style="text-align:right;">
22.41
</td>
<td style="text-align:right;">
53728
</td>
<td style="text-align:right;">
27839
</td>
<td style="text-align:right;">
14.24
</td>
<td style="text-align:right;">
53728
</td>
<td style="text-align:right;">
74.7
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
12.34
</td>
<td style="text-align:right;">
9.74
</td>
<td style="text-align:right;">
9681
</td>
<td style="text-align:right;">
16.05
</td>
<td style="text-align:right;">
12.66
</td>
<td style="text-align:right;">
13111
</td>
<td style="text-align:right;">
9681
</td>
<td style="text-align:right;">
9.74
</td>
<td style="text-align:right;">
13111
</td>
<td style="text-align:right;">
47.8
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
6.86
</td>
<td style="text-align:right;">
5.46
</td>
<td style="text-align:right;">
6210
</td>
<td style="text-align:right;">
7.83
</td>
<td style="text-align:right;">
6.23
</td>
<td style="text-align:right;">
7084
</td>
<td style="text-align:right;">
6210
</td>
<td style="text-align:right;">
5.46
</td>
<td style="text-align:right;">
7084
</td>
<td style="text-align:right;">
15.7
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
11.40
</td>
<td style="text-align:right;">
8.48
</td>
<td style="text-align:right;">
24454
</td>
<td style="text-align:right;">
14.48
</td>
<td style="text-align:right;">
10.67
</td>
<td style="text-align:right;">
34045
</td>
<td style="text-align:right;">
24454
</td>
<td style="text-align:right;">
8.48
</td>
<td style="text-align:right;">
34045
</td>
<td style="text-align:right;">
35.8
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
19.17
</td>
<td style="text-align:right;">
14.37
</td>
<td style="text-align:right;">
33911
</td>
<td style="text-align:right;">
31.32
</td>
<td style="text-align:right;">
23.23
</td>
<td style="text-align:right;">
67431
</td>
<td style="text-align:right;">
33911
</td>
<td style="text-align:right;">
14.37
</td>
<td style="text-align:right;">
67431
</td>
<td style="text-align:right;">
85.6
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
16.55
</td>
<td style="text-align:right;">
12.62
</td>
<td style="text-align:right;">
25637
</td>
<td style="text-align:right;">
24.50
</td>
<td style="text-align:right;">
18.68
</td>
<td style="text-align:right;">
37942
</td>
<td style="text-align:right;">
25637
</td>
<td style="text-align:right;">
12.62
</td>
<td style="text-align:right;">
37942
</td>
<td style="text-align:right;">
49.0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
9.58
</td>
<td style="text-align:right;">
7.50
</td>
<td style="text-align:right;">
14430
</td>
<td style="text-align:right;">
11.62
</td>
<td style="text-align:right;">
9.07
</td>
<td style="text-align:right;">
19255
</td>
<td style="text-align:right;">
14430
</td>
<td style="text-align:right;">
7.50
</td>
<td style="text-align:right;">
19255
</td>
<td style="text-align:right;">
31.9
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
5.57
</td>
<td style="text-align:right;">
3.86
</td>
<td style="text-align:right;">
20422
</td>
<td style="text-align:right;">
6.18
</td>
<td style="text-align:right;">
4.28
</td>
<td style="text-align:right;">
22692
</td>
<td style="text-align:right;">
20422
</td>
<td style="text-align:right;">
3.86
</td>
<td style="text-align:right;">
22692
</td>
<td style="text-align:right;">
12.4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>We can see that the ICER stabilizes pretty quickly, with the ICUR
changing in absolute terms less than 500 GBP after 2,500 patients
simulated.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">merged_ipd</span> <span class="op">&lt;-</span> <span class="va">psa_ipd</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">arm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cumul_total_qalys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">total_qalys</span><span class="op">)</span><span class="op">/</span><span class="va">pat_id</span>,</span>
<span>         cumul_total_costs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">total_costs</span><span class="op">)</span><span class="op">/</span><span class="va">pat_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span><span class="va">pat_id</span>, <span class="va">arm</span>, <span class="va">cumul_total_qalys</span>, <span class="va">cumul_total_costs</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">arm</span>, values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cumul_total_qalys</span>,<span class="va">cumul_total_costs</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>inc_costs <span class="op">=</span> <span class="va">cumul_total_costs_int</span> <span class="op">-</span> <span class="va">cumul_total_costs_comp</span>,</span>
<span>         inc_qalys <span class="op">=</span> <span class="va">cumul_total_qalys_int</span> <span class="op">-</span> <span class="va">cumul_total_qalys_comp</span>,</span>
<span>         ICUR <span class="op">=</span> <span class="va">inc_costs</span><span class="op">/</span> <span class="va">inc_qalys</span><span class="op">)</span></span>
<span></span>
<span><span class="va">merged_ipd_results</span> <span class="op">&lt;-</span> <span class="va">merged_ipd</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">pat_id</span>,<span class="va">inc_costs</span>,<span class="va">inc_qalys</span>,<span class="va">ICUR</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">merged_ipd_results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">pat_id</span>,y<span class="op">=</span><span class="va">ICUR</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth<span class="op">=</span><span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5000</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Warning: Removed 6 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<p><img src="example_ScotCVD_LinBriggs_files/figure-html/post-processing_analysis-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">merged_ipd_results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">pat_id</span>,y<span class="op">=</span><span class="va">inc_costs</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth<span class="op">=</span><span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Warning: Removed 6 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<p><img src="example_ScotCVD_LinBriggs_files/figure-html/post-processing_analysis-2.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">merged_ipd_results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">pat_id</span>,y<span class="op">=</span><span class="va">inc_qalys</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth<span class="op">=</span><span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="example_ScotCVD_LinBriggs_files/figure-html/post-processing_analysis-3.png" class="r-plt" alt="" width="700"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Javier Sanchez Alvarez.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
