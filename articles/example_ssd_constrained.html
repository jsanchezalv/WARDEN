<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example for a Resource Constrained Sick-Sicker-Dead model • WARDEN</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example for a Resource Constrained Sick-Sicker-Dead model">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZEDNGW5QRP"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ZEDNGW5QRP');
</script><!-- Google tag (gtag.js) -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">WARDEN</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="View Index"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Core Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/warden_explained.html">Warden Explained</a></li>
    <li><a class="dropdown-item" href="../articles/example_ssd.html">Sick-Sicker-Dead Model (SSD)</a></li>
    <li><a class="dropdown-item" href="../articles/example_ssd_constrained.html">Resource Constrained SSD model</a></li>
    <li><a class="dropdown-item" href="../articles/inputs_selector.html">How to Use the Automatic Input Selector</a></li>
    <li><a class="dropdown-item" href="../articles/example_eBC.html">Early Breast Cancer</a></li>
    <li><a class="dropdown-item" href="../articles/example_ipd.html">Using Individual Patient Data</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other Tutorials and Best Practices</h6></li>
    <li><a class="dropdown-item" href="../articles/example_markov.html">Cohort Markov Model</a></li>
    <li><a class="dropdown-item" href="../articles/example_avoiding_cycles.html">How to Avoid Using Cycles to Speed Up Model</a></li>
    <li><a class="dropdown-item" href="../articles/example_uncertainty.html">Structural and Parametric Uncertainty</a></li>
    <li><a class="dropdown-item" href="../articles/example_ssd_stream.html">Random Number Streams &amp; Luck Adjustment (SSD model)</a></li>
    <li><a class="dropdown-item" href="../articles/example_ssd_sobol.html">Quasi-Random Sobol Sequence vs. Purely Random (SSD model)</a></li>
    <li><a class="dropdown-item" href="../articles/example_colon_degeling.html">Degeling (2025) using WARDEN instead of simmer</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jsanchezalv/WARDEN" aria-label="View on Github"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="example_ssd_constrained_files/kePrint-0.0.1/kePrint.js"></script><link href="example_ssd_constrained_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Example for a Resource Constrained Sick-Sicker-Dead model</h1>
                        <h4 data-toc-skip class="author">Javier Sanchez
Alvarez</h4>
            
            <h4 data-toc-skip class="date">October 08, 2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jsanchezalv/WARDEN/blob/main/vignettes/articles/example_ssd_constrained.Rmd" class="external-link"><code>vignettes/articles/example_ssd_constrained.Rmd</code></a></small>
      <div class="d-none name"><code>example_ssd_constrained.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document runs a discrete event simulation model in the context
of a late oncology model to show how the functions can be used to
generate a model in only a few steps. In this particular case, we
document how to run a model with constrained resources.</p>
<div class="section level3">
<h3 id="main-options">Main options<a class="anchor" aria-label="anchor" href="#main-options"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jsanchezalv.github.io/WARDEN/">WARDEN</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'kableExtra'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     group_rows</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>scipen <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>tibble.print_max <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="general-inputs-with-delayed-execution">General inputs with delayed execution<a class="anchor" aria-label="anchor" href="#general-inputs-with-delayed-execution"></a>
</h2>
<p>Compared to the standard sick-sicker-death model vignette, here
nothing changes, except that now we add a resource which will be
constrained (in a discrete manner, i.e., it accepts an integer amount of
units and the resource can only be used unit-wise, like hospital beds,
or doctors).</p>
<p>We should be careful about where we put the constrained resource, as
the level at which we set it up will determine its availability to
patients. Normally the intention is to have the resource being shared
within an arm by patients (and cloned across arms to make sure we
compare apples to apples), which means the resource should be allocated
in <code>common_all_inputs</code> (as those inputs will be cloned per
arm, so they will not be shared across arms unless explicitly declared
so using the specific constrained objects like
<code><a href="../reference/resource_discrete.html">resource_discrete()</a></code> or <code><a href="../reference/shared_input.html">shared_input()</a></code>). In our
case, we call the resource <code>beds</code>, and we use
<code><a href="../reference/resource_discrete.html">resource_discrete()</a></code> to set 650 beds to be shared. We also
keep track of the number of beds free for the purpose of seeing it in
the results.</p>
<p>For the sake of an example, we also create a shared input that we
will be updating as a counter of patients as they go through the
simulation, to showcase how inputs can be shared. Objects that are not
defined in <code><a href="../reference/resource_discrete.html">resource_discrete()</a></code> or
<code>shared_inputs()</code> will not be shared, and hard copies will be
made (unless the user introduces objects which are environments, in
which case by their own nature they will be modified by reference, so
they will be shared across analyses, simulations, arms, and patients, so
their use is not really recommended except for advanced R users).</p>
<p>Because of the way the constrained simulation works, it is very
important to pre-define any random numbers that will be used before the
simulation executes (normally at the <code>unique_pt_inputs</code>
level, though depends on the case, see below for an exception and the
early breast cancer model for the norm), and not to call the “r”
functions (<code><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp()</a></code>, <code><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois()</a></code>…) in the event
reactions. This is because the random state of the model will change as
it goes over the model, and the nature of the loop makes it so that the
random states can be mixed between patients between one simulation and
another if an event TTE is altered so its position in the queue changes
from one simulation to another. This is also very important if we want
to compare outcomes using constrained = FALSE and constrained = TRUE (as
in constrained = FALSE the random state is patient specific and can be
tracked, but in constrained is much harder to do so or would violate
CRAN norms).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#We don't need to use sensitivity_inputs here, so we don't add that object</span></span>
<span></span>
<span><span class="co">#Put objects here that do not change on any patient or intervention loop</span></span>
<span><span class="co">#We use add_item and add_item to showcase how the user can implement the inputs (either works, add_item is just faster)</span></span>
<span><span class="va">common_all_inputs</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span>input <span class="op">=</span> <span class="op">{</span></span>
<span>                      <span class="va">util.sick</span>   <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span>                      <span class="va">util.sicker</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span>                      <span class="va">cost.sick</span>   <span class="op">&lt;-</span> <span class="fl">3000</span></span>
<span>                      <span class="va">cost.sicker</span> <span class="op">&lt;-</span> <span class="fl">7000</span></span>
<span>                      <span class="va">cost.int</span>    <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span>                      <span class="va">coef_noint</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span></span>
<span>                      <span class="va">HR_int</span>      <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span>                      <span class="va">drc</span>         <span class="op">&lt;-</span> <span class="fl">0.035</span> <span class="co">#different values than what's assumed by default</span></span>
<span>                      <span class="va">drq</span>         <span class="op">&lt;-</span> <span class="fl">0.035</span></span>
<span>                      <span class="va">random_seed_sicker_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fl">100000</span>,<span class="va">npats</span>,replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>                      <span class="va">beds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resource_discrete.html">resource_discrete</a></span><span class="op">(</span><span class="fl">650</span><span class="op">)</span> <span class="co">#initialized with 650 beds</span></span>
<span>                      <span class="va">beds_free</span> <span class="op">&lt;-</span> <span class="va">beds</span><span class="op">$</span><span class="fu">n_free</span><span class="op">(</span><span class="op">)</span> <span class="co">#extract current n_free</span></span>
<span>                      <span class="va">shared_accumulator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/shared_input.html">shared_input</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="co">#initialized at 0</span></span>
<span>                      <span class="va">value_accum</span> <span class="op">&lt;-</span> <span class="va">shared_accumulator</span><span class="op">$</span><span class="fu">value</span><span class="op">(</span><span class="op">)</span> <span class="co">#extract value</span></span>
<span><span class="op">}</span><span class="op">)</span>  </span>
<span></span>
<span></span>
<span><span class="co">#Put objects here that do not change as we loop through treatments for a patient</span></span>
<span><span class="va">common_pt_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span>death<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">0.0000001</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1</span>, mean<span class="op">=</span><span class="fl">12</span>, sd<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">#Put objects here that change as we loop through treatments for each patient (e.g. events can affect fl.tx, but events do not affect nat.os.s)</span></span>
<span><span class="va">unique_pt_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span>fl.sick <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                             q_default <span class="op">=</span> <span class="va">util.sick</span>,</span>
<span>                             c_default <span class="op">=</span> <span class="va">cost.sick</span> <span class="op">+</span> <span class="kw">if</span><span class="op">(</span><span class="va">arm</span><span class="op">==</span><span class="st">"int"</span><span class="op">)</span><span class="op">{</span><span class="va">cost.int</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="fl">0</span><span class="op">}</span>,</span>
<span>                             success_blocking_bed <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                             had_to_queue <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                             time_in_queue <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                             time_start_queue <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="events">Events<a class="anchor" aria-label="anchor" href="#events"></a>
</h2>
<div class="section level3">
<h3 id="add-initial-events">Add Initial Events<a class="anchor" aria-label="anchor" href="#add-initial-events"></a>
</h3>
<p>Nothing changes here relative to the standard approach.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">init_event_list</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/add_tte.html">add_tte</a></span><span class="op">(</span>arm<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"noint"</span>,<span class="st">"int"</span><span class="op">)</span>, evts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sick"</span>,<span class="st">"sicker"</span>,<span class="st">"death"</span><span class="op">)</span> ,input<span class="op">=</span><span class="op">{</span></span>
<span>    <span class="va">sick</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="va">sicker</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,dist<span class="op">=</span><span class="st">"exp"</span>, coef1<span class="op">=</span><span class="va">coef_noint</span>, beta_tx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">arm</span><span class="op">==</span><span class="st">"int"</span>,<span class="va">HR_int</span>,<span class="fl">1</span><span class="op">)</span>, seed <span class="op">=</span> <span class="va">random_seed_sicker_i</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="co">#this way the value would be the same if it wasn't for the HR, effectively "cloning" patients luck</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="add-reaction-to-those-events">Add Reaction to Those Events<a class="anchor" aria-label="anchor" href="#add-reaction-to-those-events"></a>
</h3>
<p>We will assume that when the patients enter the sicker event, they
attempt to use one of the beds. If they do so, everything goes as
normal. If they fail to use one of the beds, the time to death is
accelerated as they cannot get the right treatment.</p>
<p>The discrete resources work similarly to R6 objects, i.e., we call
functions from themselves (in this case,
<code>beds$attempt_block()</code> as opposed to what would be a
traditional approach <code>attempt_block(beds)</code>), and they
automatically modify the <code>beds</code> object without needing to
return anything. An advantage of using R6-like objects is that we can
also make them return something to the user (as well as keep modifying
themselves!). In this case, <code>attempt_block</code> will return
<code>TRUE</code> or <code>FALSE</code> depending on the success or
failure of using the resource.</p>
<p>If the patient fails to block the bed, then the time to death is
accelerated by a factor of 0.8. Note that because resources are shared,
we can 1) know who the next patient in the queue is, and 2) create a new
event for that specific patient, even if the current patient being
evaluated is another.</p>
<p>Once a patient reaches the sicker state (or dies), the resource is
freed (if being used)/ the patient is removed from the queue (using
<code>attempt_free()</code>) and we set the event time for the next
patient in the queue to use.</p>
<p>We are also tracking a few things just to keep track of them, like
free beds count, time in a queue for patients who queued, and also
whether the patient had to queue or not.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">evt_react_list</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"sick"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="va">shared_accumulator</span> <span class="op">&lt;-</span> <span class="va">shared_accumulator</span><span class="op">$</span><span class="fu">modify</span><span class="op">(</span><span class="va">shared_accumulator</span><span class="op">$</span><span class="fu">value</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>                 <span class="va">value_accum</span> <span class="op">&lt;-</span> <span class="va">shared_accumulator</span><span class="op">$</span><span class="fu">value</span><span class="op">(</span><span class="op">)</span></span>
<span>                 <span class="va">beds_free</span> <span class="op">&lt;-</span> <span class="va">beds</span><span class="op">$</span><span class="fu">n_free</span><span class="op">(</span><span class="op">)</span></span>
<span>                 <span class="va">time_in_queue</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"sicker"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="va">success_blocking_bed</span> <span class="op">&lt;-</span> <span class="va">beds</span><span class="op">$</span><span class="fu">attempt_block</span><span class="op">(</span><span class="op">)</span></span>
<span>                 <span class="va">beds_free</span> <span class="op">&lt;-</span> <span class="va">beds</span><span class="op">$</span><span class="fu">n_free</span><span class="op">(</span><span class="op">)</span></span>
<span>                 <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">success_blocking_bed</span><span class="op">)</span><span class="op">{</span></span>
<span>                   <span class="va">time_start_queue</span> <span class="op">&lt;-</span> <span class="va">curtime</span></span>
<span>                   <span class="fu"><a href="../reference/modify_event.html">modify_event</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>death <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">curtime</span>,<span class="fu"><a href="../reference/get_event.html">get_event</a></span><span class="op">(</span><span class="st">"death"</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>                   <span class="va">had_to_queue</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>                 <span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>                   <span class="va">time_in_queue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">had_to_queue</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">curtime</span> <span class="op">-</span> <span class="va">time_start_queue</span>,<span class="cn">NA</span><span class="op">)</span></span>
<span>                 <span class="op">}</span></span>
<span>                 <span class="va">q_default</span> <span class="op">&lt;-</span> <span class="va">util.sicker</span></span>
<span>                 <span class="va">c_default</span> <span class="op">&lt;-</span> <span class="va">cost.sicker</span> <span class="op">+</span> <span class="kw">if</span><span class="op">(</span><span class="va">arm</span><span class="op">==</span><span class="st">"int"</span><span class="op">)</span><span class="op">{</span><span class="va">cost.int</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="fl">0</span><span class="op">}</span></span>
<span>                 <span class="va">fl.sick</span>   <span class="op">&lt;-</span> <span class="fl">0</span> </span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"death"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="va">beds</span><span class="op">$</span><span class="fu">attempt_free</span><span class="op">(</span><span class="op">)</span> <span class="co">#remove from using or from the queue</span></span>
<span>                 <span class="kw">if</span><span class="op">(</span><span class="va">success_blocking_bed</span> <span class="op">&amp;</span> <span class="va">beds</span><span class="op">$</span><span class="fu">queue_size</span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>                    <span class="fu"><a href="../reference/new_event.html">new_event</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>sicker <span class="op">=</span> <span class="va">curtime</span><span class="op">)</span>,</span>
<span>                               <span class="va">cur_evtlist</span>,</span>
<span>                               patient_id <span class="op">=</span> <span class="va">beds</span><span class="op">$</span><span class="fu">next_patient_in_line</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>                 <span class="op">}</span></span>
<span>                 <span class="va">success_blocking_bed</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>                 <span class="va">time_in_queue</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>                 <span class="va">beds_free</span> <span class="op">&lt;-</span> <span class="va">beds</span><span class="op">$</span><span class="fu">n_free</span><span class="op">(</span><span class="op">)</span></span>
<span>                 <span class="va">q_default</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>                 <span class="va">c_default</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>                 <span class="va">curtime</span>   <span class="op">&lt;-</span> <span class="cn">Inf</span></span>
<span>               <span class="op">}</span><span class="op">)</span> </span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="costs-and-utilities">Costs and Utilities<a class="anchor" aria-label="anchor" href="#costs-and-utilities"></a>
</h2>
<div class="section level3">
<h3 id="utilities">Utilities<a class="anchor" aria-label="anchor" href="#utilities"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">util_ongoing</span> <span class="op">&lt;-</span> <span class="st">"q_default"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="costs">Costs<a class="anchor" aria-label="anchor" href="#costs"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">cost_ongoing</span> <span class="op">&lt;-</span> <span class="st">"c_default"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="model">Model<a class="anchor" aria-label="anchor" href="#model"></a>
</h2>
<div class="section level3">
<h3 id="model-execution">Model Execution<a class="anchor" aria-label="anchor" href="#model-execution"></a>
</h3>
<p>The model is executed in exactly the same way as before, but we just
need to add <code>constrained = TRUE</code> to the arguments of
<code>run_sim</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Logic is: per patient, per intervention, per event, react to that event.</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sim.html">run_sim</a></span><span class="op">(</span>  </span>
<span>  npats<span class="op">=</span><span class="fl">1000</span>,                               <span class="co"># number of patients to be simulated</span></span>
<span>  n_sim<span class="op">=</span><span class="fl">1</span>,                                  <span class="co"># number of simulations to run</span></span>
<span>  psa_bool <span class="op">=</span> <span class="cn">FALSE</span>,                         <span class="co"># use PSA or not. If n_sim &gt; 1 and psa_bool = FALSE, then difference in outcomes is due to sampling (number of pats simulated)  </span></span>
<span>  arm_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"noint"</span><span class="op">)</span>,             <span class="co"># intervention list</span></span>
<span>  common_all_inputs <span class="op">=</span> <span class="va">common_all_inputs</span>,    <span class="co"># inputs common that do not change within a simulation</span></span>
<span>  common_pt_inputs <span class="op">=</span> <span class="va">common_pt_inputs</span>,      <span class="co"># inputs that change within a simulation but are not affected by the intervention</span></span>
<span>  unique_pt_inputs <span class="op">=</span> <span class="va">unique_pt_inputs</span>,</span>
<span>  init_event_list <span class="op">=</span> <span class="va">init_event_list</span>,        <span class="co"># initial event list</span></span>
<span>  evt_react_list <span class="op">=</span> <span class="va">evt_react_list</span>,          <span class="co"># reaction of events</span></span>
<span>  util_ongoing_list <span class="op">=</span> <span class="va">util_ongoing</span>,</span>
<span>  cost_ongoing_list <span class="op">=</span> <span class="va">cost_ongoing</span>,</span>
<span>  constrained <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ipd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  input_out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"beds_free"</span>,<span class="st">"had_to_queue"</span>,<span class="st">"time_in_queue"</span>,<span class="st">"value_accum"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis number: 1</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 1.21s</span></span>
<span><span class="co">#&gt; Time to run analysis 1: 1.21s</span></span>
<span><span class="co">#&gt; Total time to run: 1.21s</span></span>
<span><span class="co">#&gt; Simulation finalized;</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="post-processing-of-model-outputs">Post-processing of Model Outputs<a class="anchor" aria-label="anchor" href="#post-processing-of-model-outputs"></a>
</h2>
<div class="section level3">
<h3 id="summary-of-results">Summary of Results<a class="anchor" aria-label="anchor" href="#summary-of-results"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="fu"><a href="../reference/summary_results_det.html">summary_results_det</a></span><span class="op">(</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co">#print first simulation</span></span>
<span><span class="co">#&gt;                        int    noint</span></span>
<span><span class="co">#&gt; costs             58978.88 50094.68</span></span>
<span><span class="co">#&gt; dcosts                0.00  8884.20</span></span>
<span><span class="co">#&gt; lys                   9.72     9.48</span></span>
<span><span class="co">#&gt; dlys                  0.00     0.24</span></span>
<span><span class="co">#&gt; qalys                 6.27     5.96</span></span>
<span><span class="co">#&gt; dqalys                0.00     0.31</span></span>
<span><span class="co">#&gt; ICER                    NA 37160.24</span></span>
<span><span class="co">#&gt; ICUR                    NA 28856.67</span></span>
<span><span class="co">#&gt; INMB                    NA  6509.47</span></span>
<span><span class="co">#&gt; costs_undisc      74324.03 62968.98</span></span>
<span><span class="co">#&gt; dcosts_undisc         0.00 11355.04</span></span>
<span><span class="co">#&gt; lys_undisc           11.99    11.63</span></span>
<span><span class="co">#&gt; dlys_undisc           0.00     0.36</span></span>
<span><span class="co">#&gt; qalys_undisc          7.62     7.20</span></span>
<span><span class="co">#&gt; dqalys_undisc         0.00     0.41</span></span>
<span><span class="co">#&gt; ICER_undisc             NA 31720.16</span></span>
<span><span class="co">#&gt; ICUR_undisc             NA 27387.61</span></span>
<span><span class="co">#&gt; INMB_undisc             NA  9375.22</span></span>
<span><span class="co">#&gt; beds_free           261.50   241.64</span></span>
<span><span class="co">#&gt; dbeds_free            0.00    19.87</span></span>
<span><span class="co">#&gt; c_default         58978.88 50094.68</span></span>
<span><span class="co">#&gt; dc_default            0.00  8884.20</span></span>
<span><span class="co">#&gt; c_default_undisc  74324.03 62968.98</span></span>
<span><span class="co">#&gt; dc_default_undisc     0.00 11355.04</span></span>
<span><span class="co">#&gt; had_to_queue          0.00     0.15</span></span>
<span><span class="co">#&gt; dhad_to_queue         0.00    -0.15</span></span>
<span><span class="co">#&gt; q_default             6.27     5.96</span></span>
<span><span class="co">#&gt; dq_default            0.00     0.31</span></span>
<span><span class="co">#&gt; q_default_undisc      7.62     7.20</span></span>
<span><span class="co">#&gt; dq_default_undisc     0.00     0.41</span></span>
<span><span class="co">#&gt; time_in_queue          NaN      NaN</span></span>
<span><span class="co">#&gt; dtime_in_queue         NaN      NaN</span></span>
<span><span class="co">#&gt; value_accum         500.50   500.50</span></span>
<span><span class="co">#&gt; dvalue_accum          0.00     0.00</span></span>
<span></span>
<span><span class="va">psa_ipd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"merged_df"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">psa_ipd</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>bootstrap_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
evtname
</th>
<th style="text-align:right;">
evttime
</th>
<th style="text-align:right;">
prevtime
</th>
<th style="text-align:right;">
pat_id
</th>
<th style="text-align:left;">
arm
</th>
<th style="text-align:right;">
total_lys
</th>
<th style="text-align:right;">
total_qalys
</th>
<th style="text-align:right;">
total_costs
</th>
<th style="text-align:right;">
total_costs_undisc
</th>
<th style="text-align:right;">
total_qalys_undisc
</th>
<th style="text-align:right;">
total_lys_undisc
</th>
<th style="text-align:right;">
lys
</th>
<th style="text-align:right;">
qalys
</th>
<th style="text-align:right;">
costs
</th>
<th style="text-align:right;">
lys_undisc
</th>
<th style="text-align:right;">
qalys_undisc
</th>
<th style="text-align:right;">
costs_undisc
</th>
<th style="text-align:right;">
beds_free
</th>
<th style="text-align:right;">
had_to_queue
</th>
<th style="text-align:right;">
time_in_queue
</th>
<th style="text-align:right;">
value_accum
</th>
<th style="text-align:right;">
c_default
</th>
<th style="text-align:right;">
q_default
</th>
<th style="text-align:right;">
c_default_undisc
</th>
<th style="text-align:right;">
q_default_undisc
</th>
<th style="text-align:right;">
nexttime
</th>
<th style="text-align:right;">
simulation
</th>
<th style="text-align:right;">
sensitivity
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
sick
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
10.34
</td>
<td style="text-align:right;">
8.27
</td>
<td style="text-align:right;">
41358
</td>
<td style="text-align:right;">
51112
</td>
<td style="text-align:right;">
10.22
</td>
<td style="text-align:right;">
12.78
</td>
<td style="text-align:right;">
10.339
</td>
<td style="text-align:right;">
8.272
</td>
<td style="text-align:right;">
41358
</td>
<td style="text-align:right;">
12.778
</td>
<td style="text-align:right;">
10.222
</td>
<td style="text-align:right;">
51112
</td>
<td style="text-align:right;">
650
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
41358
</td>
<td style="text-align:right;">
8.272
</td>
<td style="text-align:right;">
51112
</td>
<td style="text-align:right;">
10.222
</td>
<td style="text-align:right;">
12.778
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
death
</td>
<td style="text-align:right;">
12.778
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
10.34
</td>
<td style="text-align:right;">
8.27
</td>
<td style="text-align:right;">
41358
</td>
<td style="text-align:right;">
51112
</td>
<td style="text-align:right;">
10.22
</td>
<td style="text-align:right;">
12.78
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
313
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
12.778
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
sick
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
7.75
</td>
<td style="text-align:right;">
4.14
</td>
<td style="text-align:right;">
58485
</td>
<td style="text-align:right;">
68551
</td>
<td style="text-align:right;">
4.78
</td>
<td style="text-align:right;">
9.02
</td>
<td style="text-align:right;">
0.887
</td>
<td style="text-align:right;">
0.710
</td>
<td style="text-align:right;">
3549
</td>
<td style="text-align:right;">
0.901
</td>
<td style="text-align:right;">
0.721
</td>
<td style="text-align:right;">
3604
</td>
<td style="text-align:right;">
650
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3549
</td>
<td style="text-align:right;">
0.710
</td>
<td style="text-align:right;">
3604
</td>
<td style="text-align:right;">
0.721
</td>
<td style="text-align:right;">
0.901
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
sicker
</td>
<td style="text-align:right;">
0.901
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
7.75
</td>
<td style="text-align:right;">
4.14
</td>
<td style="text-align:right;">
58485
</td>
<td style="text-align:right;">
68551
</td>
<td style="text-align:right;">
4.78
</td>
<td style="text-align:right;">
9.02
</td>
<td style="text-align:right;">
6.867
</td>
<td style="text-align:right;">
3.434
</td>
<td style="text-align:right;">
54937
</td>
<td style="text-align:right;">
8.118
</td>
<td style="text-align:right;">
4.059
</td>
<td style="text-align:right;">
64947
</td>
<td style="text-align:right;">
521
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
54937
</td>
<td style="text-align:right;">
3.434
</td>
<td style="text-align:right;">
64947
</td>
<td style="text-align:right;">
4.059
</td>
<td style="text-align:right;">
9.019
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
death
</td>
<td style="text-align:right;">
9.019
</td>
<td style="text-align:right;">
0.901
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
7.75
</td>
<td style="text-align:right;">
4.14
</td>
<td style="text-align:right;">
58485
</td>
<td style="text-align:right;">
68551
</td>
<td style="text-align:right;">
4.78
</td>
<td style="text-align:right;">
9.02
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
32
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
9.019
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
sick
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
10.94
</td>
<td style="text-align:right;">
5.57
</td>
<td style="text-align:right;">
86287
</td>
<td style="text-align:right;">
108582
</td>
<td style="text-align:right;">
6.96
</td>
<td style="text-align:right;">
13.73
</td>
<td style="text-align:right;">
0.317
</td>
<td style="text-align:right;">
0.253
</td>
<td style="text-align:right;">
1266
</td>
<td style="text-align:right;">
0.318
</td>
<td style="text-align:right;">
0.255
</td>
<td style="text-align:right;">
1273
</td>
<td style="text-align:right;">
650
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1266
</td>
<td style="text-align:right;">
0.253
</td>
<td style="text-align:right;">
1273
</td>
<td style="text-align:right;">
0.255
</td>
<td style="text-align:right;">
0.318
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
sicker
</td>
<td style="text-align:right;">
0.318
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
10.94
</td>
<td style="text-align:right;">
5.57
</td>
<td style="text-align:right;">
86287
</td>
<td style="text-align:right;">
108582
</td>
<td style="text-align:right;">
6.96
</td>
<td style="text-align:right;">
13.73
</td>
<td style="text-align:right;">
10.628
</td>
<td style="text-align:right;">
5.314
</td>
<td style="text-align:right;">
85020
</td>
<td style="text-align:right;">
13.414
</td>
<td style="text-align:right;">
6.707
</td>
<td style="text-align:right;">
107309
</td>
<td style="text-align:right;">
609
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
85020
</td>
<td style="text-align:right;">
5.314
</td>
<td style="text-align:right;">
107309
</td>
<td style="text-align:right;">
6.707
</td>
<td style="text-align:right;">
13.732
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
death
</td>
<td style="text-align:right;">
13.732
</td>
<td style="text-align:right;">
0.318
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
10.94
</td>
<td style="text-align:right;">
5.57
</td>
<td style="text-align:right;">
86287
</td>
<td style="text-align:right;">
108582
</td>
<td style="text-align:right;">
6.96
</td>
<td style="text-align:right;">
13.73
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
405
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
13.732
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
sick
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
8.61
</td>
<td style="text-align:right;">
5.24
</td>
<td style="text-align:right;">
56449
</td>
<td style="text-align:right;">
68546
</td>
<td style="text-align:right;">
6.10
</td>
<td style="text-align:right;">
10.22
</td>
<td style="text-align:right;">
3.116
</td>
<td style="text-align:right;">
2.493
</td>
<td style="text-align:right;">
12463
</td>
<td style="text-align:right;">
3.296
</td>
<td style="text-align:right;">
2.637
</td>
<td style="text-align:right;">
13183
</td>
<td style="text-align:right;">
650
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
12463
</td>
<td style="text-align:right;">
2.493
</td>
<td style="text-align:right;">
13183
</td>
<td style="text-align:right;">
2.637
</td>
<td style="text-align:right;">
3.296
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
sicker
</td>
<td style="text-align:right;">
3.296
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
8.61
</td>
<td style="text-align:right;">
5.24
</td>
<td style="text-align:right;">
56449
</td>
<td style="text-align:right;">
68546
</td>
<td style="text-align:right;">
6.10
</td>
<td style="text-align:right;">
10.22
</td>
<td style="text-align:right;">
5.498
</td>
<td style="text-align:right;">
2.749
</td>
<td style="text-align:right;">
43986
</td>
<td style="text-align:right;">
6.920
</td>
<td style="text-align:right;">
3.460
</td>
<td style="text-align:right;">
55363
</td>
<td style="text-align:right;">
266
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
43986
</td>
<td style="text-align:right;">
2.749
</td>
<td style="text-align:right;">
55363
</td>
<td style="text-align:right;">
3.460
</td>
<td style="text-align:right;">
10.216
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>We can also check the evolution of the free beds over time per arm.
As it can be seen, 650 beds is just enough for the <code>int</code> arm
to handle all the requests, however in the <code>noint</code> arm there
are a few patients which must queue for some time. Note that the same
thing we do to see the number of free beds could be used to understand
the % of patients that were able to use a bed, etc. WARDEN is flexible
in that sense, one just needs to keep track of those numbers. For
example, below we can see that around 15% of the <code>noint</code>
patients had to queue at a certain point. We can also track things like
queuing time, etc. In this case, for these 15% of patients, the average
queuing time was around 9 months.</p>
<p><img src="example_ssd_constrained_files/figure-html/post-processing_analysis-1.png" width="700"><img src="example_ssd_constrained_files/figure-html/post-processing_analysis-2.png" width="700"></p>
<pre><code><span><span class="co">#&gt; Warning: Removed 1883 rows containing non-finite outside the scale range</span></span>
<span><span class="co">#&gt; (`stat_bin()`).</span></span></code></pre>
<p><img src="example_ssd_constrained_files/figure-html/post-processing_analysis-3.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="sensitivity-analysis">Sensitivity Analysis<a class="anchor" aria-label="anchor" href="#sensitivity-analysis"></a>
</h2>
<div class="section level3">
<h3 id="run-model-with-constrained-false">Run model with constrained = FALSE<a class="anchor" aria-label="anchor" href="#run-model-with-constrained-false"></a>
</h3>
<p>It can be seen that with <code>constrained = FALSE</code>, the
results are equivalent to the SSD standard vignette. Furthermore, if the
model is run with constrained = TRUE but in such a way that the
constraint does not bind (e.g., with 1000+ beds) then the results are
also equivalent. If the model is run with
<code>constrained = FALSE</code>, then shared inputs and resources are
no longer shared. This allows to very quickly evaluate how the model
outputs change when resources are constrained vs. when they are not.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Logic is: per patient, per intervention, per event, react to that event.</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sim.html">run_sim</a></span><span class="op">(</span>  </span>
<span>  npats<span class="op">=</span><span class="fl">1000</span>,                               <span class="co"># number of patients to be simulated</span></span>
<span>  n_sim<span class="op">=</span><span class="fl">1</span>,                                  <span class="co"># number of simulations to run</span></span>
<span>  psa_bool <span class="op">=</span> <span class="cn">FALSE</span>,                         <span class="co"># use PSA or not. If n_sim &gt; 1 and psa_bool = FALSE, then difference in outcomes is due to sampling (number of pats simulated)  </span></span>
<span>  arm_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"noint"</span><span class="op">)</span>,             <span class="co"># intervention list</span></span>
<span>  common_all_inputs <span class="op">=</span> <span class="va">common_all_inputs</span>,    <span class="co"># inputs common that do not change within a simulation</span></span>
<span>  common_pt_inputs <span class="op">=</span> <span class="va">common_pt_inputs</span>,      <span class="co"># inputs that change within a simulation but are not affected by the intervention</span></span>
<span>  unique_pt_inputs <span class="op">=</span> <span class="va">unique_pt_inputs</span>,</span>
<span>  init_event_list <span class="op">=</span> <span class="va">init_event_list</span>,        <span class="co"># initial event list</span></span>
<span>  evt_react_list <span class="op">=</span> <span class="va">evt_react_list</span>,          <span class="co"># reaction of events</span></span>
<span>  util_ongoing_list <span class="op">=</span> <span class="va">util_ongoing</span>,</span>
<span>  cost_ongoing_list <span class="op">=</span> <span class="va">cost_ongoing</span>,</span>
<span>  constrained <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ipd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  input_out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"beds_free"</span>,<span class="st">"had_to_queue"</span>,<span class="st">"time_in_queue"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis number: 1</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.81s</span></span>
<span><span class="co">#&gt; Time to run analysis 1: 0.81s</span></span>
<span><span class="co">#&gt; Total time to run: 0.81s</span></span>
<span><span class="co">#&gt; Simulation finalized;</span></span>
<span></span>
<span><span class="fu"><a href="../reference/summary_results_det.html">summary_results_det</a></span><span class="op">(</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co">#print first simulation</span></span>
<span><span class="co">#&gt;                        int    noint</span></span>
<span><span class="co">#&gt; costs             58978.88 51768.23</span></span>
<span><span class="co">#&gt; dcosts                0.00  7210.66</span></span>
<span><span class="co">#&gt; lys                   9.72     9.72</span></span>
<span><span class="co">#&gt; dlys                  0.00     0.00</span></span>
<span><span class="co">#&gt; qalys                 6.27     6.08</span></span>
<span><span class="co">#&gt; dqalys                0.00     0.19</span></span>
<span><span class="co">#&gt; ICER                    NA      Inf</span></span>
<span><span class="co">#&gt; ICUR                    NA 38286.46</span></span>
<span><span class="co">#&gt; INMB                    NA  2206.06</span></span>
<span><span class="co">#&gt; costs_undisc      74324.03 65474.81</span></span>
<span><span class="co">#&gt; dcosts_undisc         0.00  8849.22</span></span>
<span><span class="co">#&gt; lys_undisc           11.99    11.99</span></span>
<span><span class="co">#&gt; dlys_undisc           0.00     0.00</span></span>
<span><span class="co">#&gt; qalys_undisc          7.62     7.38</span></span>
<span><span class="co">#&gt; dqalys_undisc         0.00     0.24</span></span>
<span><span class="co">#&gt; ICER_undisc             NA      Inf</span></span>
<span><span class="co">#&gt; ICUR_undisc             NA 37557.56</span></span>
<span><span class="co">#&gt; INMB_undisc             NA  2931.65</span></span>
<span><span class="co">#&gt; beds_free           650.00   650.00</span></span>
<span><span class="co">#&gt; dbeds_free            0.00     0.00</span></span>
<span><span class="co">#&gt; c_default         58978.88 51768.23</span></span>
<span><span class="co">#&gt; dc_default            0.00  7210.66</span></span>
<span><span class="co">#&gt; c_default_undisc  74324.03 65474.81</span></span>
<span><span class="co">#&gt; dc_default_undisc     0.00  8849.22</span></span>
<span><span class="co">#&gt; had_to_queue          0.00     0.00</span></span>
<span><span class="co">#&gt; dhad_to_queue         0.00     0.00</span></span>
<span><span class="co">#&gt; q_default             6.27     6.08</span></span>
<span><span class="co">#&gt; dq_default            0.00     0.19</span></span>
<span><span class="co">#&gt; q_default_undisc      7.62     7.38</span></span>
<span><span class="co">#&gt; dq_default_undisc     0.00     0.24</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-model-constrained-but-unbinding">Run model constrained but unbinding<a class="anchor" aria-label="anchor" href="#run-model-constrained-but-unbinding"></a>
</h3>
<p>If the model is run with <code>constrainted = TRUE</code> but in such
a way that the constraint does not bind (e.g., with 1000+ beds) then the
results are also equivalent to <code>constrained = FALSE</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">common_all_inputs</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span>input <span class="op">=</span> <span class="op">{</span></span>
<span>                      <span class="va">util.sick</span>   <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span>                      <span class="va">util.sicker</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span>                      <span class="va">cost.sick</span>   <span class="op">&lt;-</span> <span class="fl">3000</span></span>
<span>                      <span class="va">cost.sicker</span> <span class="op">&lt;-</span> <span class="fl">7000</span></span>
<span>                      <span class="va">cost.int</span>    <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span>                      <span class="va">coef_noint</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span></span>
<span>                      <span class="va">HR_int</span>      <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span>                      <span class="va">drc</span>         <span class="op">&lt;-</span> <span class="fl">0.035</span> <span class="co">#different values than what's assumed by default</span></span>
<span>                      <span class="va">drq</span>         <span class="op">&lt;-</span> <span class="fl">0.035</span></span>
<span>                      <span class="va">random_seed_sicker_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fl">100000</span>,<span class="va">npats</span>,replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>                      <span class="va">beds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resource_discrete.html">resource_discrete</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span>
<span>                      <span class="va">beds_free</span> <span class="op">&lt;-</span> <span class="va">beds</span><span class="op">$</span><span class="fu">n_free</span><span class="op">(</span><span class="op">)</span></span>
<span>                      <span class="va">shared_accumulator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/shared_input.html">shared_input</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span>                      <span class="va">value_accum</span> <span class="op">&lt;-</span> <span class="va">shared_accumulator</span><span class="op">$</span><span class="fu">value</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co">#Logic is: per patient, per intervention, per event, react to that event.</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sim.html">run_sim</a></span><span class="op">(</span>  </span>
<span>  npats<span class="op">=</span><span class="fl">1000</span>,                               <span class="co"># number of patients to be simulated</span></span>
<span>  n_sim<span class="op">=</span><span class="fl">1</span>,                                  <span class="co"># number of simulations to run</span></span>
<span>  psa_bool <span class="op">=</span> <span class="cn">FALSE</span>,                         <span class="co"># use PSA or not. If n_sim &gt; 1 and psa_bool = FALSE, then difference in outcomes is due to sampling (number of pats simulated)  </span></span>
<span>  arm_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"noint"</span><span class="op">)</span>,             <span class="co"># intervention list</span></span>
<span>  common_all_inputs <span class="op">=</span> <span class="va">common_all_inputs</span>,    <span class="co"># inputs common that do not change within a simulation</span></span>
<span>  common_pt_inputs <span class="op">=</span> <span class="va">common_pt_inputs</span>,      <span class="co"># inputs that change within a simulation but are not affected by the intervention</span></span>
<span>  unique_pt_inputs <span class="op">=</span> <span class="va">unique_pt_inputs</span>,</span>
<span>  init_event_list <span class="op">=</span> <span class="va">init_event_list</span>,        <span class="co"># initial event list</span></span>
<span>  evt_react_list <span class="op">=</span> <span class="va">evt_react_list</span>,          <span class="co"># reaction of events</span></span>
<span>  util_ongoing_list <span class="op">=</span> <span class="va">util_ongoing</span>,</span>
<span>  cost_ongoing_list <span class="op">=</span> <span class="va">cost_ongoing</span>,</span>
<span>  constrained <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ipd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  input_out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"beds_free"</span>,<span class="st">"had_to_queue"</span>,<span class="st">"time_in_queue"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis number: 1</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.81s</span></span>
<span><span class="co">#&gt; Time to run analysis 1: 0.81s</span></span>
<span><span class="co">#&gt; Total time to run: 0.82s</span></span>
<span><span class="co">#&gt; Simulation finalized;</span></span>
<span></span>
<span><span class="fu"><a href="../reference/summary_results_det.html">summary_results_det</a></span><span class="op">(</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co">#print first simulation</span></span>
<span><span class="co">#&gt;                        int    noint</span></span>
<span><span class="co">#&gt; costs             58978.88 51768.23</span></span>
<span><span class="co">#&gt; dcosts                0.00  7210.66</span></span>
<span><span class="co">#&gt; lys                   9.72     9.72</span></span>
<span><span class="co">#&gt; dlys                  0.00     0.00</span></span>
<span><span class="co">#&gt; qalys                 6.27     6.08</span></span>
<span><span class="co">#&gt; dqalys                0.00     0.19</span></span>
<span><span class="co">#&gt; ICER                    NA      Inf</span></span>
<span><span class="co">#&gt; ICUR                    NA 38286.46</span></span>
<span><span class="co">#&gt; INMB                    NA  2206.06</span></span>
<span><span class="co">#&gt; costs_undisc      74324.03 65474.81</span></span>
<span><span class="co">#&gt; dcosts_undisc         0.00  8849.22</span></span>
<span><span class="co">#&gt; lys_undisc           11.99    11.99</span></span>
<span><span class="co">#&gt; dlys_undisc           0.00     0.00</span></span>
<span><span class="co">#&gt; qalys_undisc          7.62     7.38</span></span>
<span><span class="co">#&gt; dqalys_undisc         0.00     0.24</span></span>
<span><span class="co">#&gt; ICER_undisc             NA      Inf</span></span>
<span><span class="co">#&gt; ICUR_undisc             NA 37557.56</span></span>
<span><span class="co">#&gt; INMB_undisc             NA  2931.65</span></span>
<span><span class="co">#&gt; beds_free           611.50   576.97</span></span>
<span><span class="co">#&gt; dbeds_free            0.00    34.53</span></span>
<span><span class="co">#&gt; c_default         58978.88 51768.23</span></span>
<span><span class="co">#&gt; dc_default            0.00  7210.66</span></span>
<span><span class="co">#&gt; c_default_undisc  74324.03 65474.81</span></span>
<span><span class="co">#&gt; dc_default_undisc     0.00  8849.22</span></span>
<span><span class="co">#&gt; had_to_queue          0.00     0.00</span></span>
<span><span class="co">#&gt; dhad_to_queue         0.00     0.00</span></span>
<span><span class="co">#&gt; q_default             6.27     6.08</span></span>
<span><span class="co">#&gt; dq_default            0.00     0.19</span></span>
<span><span class="co">#&gt; q_default_undisc      7.62     7.38</span></span>
<span><span class="co">#&gt; dq_default_undisc     0.00     0.24</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="inputs">Inputs<a class="anchor" aria-label="anchor" href="#inputs"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Load some data</span></span>
<span><span class="va">list_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>parameter_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"util.sick"</span>,<span class="st">"util.sicker"</span>,<span class="st">"cost.sick"</span>,<span class="st">"cost.sicker"</span>,<span class="st">"cost.int"</span>,<span class="st">"coef_noint"</span>,<span class="st">"HR_int"</span><span class="op">)</span>,</span>
<span>                              base_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">0.8</span>,<span class="fl">0.5</span>,<span class="fl">3000</span>,<span class="fl">7000</span>,<span class="fl">1000</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>,<span class="fl">0.8</span><span class="op">)</span>,</span>
<span>                              DSA_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">0.6</span>,<span class="fl">0.3</span>,<span class="fl">1000</span>,<span class="fl">5000</span>,<span class="fl">800</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>,<span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                              DSA_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">0.9</span>,<span class="fl">0.7</span>,<span class="fl">5000</span>,<span class="fl">9000</span>,<span class="fl">2000</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.4</span><span class="op">)</span>,<span class="fl">0.9</span><span class="op">)</span>,</span>
<span>                              PSA_dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"rnorm"</span>,<span class="st">"rbeta_mse"</span>,<span class="st">"rgamma_mse"</span>,<span class="st">"rgamma_mse"</span>,<span class="st">"rgamma_mse"</span>,<span class="st">"rnorm"</span>,<span class="st">"rlnorm"</span><span class="op">)</span>,</span>
<span>                              a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">0.8</span>,<span class="fl">0.5</span>,<span class="fl">3000</span>,<span class="fl">7000</span>,<span class="fl">1000</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                              b<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">0.8</span>,<span class="fl">0.5</span>,<span class="fl">3000</span>,<span class="fl">7000</span>,<span class="fl">1000</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                              scenario_1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">0.6</span>,<span class="fl">0.3</span>,<span class="fl">1000</span>,<span class="fl">5000</span>,<span class="fl">800</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>,<span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                              scenario_2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">0.9</span>,<span class="fl">0.7</span>,<span class="fl">5000</span>,<span class="fl">9000</span>,<span class="fl">2000</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.4</span><span class="op">)</span>,<span class="fl">0.9</span><span class="op">)</span></span>
<span>                              <span class="op">)</span></span>
<span></span>
<span><span class="va">sensitivity_inputs</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span></span>
<span>            indicators <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">sensitivity_bool</span><span class="op">)</span><span class="op">{</span> <span class="fu"><a href="../reference/create_indicators.html">create_indicators</a></span><span class="op">(</span><span class="va">sens</span>,<span class="va">n_sensitivity</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sensitivity_names</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">list_par</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">list_par</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">}</span> <span class="co">#vector of indicators, value 0 everywhere except at sens, where it takes value 1 (for dsa_min and dsa_max, if not sensitivity analysis, then we activate all of them, i.e., in a PSA)</span></span>
<span>                              <span class="op">)</span></span>
<span></span>
<span><span class="va">common_all_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="../reference/pick_val_v.html">pick_val_v</a></span><span class="op">(</span>base        <span class="op">=</span> <span class="va">list_par</span><span class="op">[[</span><span class="st">"base_value"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                       psa         <span class="op">=</span> <span class="fu"><a href="../reference/pick_psa.html">pick_psa</a></span><span class="op">(</span><span class="va">list_par</span><span class="op">[[</span><span class="st">"PSA_dist"</span><span class="op">]</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">list_par</span><span class="op">[[</span><span class="st">"PSA_dist"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,<span class="va">list_par</span><span class="op">[[</span><span class="st">"a"</span><span class="op">]</span><span class="op">]</span>,<span class="va">list_par</span><span class="op">[[</span><span class="st">"b"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                       sens        <span class="op">=</span> <span class="va">list_par</span><span class="op">[[</span><span class="va">sens_name_used</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                       psa_ind     <span class="op">=</span> <span class="va">psa_bool</span>,</span>
<span>                       sens_ind    <span class="op">=</span> <span class="va">sensitivity_bool</span>,</span>
<span>                       indicator   <span class="op">=</span> <span class="va">indicators</span>,</span>
<span>                       names_out   <span class="op">=</span> <span class="va">list_par</span><span class="op">[[</span><span class="st">"parameter_name"</span><span class="op">]</span><span class="op">]</span></span>
<span>                       <span class="op">)</span></span>
<span>            <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span>input <span class="op">=</span> <span class="op">{</span></span>
<span>    <span class="va">random_seed_sicker_i</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>,<span class="fl">1000</span>,replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co">#we don't add this variable to the sensitivity analysis</span></span>
<span>    <span class="va">beds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resource_discrete.html">resource_discrete</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span>
<span>    <span class="va">beds_free</span> <span class="op">&lt;-</span> <span class="va">beds</span><span class="op">$</span><span class="fu">n_free</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">shared_accumulator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/shared_input.html">shared_input</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="va">value_accum</span> <span class="op">&lt;-</span> <span class="va">shared_accumulator</span><span class="op">$</span><span class="fu">value</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-execution-1">Model Execution<a class="anchor" aria-label="anchor" href="#model-execution-1"></a>
</h3>
<p>The model is executed as before, just adding the
<code>sensitivity_inputs</code>, <code>sensitivity_names</code>,
<code>sensitivity_bool</code> and <code>n_sensitivity</code> arguments.
Note that the total number of sensitivity iterations is given not by
n_sensitivity, but by n_sensitivity * length(sensitivity_names), so in
this case it will be 2 x n_sensitivity, or 2 x 7 = 14. For two scenario
analysis it would be 2 x 1 = 2, with the <code>indicators</code>
variable defined in the previous section taking value 1 for all the
variables altered in the scenario, and 0 otherwise.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sim.html">run_sim</a></span><span class="op">(</span>  </span>
<span>  npats<span class="op">=</span><span class="fl">100</span>,                               <span class="co"># number of patients to be simulated</span></span>
<span>  n_sim<span class="op">=</span><span class="fl">1</span>,                                  <span class="co"># number of simulations to run</span></span>
<span>  psa_bool <span class="op">=</span> <span class="cn">FALSE</span>,                         <span class="co"># use PSA or not. If n_sim &gt; 1 and psa_bool = FALSE, then difference in outcomes is due to sampling (number of pats simulated)  </span></span>
<span>  arm_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"noint"</span><span class="op">)</span>,             <span class="co"># intervention list</span></span>
<span>  common_all_inputs <span class="op">=</span> <span class="va">common_all_inputs</span>,    <span class="co"># inputs common that do not change within a simulation</span></span>
<span>  common_pt_inputs <span class="op">=</span> <span class="va">common_pt_inputs</span>,      <span class="co"># inputs that change within a simulation but are not affected by the intervention</span></span>
<span>  unique_pt_inputs <span class="op">=</span> <span class="va">unique_pt_inputs</span>,      <span class="co"># inputs that change within a simulation between interventions</span></span>
<span>  init_event_list <span class="op">=</span> <span class="va">init_event_list</span>,        <span class="co"># initial event list</span></span>
<span>  evt_react_list <span class="op">=</span> <span class="va">evt_react_list</span>,          <span class="co"># reaction of events</span></span>
<span>  util_ongoing_list <span class="op">=</span> <span class="va">util_ongoing</span>,</span>
<span>  cost_ongoing_list <span class="op">=</span> <span class="va">cost_ongoing</span>,</span>
<span>  sensitivity_inputs <span class="op">=</span> <span class="va">sensitivity_inputs</span>,</span>
<span>  sensitivity_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DSA_min"</span>,<span class="st">"DSA_max"</span><span class="op">)</span>,</span>
<span>  sensitivity_bool <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  constrained <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_sensitivity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">list_par</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  input_out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">list_par</span><span class="op">[[</span><span class="st">"parameter_name"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis number: 1</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.15s</span></span>
<span><span class="co">#&gt; Time to run analysis 1: 0.15s</span></span>
<span><span class="co">#&gt; Analysis number: 2</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.21s</span></span>
<span><span class="co">#&gt; Time to run analysis 2: 0.22s</span></span>
<span><span class="co">#&gt; Analysis number: 3</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.14s</span></span>
<span><span class="co">#&gt; Time to run analysis 3: 0.14s</span></span>
<span><span class="co">#&gt; Analysis number: 4</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.16s</span></span>
<span><span class="co">#&gt; Time to run analysis 4: 0.16s</span></span>
<span><span class="co">#&gt; Analysis number: 5</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.16s</span></span>
<span><span class="co">#&gt; Time to run analysis 5: 0.16s</span></span>
<span><span class="co">#&gt; Analysis number: 6</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.15s</span></span>
<span><span class="co">#&gt; Time to run analysis 6: 0.15s</span></span>
<span><span class="co">#&gt; Analysis number: 7</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.16s</span></span>
<span><span class="co">#&gt; Time to run analysis 7: 0.16s</span></span>
<span><span class="co">#&gt; Analysis number: 8</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.35s</span></span>
<span><span class="co">#&gt; Time to run analysis 8: 0.35s</span></span>
<span><span class="co">#&gt; Analysis number: 9</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.15s</span></span>
<span><span class="co">#&gt; Time to run analysis 9: 0.15s</span></span>
<span><span class="co">#&gt; Analysis number: 10</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.14s</span></span>
<span><span class="co">#&gt; Time to run analysis 10: 0.14s</span></span>
<span><span class="co">#&gt; Analysis number: 11</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.14s</span></span>
<span><span class="co">#&gt; Time to run analysis 11: 0.14s</span></span>
<span><span class="co">#&gt; Analysis number: 12</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.14s</span></span>
<span><span class="co">#&gt; Time to run analysis 12: 0.14s</span></span>
<span><span class="co">#&gt; Analysis number: 13</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.14s</span></span>
<span><span class="co">#&gt; Time to run analysis 13: 0.14s</span></span>
<span><span class="co">#&gt; Analysis number: 14</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.15s</span></span>
<span><span class="co">#&gt; Time to run analysis 14: 0.15s</span></span>
<span><span class="co">#&gt; Total time to run: 2.37s</span></span>
<span><span class="co">#&gt; Simulation finalized;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="check-results">Check results<a class="anchor" aria-label="anchor" href="#check-results"></a>
</h3>
<p>We briefly check below that indeed the engine has been changing the
corresponding parameter value.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">data_sensitivity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_depth.html" class="external-link">map_depth</a></span><span class="op">(</span><span class="va">results</span>,<span class="fl">2</span>, <span class="st">"merged_df"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Check mean value across iterations as PSA is off</span></span>
<span><span class="va">data_sensitivity</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sensitivity</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"util.sick"</span>,<span class="st">"util.sicker"</span>,<span class="st">"cost.sick"</span>,<span class="st">"cost.sicker"</span>,<span class="st">"cost.int"</span>,<span class="st">"coef_noint"</span>,<span class="st">"HR_int"</span><span class="op">)</span>,<span class="va">mean</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 14 × 8</span></span></span>
<span><span class="co">#&gt;    sensitivity util.sick util.sicker cost.sick cost.sicker cost.int coef_noint</span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>           1       0.6         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>           2       0.8         0.3      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>           3       0.8         0.5      <span style="text-decoration: underline;">1</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>           4       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">5</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>           5       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000      800      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>           6       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">2.30</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>           7       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>           8       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>           9       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>          10       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>          11       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>          12       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>          13       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>          14       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: HR_int &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-execution-probabilistic-dsa">Model Execution, probabilistic DSA<a class="anchor" aria-label="anchor" href="#model-execution-probabilistic-dsa"></a>
</h3>
<p>The model is executed as before, just activating the psa_bool
option</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sim.html">run_sim</a></span><span class="op">(</span>  </span>
<span>  npats<span class="op">=</span><span class="fl">100</span>,                               </span>
<span>  n_sim<span class="op">=</span><span class="fl">6</span>,                                  </span>
<span>  psa_bool <span class="op">=</span> <span class="cn">TRUE</span>,                         </span>
<span>  arm_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"noint"</span><span class="op">)</span>,             </span>
<span>  common_all_inputs <span class="op">=</span> <span class="va">common_all_inputs</span>,    </span>
<span>  common_pt_inputs <span class="op">=</span> <span class="va">common_pt_inputs</span>,      </span>
<span>  unique_pt_inputs <span class="op">=</span> <span class="va">unique_pt_inputs</span>,      </span>
<span>  init_event_list <span class="op">=</span> <span class="va">init_event_list</span>,        </span>
<span>  evt_react_list <span class="op">=</span> <span class="va">evt_react_list</span>,          </span>
<span>  util_ongoing_list <span class="op">=</span> <span class="va">util_ongoing</span>,</span>
<span>  cost_ongoing_list <span class="op">=</span> <span class="va">cost_ongoing</span>,</span>
<span>  sensitivity_inputs <span class="op">=</span> <span class="va">sensitivity_inputs</span>,</span>
<span>  sensitivity_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DSA_min"</span>,<span class="st">"DSA_max"</span><span class="op">)</span>,</span>
<span>  sensitivity_bool <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  constrained <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_sensitivity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">list_par</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  input_out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">list_par</span><span class="op">[[</span><span class="st">"parameter_name"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="st">"beds_free"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis number: 1</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.14s</span></span>
<span><span class="co">#&gt; Simulation number: 2</span></span>
<span><span class="co">#&gt; Time to run simulation 2: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 3</span></span>
<span><span class="co">#&gt; Time to run simulation 3: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 4</span></span>
<span><span class="co">#&gt; Time to run simulation 4: 0.14s</span></span>
<span><span class="co">#&gt; Simulation number: 5</span></span>
<span><span class="co">#&gt; Time to run simulation 5: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 6</span></span>
<span><span class="co">#&gt; Time to run simulation 6: 0.15s</span></span>
<span><span class="co">#&gt; Time to run analysis 1: 0.88s</span></span>
<span><span class="co">#&gt; Analysis number: 2</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.14s</span></span>
<span><span class="co">#&gt; Simulation number: 2</span></span>
<span><span class="co">#&gt; Time to run simulation 2: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 3</span></span>
<span><span class="co">#&gt; Time to run simulation 3: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 4</span></span>
<span><span class="co">#&gt; Time to run simulation 4: 0.14s</span></span>
<span><span class="co">#&gt; Simulation number: 5</span></span>
<span><span class="co">#&gt; Time to run simulation 5: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 6</span></span>
<span><span class="co">#&gt; Time to run simulation 6: 0.15s</span></span>
<span><span class="co">#&gt; Time to run analysis 2: 0.9s</span></span>
<span><span class="co">#&gt; Analysis number: 3</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.14s</span></span>
<span><span class="co">#&gt; Simulation number: 2</span></span>
<span><span class="co">#&gt; Time to run simulation 2: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 3</span></span>
<span><span class="co">#&gt; Time to run simulation 3: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 4</span></span>
<span><span class="co">#&gt; Time to run simulation 4: 0.14s</span></span>
<span><span class="co">#&gt; Simulation number: 5</span></span>
<span><span class="co">#&gt; Time to run simulation 5: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 6</span></span>
<span><span class="co">#&gt; Time to run simulation 6: 0.16s</span></span>
<span><span class="co">#&gt; Time to run analysis 3: 0.91s</span></span>
<span><span class="co">#&gt; Analysis number: 4</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 2</span></span>
<span><span class="co">#&gt; Time to run simulation 2: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 3</span></span>
<span><span class="co">#&gt; Time to run simulation 3: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 4</span></span>
<span><span class="co">#&gt; Time to run simulation 4: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 5</span></span>
<span><span class="co">#&gt; Time to run simulation 5: 0.14s</span></span>
<span><span class="co">#&gt; Simulation number: 6</span></span>
<span><span class="co">#&gt; Time to run simulation 6: 0.16s</span></span>
<span><span class="co">#&gt; Time to run analysis 4: 0.91s</span></span>
<span><span class="co">#&gt; Analysis number: 5</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 2</span></span>
<span><span class="co">#&gt; Time to run simulation 2: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 3</span></span>
<span><span class="co">#&gt; Time to run simulation 3: 0.14s</span></span>
<span><span class="co">#&gt; Simulation number: 4</span></span>
<span><span class="co">#&gt; Time to run simulation 4: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 5</span></span>
<span><span class="co">#&gt; Time to run simulation 5: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 6</span></span>
<span><span class="co">#&gt; Time to run simulation 6: 0.21s</span></span>
<span><span class="co">#&gt; Time to run analysis 5: 0.97s</span></span>
<span><span class="co">#&gt; Analysis number: 6</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.14s</span></span>
<span><span class="co">#&gt; Simulation number: 2</span></span>
<span><span class="co">#&gt; Time to run simulation 2: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 3</span></span>
<span><span class="co">#&gt; Time to run simulation 3: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 4</span></span>
<span><span class="co">#&gt; Time to run simulation 4: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 5</span></span>
<span><span class="co">#&gt; Time to run simulation 5: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 6</span></span>
<span><span class="co">#&gt; Time to run simulation 6: 0.14s</span></span>
<span><span class="co">#&gt; Time to run analysis 6: 0.91s</span></span>
<span><span class="co">#&gt; Analysis number: 7</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 2</span></span>
<span><span class="co">#&gt; Time to run simulation 2: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 3</span></span>
<span><span class="co">#&gt; Time to run simulation 3: 0.14s</span></span>
<span><span class="co">#&gt; Simulation number: 4</span></span>
<span><span class="co">#&gt; Time to run simulation 4: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 5</span></span>
<span><span class="co">#&gt; Time to run simulation 5: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 6</span></span>
<span><span class="co">#&gt; Time to run simulation 6: 0.15s</span></span>
<span><span class="co">#&gt; Time to run analysis 7: 0.93s</span></span>
<span><span class="co">#&gt; Analysis number: 8</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 2</span></span>
<span><span class="co">#&gt; Time to run simulation 2: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 3</span></span>
<span><span class="co">#&gt; Time to run simulation 3: 0.14s</span></span>
<span><span class="co">#&gt; Simulation number: 4</span></span>
<span><span class="co">#&gt; Time to run simulation 4: 0.17s</span></span>
<span><span class="co">#&gt; Simulation number: 5</span></span>
<span><span class="co">#&gt; Time to run simulation 5: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 6</span></span>
<span><span class="co">#&gt; Time to run simulation 6: 0.15s</span></span>
<span><span class="co">#&gt; Time to run analysis 8: 0.95s</span></span>
<span><span class="co">#&gt; Analysis number: 9</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 2</span></span>
<span><span class="co">#&gt; Time to run simulation 2: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 3</span></span>
<span><span class="co">#&gt; Time to run simulation 3: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 4</span></span>
<span><span class="co">#&gt; Time to run simulation 4: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 5</span></span>
<span><span class="co">#&gt; Time to run simulation 5: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 6</span></span>
<span><span class="co">#&gt; Time to run simulation 6: 0.16s</span></span>
<span><span class="co">#&gt; Time to run analysis 9: 0.96s</span></span>
<span><span class="co">#&gt; Analysis number: 10</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 2</span></span>
<span><span class="co">#&gt; Time to run simulation 2: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 3</span></span>
<span><span class="co">#&gt; Time to run simulation 3: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 4</span></span>
<span><span class="co">#&gt; Time to run simulation 4: 0.17s</span></span>
<span><span class="co">#&gt; Simulation number: 5</span></span>
<span><span class="co">#&gt; Time to run simulation 5: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 6</span></span>
<span><span class="co">#&gt; Time to run simulation 6: 0.2s</span></span>
<span><span class="co">#&gt; Time to run analysis 10: 1s</span></span>
<span><span class="co">#&gt; Analysis number: 11</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.17s</span></span>
<span><span class="co">#&gt; Simulation number: 2</span></span>
<span><span class="co">#&gt; Time to run simulation 2: 0.18s</span></span>
<span><span class="co">#&gt; Simulation number: 3</span></span>
<span><span class="co">#&gt; Time to run simulation 3: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 4</span></span>
<span><span class="co">#&gt; Time to run simulation 4: 0.18s</span></span>
<span><span class="co">#&gt; Simulation number: 5</span></span>
<span><span class="co">#&gt; Time to run simulation 5: 0.18s</span></span>
<span><span class="co">#&gt; Simulation number: 6</span></span>
<span><span class="co">#&gt; Time to run simulation 6: 0.16s</span></span>
<span><span class="co">#&gt; Time to run analysis 11: 1s</span></span>
<span><span class="co">#&gt; Analysis number: 12</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.18s</span></span>
<span><span class="co">#&gt; Simulation number: 2</span></span>
<span><span class="co">#&gt; Time to run simulation 2: 0.17s</span></span>
<span><span class="co">#&gt; Simulation number: 3</span></span>
<span><span class="co">#&gt; Time to run simulation 3: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 4</span></span>
<span><span class="co">#&gt; Time to run simulation 4: 0.18s</span></span>
<span><span class="co">#&gt; Simulation number: 5</span></span>
<span><span class="co">#&gt; Time to run simulation 5: 0.17s</span></span>
<span><span class="co">#&gt; Simulation number: 6</span></span>
<span><span class="co">#&gt; Time to run simulation 6: 0.16s</span></span>
<span><span class="co">#&gt; Time to run analysis 12: 1.02s</span></span>
<span><span class="co">#&gt; Analysis number: 13</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.18s</span></span>
<span><span class="co">#&gt; Simulation number: 2</span></span>
<span><span class="co">#&gt; Time to run simulation 2: 0.17s</span></span>
<span><span class="co">#&gt; Simulation number: 3</span></span>
<span><span class="co">#&gt; Time to run simulation 3: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 4</span></span>
<span><span class="co">#&gt; Time to run simulation 4: 0.18s</span></span>
<span><span class="co">#&gt; Simulation number: 5</span></span>
<span><span class="co">#&gt; Time to run simulation 5: 0.2s</span></span>
<span><span class="co">#&gt; Simulation number: 6</span></span>
<span><span class="co">#&gt; Time to run simulation 6: 0.16s</span></span>
<span><span class="co">#&gt; Time to run analysis 13: 1.04s</span></span>
<span><span class="co">#&gt; Analysis number: 14</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.17s</span></span>
<span><span class="co">#&gt; Simulation number: 2</span></span>
<span><span class="co">#&gt; Time to run simulation 2: 0.17s</span></span>
<span><span class="co">#&gt; Simulation number: 3</span></span>
<span><span class="co">#&gt; Time to run simulation 3: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 4</span></span>
<span><span class="co">#&gt; Time to run simulation 4: 0.17s</span></span>
<span><span class="co">#&gt; Simulation number: 5</span></span>
<span><span class="co">#&gt; Time to run simulation 5: 0.16s</span></span>
<span><span class="co">#&gt; Simulation number: 6</span></span>
<span><span class="co">#&gt; Time to run simulation 6: 0.16s</span></span>
<span><span class="co">#&gt; Time to run analysis 14: 1s</span></span>
<span><span class="co">#&gt; Total time to run: 13.4s</span></span>
<span><span class="co">#&gt; Simulation finalized;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="check-results-1">Check results<a class="anchor" aria-label="anchor" href="#check-results-1"></a>
</h3>
<p>We briefly check below that indeed the engine has been changing the
corresponding parameter value. As expected, <code>beds_free</code> is
only affected by the <code>HR_int</code> and <code>coef_noint</code>, as
those affect efficacy and therefore how beds are allocated.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">data_sensitivity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_depth.html" class="external-link">map_depth</a></span><span class="op">(</span><span class="va">results</span>,<span class="fl">2</span>, <span class="st">"merged_df"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Check mean value across iterations as PSA is off</span></span>
<span><span class="va">data_sensitivity</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sensitivity</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"util.sick"</span>,<span class="st">"util.sicker"</span>,<span class="st">"cost.sick"</span>,<span class="st">"cost.sicker"</span>,<span class="st">"cost.int"</span>,<span class="st">"coef_noint"</span>,<span class="st">"HR_int"</span>, <span class="st">"beds_free"</span><span class="op">)</span>,<span class="va">mean</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 14 × 9</span></span></span>
<span><span class="co">#&gt;    sensitivity util.sick util.sicker cost.sick cost.sicker cost.int coef_noint</span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>           1     0.6         0.580     <span style="text-decoration: underline;">3</span>156.       <span style="text-decoration: underline;">7</span>974.    <span style="text-decoration: underline;">1</span>061.      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>           2     0.722       0.3       <span style="text-decoration: underline;">3</span>156.       <span style="text-decoration: underline;">7</span>974.    <span style="text-decoration: underline;">1</span>061.      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>           3     0.722       0.580     <span style="text-decoration: underline;">1</span>000        <span style="text-decoration: underline;">7</span>974.    <span style="text-decoration: underline;">1</span>061.      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>           4     0.722       0.580     <span style="text-decoration: underline;">3</span>156.       <span style="text-decoration: underline;">5</span>000     <span style="text-decoration: underline;">1</span>061.      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>           5     0.722       0.580     <span style="text-decoration: underline;">3</span>156.       <span style="text-decoration: underline;">7</span>974.     800       -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>           6     0.725       0.579     <span style="text-decoration: underline;">3</span>140.       <span style="text-decoration: underline;">7</span>957.    <span style="text-decoration: underline;">1</span>065.      -<span style="color: #BB0000;">2.30</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>           7     0.722       0.580     <span style="text-decoration: underline;">3</span>155.       <span style="text-decoration: underline;">7</span>973.    <span style="text-decoration: underline;">1</span>061.      -<span style="color: #BB0000;">1.62</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>           8     0.722       0.580     <span style="text-decoration: underline;">3</span>156.       <span style="text-decoration: underline;">7</span>974.    <span style="text-decoration: underline;">1</span>061.      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>           9     0.722       0.580     <span style="text-decoration: underline;">3</span>156.       <span style="text-decoration: underline;">7</span>974.    <span style="text-decoration: underline;">1</span>061.      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>          10     0.722       0.580     <span style="text-decoration: underline;">3</span>156.       <span style="text-decoration: underline;">7</span>974.    <span style="text-decoration: underline;">1</span>061.      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>          11     0.722       0.580     <span style="text-decoration: underline;">3</span>156.       <span style="text-decoration: underline;">7</span>974.    <span style="text-decoration: underline;">1</span>061.      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>          12     0.722       0.580     <span style="text-decoration: underline;">3</span>156.       <span style="text-decoration: underline;">7</span>974.    <span style="text-decoration: underline;">1</span>061.      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>          13     0.722       0.580     <span style="text-decoration: underline;">3</span>156.       <span style="text-decoration: underline;">7</span>974.    <span style="text-decoration: underline;">1</span>061.      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>          14     0.722       0.580     <span style="text-decoration: underline;">3</span>156.       <span style="text-decoration: underline;">7</span>974.    <span style="text-decoration: underline;">1</span>061.      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: HR_int &lt;dbl&gt;, beds_free &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-execution-simple-psa">Model Execution, Simple PSA<a class="anchor" aria-label="anchor" href="#model-execution-simple-psa"></a>
</h3>
<p>The model is executed as before, just activating the psa_bool option
and deactivating the <code>sensitivity_bool</code> and removing
sensitivity_names and setting <code>n_sensitivity = 1</code></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">common_all_inputs</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span>input <span class="op">=</span> <span class="op">{</span></span>
<span>                      <span class="va">util.sick</span>   <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span>                      <span class="va">util.sicker</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span>                      <span class="va">cost.sick</span>   <span class="op">&lt;-</span> <span class="fl">3000</span></span>
<span>                      <span class="va">cost.sicker</span> <span class="op">&lt;-</span> <span class="fl">7000</span></span>
<span>                      <span class="va">cost.int</span>    <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span>                      <span class="va">coef_noint</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span></span>
<span>                      <span class="va">HR_int</span>      <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span>                      <span class="va">drc</span>         <span class="op">&lt;-</span> <span class="fl">0.035</span> <span class="co">#different values than what's assumed by default</span></span>
<span>                      <span class="va">drq</span>         <span class="op">&lt;-</span> <span class="fl">0.035</span></span>
<span>                      <span class="va">random_seed_sicker_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fl">100000</span>,<span class="va">npats</span>,replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>                      <span class="va">beds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resource_discrete.html">resource_discrete</a></span><span class="op">(</span><span class="fl">65</span><span class="op">)</span></span>
<span>                      <span class="va">beds_free</span> <span class="op">&lt;-</span> <span class="va">beds</span><span class="op">$</span><span class="fu">n_free</span><span class="op">(</span><span class="op">)</span></span>
<span>                      <span class="va">shared_accumulator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/shared_input.html">shared_input</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span>                      <span class="va">value_accum</span> <span class="op">&lt;-</span> <span class="va">shared_accumulator</span><span class="op">$</span><span class="fu">value</span><span class="op">(</span><span class="op">)</span></span>
<span>                      </span>
<span><span class="op">}</span><span class="op">)</span>  </span>
<span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sim.html">run_sim</a></span><span class="op">(</span>  </span>
<span>  npats<span class="op">=</span><span class="fl">100</span>,                               </span>
<span>  n_sim<span class="op">=</span><span class="fl">10</span>,                                  </span>
<span>  psa_bool <span class="op">=</span> <span class="cn">TRUE</span>,                         </span>
<span>  arm_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"noint"</span><span class="op">)</span>,             </span>
<span>  common_all_inputs <span class="op">=</span> <span class="va">common_all_inputs</span>,    </span>
<span>  common_pt_inputs <span class="op">=</span> <span class="va">common_pt_inputs</span>,      </span>
<span>  unique_pt_inputs <span class="op">=</span> <span class="va">unique_pt_inputs</span>,      </span>
<span>  init_event_list <span class="op">=</span> <span class="va">init_event_list</span>,        </span>
<span>  evt_react_list <span class="op">=</span> <span class="va">evt_react_list</span>,          </span>
<span>  util_ongoing_list <span class="op">=</span> <span class="va">util_ongoing</span>,</span>
<span>  cost_ongoing_list <span class="op">=</span> <span class="va">cost_ongoing</span>,</span>
<span>  sensitivity_inputs <span class="op">=</span> <span class="va">sensitivity_inputs</span>,</span>
<span>  sensitivity_bool <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  constrained <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_sensitivity <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  input_out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">list_par</span><span class="op">[[</span><span class="st">"parameter_name"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="st">"beds_free"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis number: 1</span></span>
<span><span class="co">#&gt; Simulation number: 1</span></span>
<span><span class="co">#&gt; Time to run simulation 1: 0.35s</span></span>
<span><span class="co">#&gt; Simulation number: 2</span></span>
<span><span class="co">#&gt; Time to run simulation 2: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 3</span></span>
<span><span class="co">#&gt; Time to run simulation 3: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 4</span></span>
<span><span class="co">#&gt; Time to run simulation 4: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 5</span></span>
<span><span class="co">#&gt; Time to run simulation 5: 0.14s</span></span>
<span><span class="co">#&gt; Simulation number: 6</span></span>
<span><span class="co">#&gt; Time to run simulation 6: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 7</span></span>
<span><span class="co">#&gt; Time to run simulation 7: 0.14s</span></span>
<span><span class="co">#&gt; Simulation number: 8</span></span>
<span><span class="co">#&gt; Time to run simulation 8: 0.15s</span></span>
<span><span class="co">#&gt; Simulation number: 9</span></span>
<span><span class="co">#&gt; Time to run simulation 9: 0.35s</span></span>
<span><span class="co">#&gt; Simulation number: 10</span></span>
<span><span class="co">#&gt; Time to run simulation 10: 0.14s</span></span>
<span><span class="co">#&gt; Time to run analysis 1: 1.88s</span></span>
<span><span class="co">#&gt; Total time to run: 1.88s</span></span>
<span><span class="co">#&gt; Simulation finalized;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="check-results-2">Check results<a class="anchor" aria-label="anchor" href="#check-results-2"></a>
</h3>
<p>We briefly check below that indeed the engine has been changing the
corresponding parameter values, and see how the <code>free_beds</code>
has been changing over time per simulation.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">data_simulation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_depth.html" class="external-link">map_depth</a></span><span class="op">(</span><span class="va">results</span>,<span class="fl">2</span>, <span class="st">"merged_df"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Check mean value across iterations as PSA is off</span></span>
<span><span class="va">data_simulation</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">simulation</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"util.sick"</span>,<span class="st">"util.sicker"</span>,<span class="st">"cost.sick"</span>,<span class="st">"cost.sicker"</span>,<span class="st">"cost.int"</span>,<span class="st">"coef_noint"</span>,<span class="st">"HR_int"</span>, <span class="st">"beds_free"</span><span class="op">)</span>,<span class="va">mean</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 9</span></span></span>
<span><span class="co">#&gt;    simulation util.sick util.sicker cost.sick cost.sicker cost.int coef_noint</span></span>
<span><span class="co">#&gt;         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>          1       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>          2       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>          3       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>          4       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>          5       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>          6       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>          7       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>          8       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>          9       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>         10       0.8         0.5      <span style="text-decoration: underline;">3</span>000        <span style="text-decoration: underline;">7</span>000     <span style="text-decoration: underline;">1</span>000      -<span style="color: #BB0000;">1.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: HR_int &lt;dbl&gt;, beds_free &lt;dbl&gt;</span></span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_simulation</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">evttime</span>,y<span class="op">=</span><span class="va">beds_free</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">simulation</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">arm</span><span class="op">~</span><span class="va">.</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_ssd_constrained_files/figure-html/check_psa-1.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Javier Sanchez Alvarez.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
