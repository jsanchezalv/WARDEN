<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Run simulations in parallel mode (at the simulation level) — run_sim_parallel • WARDEN</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run simulations in parallel mode (at the simulation level) — run_sim_parallel"><meta name="description" content="Run simulations in parallel mode (at the simulation level)"><meta property="og:description" content="Run simulations in parallel mode (at the simulation level)"><meta property="og:image" content="https://jsanchezalv.github.io/WARDEN/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">WARDEN</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html" aria-label="View Index"><span class="fa fa-home"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/example_ssd.html">Example in a Sick-Sicker-Dead Model</a></li>
    <li><a class="dropdown-item" href="../articles/example_ssd_stream.html">Example in a Sick-Sicker-Dead Model - Substreams</a></li>
    <li><a class="dropdown-item" href="../articles/example_eBC.html">Example in Early Breast Cancer</a></li>
    <li><a class="dropdown-item" href="../articles/example_markov.html">Example in a Markov Model</a></li>
    <li><a class="dropdown-item" href="../articles/example_uncertainty.html">Structural and Parametric Uncertainty</a></li>
    <li><a class="dropdown-item" href="../articles/example_ipd.html">Example for Individual Patient Data</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/jsanchezalv/WARDEN" aria-label="View on Github"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Run simulations in parallel mode (at the simulation level)</h1>

      <div class="d-none name"><code>run_sim_parallel.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Run simulations in parallel mode (at the simulation level)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">run_sim_parallel</span><span class="op">(</span></span>
<span>  arm_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"noint"</span><span class="op">)</span>,</span>
<span>  sensitivity_inputs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  common_all_inputs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  common_pt_inputs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  unique_pt_inputs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  init_event_list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  evt_react_list <span class="op">=</span> <span class="va">evt_react_list</span>,</span>
<span>  util_ongoing_list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  util_instant_list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  util_cycle_list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cost_ongoing_list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cost_instant_list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cost_cycle_list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  other_ongoing_list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  other_instant_list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  npats <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  psa_bool <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sensitivity_bool <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  sensitivity_names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_sensitivity <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  ncores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  input_out <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ipd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  timed_freq <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  accum_backwards <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  continue_on_error <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-arm-list">arm_list<a class="anchor" aria-label="anchor" href="#arg-arm-list"></a></dt>
<dd><p>A vector of the names of the interventions evaluated in the simulation</p></dd>


<dt id="arg-sensitivity-inputs">sensitivity_inputs<a class="anchor" aria-label="anchor" href="#arg-sensitivity-inputs"></a></dt>
<dd><p>A list of sensitivity inputs that do not change within a sensitivity in a similar fashion to common_all_inputs, etc</p></dd>


<dt id="arg-common-all-inputs">common_all_inputs<a class="anchor" aria-label="anchor" href="#arg-common-all-inputs"></a></dt>
<dd><p>A list of inputs common across patients that do not change within a simulation</p></dd>


<dt id="arg-common-pt-inputs">common_pt_inputs<a class="anchor" aria-label="anchor" href="#arg-common-pt-inputs"></a></dt>
<dd><p>A list of inputs that change across patients but are not affected by the intervention</p></dd>


<dt id="arg-unique-pt-inputs">unique_pt_inputs<a class="anchor" aria-label="anchor" href="#arg-unique-pt-inputs"></a></dt>
<dd><p>A list of inputs that change across each intervention</p></dd>


<dt id="arg-init-event-list">init_event_list<a class="anchor" aria-label="anchor" href="#arg-init-event-list"></a></dt>
<dd><p>A list of initial events and event times. If no initial events are given, a "Start" event at time 0 is created automatically</p></dd>


<dt id="arg-evt-react-list">evt_react_list<a class="anchor" aria-label="anchor" href="#arg-evt-react-list"></a></dt>
<dd><p>A list of event reactions</p></dd>


<dt id="arg-util-ongoing-list">util_ongoing_list<a class="anchor" aria-label="anchor" href="#arg-util-ongoing-list"></a></dt>
<dd><p>Vector of QALY named variables that are accrued at an ongoing basis (discounted using drq)</p></dd>


<dt id="arg-util-instant-list">util_instant_list<a class="anchor" aria-label="anchor" href="#arg-util-instant-list"></a></dt>
<dd><p>Vector of QALY named variables that are accrued instantaneously at an event (discounted using drq)</p></dd>


<dt id="arg-util-cycle-list">util_cycle_list<a class="anchor" aria-label="anchor" href="#arg-util-cycle-list"></a></dt>
<dd><p>Vector of QALY named variables that are accrued in cycles (discounted using drq)</p></dd>


<dt id="arg-cost-ongoing-list">cost_ongoing_list<a class="anchor" aria-label="anchor" href="#arg-cost-ongoing-list"></a></dt>
<dd><p>Vector of cost named variables that are accrued at an ongoing basis (discounted using drc)</p></dd>


<dt id="arg-cost-instant-list">cost_instant_list<a class="anchor" aria-label="anchor" href="#arg-cost-instant-list"></a></dt>
<dd><p>Vector of cost named variables that are accrued instantaneously at an event (discounted using drc)</p></dd>


<dt id="arg-cost-cycle-list">cost_cycle_list<a class="anchor" aria-label="anchor" href="#arg-cost-cycle-list"></a></dt>
<dd><p>Vector of cost named variables that are accrued in cycles (discounted using drc)</p></dd>


<dt id="arg-other-ongoing-list">other_ongoing_list<a class="anchor" aria-label="anchor" href="#arg-other-ongoing-list"></a></dt>
<dd><p>Vector of other named variables that are accrued at an ongoing basis (discounted using drq)</p></dd>


<dt id="arg-other-instant-list">other_instant_list<a class="anchor" aria-label="anchor" href="#arg-other-instant-list"></a></dt>
<dd><p>Vector of other named variables that are accrued instantaneously at an event (discounted using drq)</p></dd>


<dt id="arg-npats">npats<a class="anchor" aria-label="anchor" href="#arg-npats"></a></dt>
<dd><p>The number of patients to be simulated (it will simulate npats * length(arm_list))</p></dd>


<dt id="arg-n-sim">n_sim<a class="anchor" aria-label="anchor" href="#arg-n-sim"></a></dt>
<dd><p>The number of simulations to run per sensitivity</p></dd>


<dt id="arg-psa-bool">psa_bool<a class="anchor" aria-label="anchor" href="#arg-psa-bool"></a></dt>
<dd><p>A boolean to determine if PSA should be conducted. If n_sim &gt; 1 and psa_bool = FALSE, the differences between simulations will be due to sampling</p></dd>


<dt id="arg-sensitivity-bool">sensitivity_bool<a class="anchor" aria-label="anchor" href="#arg-sensitivity-bool"></a></dt>
<dd><p>A boolean to determine if Scenarios/DSA should be conducted.</p></dd>


<dt id="arg-sensitivity-names">sensitivity_names<a class="anchor" aria-label="anchor" href="#arg-sensitivity-names"></a></dt>
<dd><p>A vector of scenario/DSA names that can be used to select the right sensitivity (e.g., c("Scenario_1", "Scenario_2")). The parameter "sens_name_used" is created from it which corresponds to the one being used for each iteration.</p></dd>


<dt id="arg-n-sensitivity">n_sensitivity<a class="anchor" aria-label="anchor" href="#arg-n-sensitivity"></a></dt>
<dd><p>Number of sensitivity analysis (DSA or Scenarios) to run. It will be interacted with sensitivity_names argument if not null (n_sensitivityitivity = n_sensitivity * length(sensitivity_names)). For DSA, it should be as many parameters as there are. For scenario, it should be 1.</p></dd>


<dt id="arg-ncores">ncores<a class="anchor" aria-label="anchor" href="#arg-ncores"></a></dt>
<dd><p>The number of cores to use for parallel computing</p></dd>


<dt id="arg-input-out">input_out<a class="anchor" aria-label="anchor" href="#arg-input-out"></a></dt>
<dd><p>A vector of variables to be returned in the output data frame</p></dd>


<dt id="arg-ipd">ipd<a class="anchor" aria-label="anchor" href="#arg-ipd"></a></dt>
<dd><p>Integer taking value 0 if no IPD data returned, 1 for full IPD data returned, and 2 IPD data but aggregating events</p></dd>


<dt id="arg-timed-freq">timed_freq<a class="anchor" aria-label="anchor" href="#arg-timed-freq"></a></dt>
<dd><p>If NULL, it does not produce any timed outputs. Otherwise should be a number (e.g., every 1 year)</p></dd>


<dt id="arg-debug">debug<a class="anchor" aria-label="anchor" href="#arg-debug"></a></dt>
<dd><p>If TRUE, will generate a log file</p></dd>


<dt id="arg-accum-backwards">accum_backwards<a class="anchor" aria-label="anchor" href="#arg-accum-backwards"></a></dt>
<dd><p>If TRUE, the ongoing accumulators will count backwards (i.e., the current value is applied until the previous update). If FALSE, the current value is applied between the current event and the next time it is updated.</p></dd>


<dt id="arg-continue-on-error">continue_on_error<a class="anchor" aria-label="anchor" href="#arg-continue-on-error"></a></dt>
<dd><p>If TRUE, on error  at patient stage will attempt to continue to the next simulation (only works if n_sim and/or n_sensitivity are &gt; 1, not at the patient level)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list of lists with the analysis results</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function is slightly different from <code>run_sim</code>.
<code>run_sim</code> allows to run single-core.
<code>run_sim_parallel</code> allows to use multiple-core at the simulation level,
making it more efficient for a large number of simulations relative to <code>run_sim</code> (e.g., for  PSA).</p>
<p>Event ties are processed in the order declared within the <code>init_event_list</code> argument (<code>evts</code> argument within the first sublist of that object).
To do so, the program automatically adds a sequence from to 0 to the (number of events - 1) times 1e-10 to add to the event times when selecting the event with minimum time.
This time has been selected as it's relatively small yet not so small as to be ignored by which.min (see .Machine for more details)</p>
<p>A list of protected objects that should not be used by the user as input names or in the global environment to avoid the risk of overwriting them is as follows:
c("arm", "arm_list", "categories_for_export", "cur_evtlist", "curtime", "evt", "i", "prevtime", "sens", "simulation", "sens_name_used","list_env","uc_lists","npats","ipd").</p>
<p>The engine uses the L'Ecuyer-CMRG for the random number generator.
Note that if ncores &gt; 1, then results per simulation will only be exactly replicable if using run_sim_parallel
(as seeds are automatically transformed to be seven integer seeds -i.e, L'Ecuyer-CMRG seeds-)</p>
<p>If no <code>drc</code> or <code>drq</code> parameters are passed within any of the input lists, these are assigned value 0.03.
Note that the random seeds are set to be unique in their category (i.e., at patient level, patient-arm level, etc.)</p>
<p>Ongoing items will look backward to the last time updated when performing the discounting and accumulation.
This means that the user does not necessarily need to keep updating the value, but only add it when the value
changes looking forward (e.g., o_q = utility at event 1, at event 2 utility does not change, but at event 3 it does,
so we want to make sure to add o_q = utility at event 3 before updating utility. The program will automatically
look back until event 1). Note that in previous versions of the package backward was the default, and now this has switched to forward.</p>
<p>If the <code>cycle</code> lists are used, then it is expected the user will declare as well the name of the variable
pasted with <code>cycle_l</code> and <code>cycle_starttime</code> (e.g., c_default_cycle_l and c_default_cycle_starttime) to
ensure the discounting can be computed using cycles, with cycle_l being the cycle length, and cycle_starttime
being the starting time in which the variable started counting.</p>
<p><code>debug = TRUE</code> will export a log file with the timestamp up the error in the main working directory.
If <code>continue_on_error</code> is set to FALSE, it will only export analysis level inputs due to the parallel engine
(use single-engine for those inputs)</p>
<p><code>continue_on_error</code> will skip the current simulation (so it won't continue for the rest of patient-arms) if TRUE.
Note that this will make the progress bar not correct, as a set of patients that were expected to be run is not.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="fu">run_sim_parallel</span><span class="op">(</span>arm_list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int"</span>,<span class="st">"noint"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>common_all_inputs <span class="op">=</span> <span class="va">common_all_inputs</span>,</span></span>
<span class="r-in"><span>common_pt_inputs <span class="op">=</span> <span class="va">common_pt_inputs</span>,</span></span>
<span class="r-in"><span>unique_pt_inputs <span class="op">=</span> <span class="va">unique_pt_inputs</span>,</span></span>
<span class="r-in"><span>init_event_list <span class="op">=</span> <span class="va">init_event_list</span>,</span></span>
<span class="r-in"><span>evt_react_list <span class="op">=</span> <span class="va">evt_react_list</span>,</span></span>
<span class="r-in"><span>util_ongoing_list <span class="op">=</span> <span class="va">util_ongoing_list</span>,</span></span>
<span class="r-in"><span>util_instant_list <span class="op">=</span> <span class="va">util_instant_list</span>,</span></span>
<span class="r-in"><span>cost_ongoing_list <span class="op">=</span> <span class="va">cost_ongoing_list</span>,</span></span>
<span class="r-in"><span>cost_instant_list <span class="op">=</span> <span class="va">cost_instant_list</span>,</span></span>
<span class="r-in"><span>npats <span class="op">=</span> <span class="fl">500</span>,</span></span>
<span class="r-in"><span>n_sim <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>psa_bool <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>ncores <span class="op">=</span> <span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://parallelly.futureverse.org/reference/availableCores.html" class="external-link">availableCores</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>ipd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Javier Sanchez Alvarez.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

