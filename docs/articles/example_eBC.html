<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="RDICE">
<title>Example in Early Breast Cancer • RDICE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example in Early Breast Cancer">
<meta property="og:description" content="RDICE">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">RDICE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.95</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/example_ssd.html">Example in a Sick-Sicker-Dead Model</a>
    <a class="dropdown-item" href="../articles/example_ssd_stream.html">Example in a Sick-Sicker-Dead Model - Substreams</a>
    <a class="dropdown-item" href="../articles/example_eBC.html">Example in Early Breast Cancer</a>
    <a class="dropdown-item" href="../articles/example_markov.html">Example in a Markov Model</a>
    <a class="dropdown-item" href="../articles/example_uncertainty.html">Structural and Parametric Uncertainty</a>
    <a class="dropdown-item" href="../articles/example_ipd.html">Example for Individual Patient Data</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/javiersanchezalvarezevidera/RDICE">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="example_eBC_files/kePrint-0.0.1/kePrint.js"></script><link href="example_eBC_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Example in Early Breast Cancer</h1>
                        <h4 data-toc-skip class="author">Javier Sanchez
Alvarez and Valerie Aponte Ribero</h4>
            
            <h4 data-toc-skip class="date">November 14, 2024</h4>
      
      
      <div class="d-none name"><code>example_eBC.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document runs a discrete event simulation model in the context
of early breast cancer to show how the functions can be used to generate
a model in only a few steps.</p>
<p>When running a DES, it’s important to consider speed. Simulation
based models can be computationally expensive, which means that using
efficient coding can have a substantial impact on performance.</p>
<div class="section level3">
<h3 id="main-options">Main options<a class="anchor" aria-label="anchor" href="#main-options"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">RDICE</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'dplyr' was built under R version 4.3.2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'ggplot2' was built under R version 4.3.3</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'kableExtra' was built under R version 4.3.2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'kableExtra'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     group_rows</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-concept">Model Concept<a class="anchor" aria-label="anchor" href="#model-concept"></a>
</h3>
<p>Patients start in early breast cancer, and draw times to event.
Patients also draw a probability of going into metastatic breast cancer
or going into remission. If they go into remission, they can have a
metastatic recurrence. At any point in time they can die, depending on
the risk of each disease stage.</p>
</div>
<div class="section level3">
<h3 id="load-data">Load Data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h3>
<p>The dummy data for costs and utility is generated below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Utilities</span></span>
<span><span class="va">df_util</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"util.idfs.ontx"</span> ,<span class="st">"util.idfs.offtx"</span> ,<span class="st">"util.remission"</span> ,<span class="st">"util.recurrence"</span> ,<span class="st">"util.mbc.progression.mbc"</span> ,<span class="st">"util.mbc.pps"</span><span class="op">)</span>,</span>
<span>                         value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="fl">0.8</span>,<span class="fl">0.9</span>,<span class="fl">0.7</span>,<span class="fl">0.6</span>,<span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                         se<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.02</span>,<span class="fl">6</span><span class="op">)</span>,</span>
<span>                         stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#Costs</span></span>
<span><span class="va">df_cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cost.idfs.tx"</span> ,<span class="st">"cost.recurrence"</span> ,<span class="st">"cost.mbc.tx"</span> ,<span class="st">"cost.tx.beva"</span> ,<span class="st">"cost.idfs.txnoint"</span>,</span>
<span>                                  <span class="st">"cost.idfs"</span>,<span class="st">"cost.mbc.progression.mbc"</span>,<span class="st">"cost.mbc.pps"</span>,<span class="st">"cost.2ndline"</span>,<span class="st">"cost.ae"</span><span class="op">)</span>,</span>
<span>                         value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40000</span>,<span class="fl">5000</span>,<span class="fl">3000</span>,<span class="fl">10000</span>,<span class="fl">30000</span>,</span>
<span>                                   <span class="fl">10000</span>,<span class="fl">20000</span>,<span class="fl">30000</span>,<span class="fl">20000</span>,<span class="fl">1000</span><span class="op">)</span>,</span>
<span>                         stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>se<span class="op">=</span> <span class="va">value</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="general-inputs-with-delayed-execution">General inputs with delayed execution<a class="anchor" aria-label="anchor" href="#general-inputs-with-delayed-execution"></a>
</h2>
<p>Initial inputs and flags that will be used in the model can be
defined below. We can define inputs that are common to all patients
(<code>common_all_inputs</code>) within a simulation, inputs that are
unique to a patient independently of the treatment (e.g. natural death,
defined in <code>common_pt_inputs</code>), and inputs that are unique to
that patient and that treatment (<code>unique_pt_inputs</code>). Items
can be included through the <code>add_item</code> function, and can be
used in subsequent items (e.g. below, we define <code>sex_pt</code> and
we use it in <code>nat.os.s</code> to get the background mortality for
that patient). All these inputs are generated before the events and the
reaction to events are executed. Furthermore, the program first executes
<code>common_all_inputs</code>, then <code>common_pt_inputs</code> and
then <code>unique_pt_inputs</code>. So one could use the items generated
in <code>common_all_inputs</code> in <code>unique_pt_inputs</code>.</p>
<p>The flag <code>fl.remission</code> is drawn using a Bernoulli
distribution with probability 0.8. This means that 80% of the patients
will have a remission, while 20% will go into early metastatic BC. Note
that this could also be modeled differently by using a time to remission
and time to early metastatic BC, comparing these and choosing the
pathway depending on which one is smaller.</p>
<p>We also define here the specific utilities and costs that will be
used in the model. We create a named vector that identifies the costs
and utilities, and then we assign them to each specific item. Note that
while <code>util_v</code> or <code>cost_v</code> is a named vector, the
specific items that will be used by the model
(e.g. <code>util.remission</code>) are unnamed. It is strongly
recommended to assign unnamed objects if they are going to be processed
in the model. In this case, we’re only using <code>util_v</code> and
<code>cost_v</code> as an intermediate input and these objects will not
be processed (we just use them to make the code more readable), so it’s
fine if we name them. However, naming the value of
<code>util.remission</code> (e.g. using one bracket instead of two in
<code>util_v[["util.remission"]]</code>) may cause the outputs from the
model to change names, depending on use. This is because of how R works:
it would correspond to a named list with a named vector/element, which R
concatenates, so in this case it would end up generating
<code>qaly.util.remission</code> as an output of the model instead of
just <code>qaly</code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Each patient is identified through "i"</span></span>
<span><span class="co">#Items used in the model should be unnamed numeric/vectors! otherwise if they are processed by model it can lead to strangely named outcomes</span></span>
<span><span class="co">#In this case, util_v is a named vector, but it's not processed by the model. We extract unnamed numerics from it.</span></span>
<span></span>
<span><span class="co">#Put objects here that do not change on any patient or intervention loop</span></span>
<span><span class="va">common_all_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span> <span class="co">#utilities</span></span>
<span>  <span class="fu"><a href="../reference/pick_val_v.html">pick_val_v</a></span><span class="op">(</span></span>
<span>    base <span class="op">=</span>  <span class="va">df_util</span><span class="op">$</span><span class="va">value</span>,</span>
<span>    psa <span class="op">=</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">df_util</span><span class="op">$</span><span class="va">value</span>,<span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">df_util</span><span class="op">$</span><span class="va">se</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    sens <span class="op">=</span> <span class="va">df_util</span><span class="op">$</span><span class="va">value</span>,</span>
<span>    psa_ind <span class="op">=</span> <span class="va">psa_bool</span>,</span>
<span>    sens_ind <span class="op">=</span> <span class="va">sensitivity_bool</span>,</span>
<span>    indicator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_util</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    names_out <span class="op">=</span><span class="va">df_util</span><span class="op">$</span><span class="va">name</span></span>
<span>  <span class="op">)</span>,<span class="co">#costs</span></span>
<span>  <span class="fu"><a href="../reference/pick_val_v.html">pick_val_v</a></span><span class="op">(</span></span>
<span>    base <span class="op">=</span>  <span class="va">df_cost</span><span class="op">$</span><span class="va">value</span>,</span>
<span>    psa <span class="op">=</span> <span class="fu"><a href="../reference/rgamma_mse.html">rgamma_mse</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">df_cost</span><span class="op">$</span><span class="va">value</span>,<span class="va">df_cost</span><span class="op">$</span><span class="va">se</span><span class="op">)</span>,</span>
<span>    sens <span class="op">=</span> <span class="va">df_cost</span><span class="op">$</span><span class="va">value</span>,</span>
<span>    psa_ind <span class="op">=</span> <span class="va">psa_bool</span>,</span>
<span>    sens_ind <span class="op">=</span> <span class="va">sensitivity_bool</span>,</span>
<span>    indicator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_cost</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    names_out <span class="op">=</span><span class="va">df_cost</span><span class="op">$</span><span class="va">name</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#Put objects here that do not change as we loop through interventions for a patient</span></span>
<span><span class="va">common_pt_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span>sex_pt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,p<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,<span class="st">"male"</span>,<span class="st">"female"</span><span class="op">)</span>,</span>
<span>                             nat.os.s <span class="op">=</span> <span class="fu"><a href="../reference/rresgompertz.html">rresgompertz</a></span><span class="op">(</span><span class="fl">1</span>,</span>
<span>                                                     shape<span class="op">=</span><span class="kw">if</span><span class="op">(</span><span class="va">sex_pt</span><span class="op">==</span><span class="st">"male"</span><span class="op">)</span><span class="op">{</span><span class="fl">0.102</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="fl">0.115</span><span class="op">}</span>,</span>
<span>                                                     rate<span class="op">=</span><span class="kw">if</span><span class="op">(</span><span class="va">sex_pt</span><span class="op">==</span><span class="st">"male"</span><span class="op">)</span><span class="op">{</span><span class="fl">0.000016</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="fl">0.0000041</span><span class="op">}</span>,</span>
<span>                                                     lower_bound <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">)</span> <span class="co">#in years, for a patient who is 50yo</span></span>
<span></span>
<span><span class="co">#Put objects here that change as we loop through treatments for each patient (e.g. events can affect fl.tx, but events do not affect nat.os.s)</span></span>
<span><span class="co">#common across arm but changes per pt could be implemented here (if (arm==)... )</span></span>
<span><span class="va">unique_pt_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span></span>
<span>  fl.idfs.ontx             <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  fl.idfs                  <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  fl.mbcs.ontx             <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  fl.mbcs.progression.mbc  <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  fl.tx.beva               <span class="op">=</span> <span class="fl">1</span>,  </span>
<span>  fl.mbcs                  <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  fl.mbcs_2ndline          <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  fl.recurrence            <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  fl.remission             <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0.8</span><span class="op">)</span>, <span class="co">#80% probability of going into remission</span></span>
<span>  q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>  c_default <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">arm</span><span class="op">==</span><span class="st">"noint"</span><span class="op">)</span><span class="op">{</span><span class="va">cost.idfs.txnoint</span><span class="op">*</span> <span class="va">fl.idfs.ontx</span>  <span class="op">+</span> <span class="va">cost.idfs</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="op">(</span><span class="va">cost.idfs.tx</span><span class="op">)</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="va">cost.tx.beva</span> <span class="op">*</span> <span class="va">fl.tx.beva</span> <span class="op">+</span> <span class="va">cost.idfs</span><span class="op">}</span>,</span>
<span>  c_ae <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="events">Events<a class="anchor" aria-label="anchor" href="#events"></a>
</h2>
<div class="section level3">
<h3 id="add-initial-events">Add Initial Events<a class="anchor" aria-label="anchor" href="#add-initial-events"></a>
</h3>
<p>Events are added below through the <code>add_tte</code> function. We
use this function twice, one per intervention. We must define several
arguments: one to indicate the intervention, one to define the names of
the events used, one to define the names of other objects created that
we would like to store (optional, maybe we generate an intermediate
input which is not an event but that we want to save) and the actual
input in which we generate the time to event. Events and other objects
will be automatically initialized to <code>Inf</code>. We draw the times
to event for the patients. This chunk is a bit more complex, so it’s
worth spending a bit of time explaining it.</p>
<p>The <code>init_event_list</code> object is populated by using the
<code>add_tte</code> function twice, one for the “int” strategy and
other for the “noint” strategy. We first declare the <code>start</code>
time to be <code>0</code>.</p>
<p>We then proceed to generate the actual time to event. We use the
<code><a href="../reference/draw_tte.html">draw_tte()</a></code> function to generate the time to event using a
log-normal distribution for the event variables that are of interest.
One should always be aware of how the competing risks interact with each
other. While we have abstracted from these type of corrections here, it
is recommended to have an understanding about how these affect the
results and have a look at the competing risks/semi-competing risks
literature.</p>
<p>Note that in our model, the initial list of events are
<code>start, ttot, ttot.beva, progression.mbc, os, idfs, ttot.early, remission, recurrence and start.early.mbc</code>.
However, other, non-initial events can be defined in the reactions part
seen in the section below.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">init_event_list</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/add_tte.html">add_tte</a></span><span class="op">(</span>arm<span class="op">=</span><span class="st">"int"</span>,</span>
<span>               evts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"start"</span>,<span class="st">"ttot"</span>, <span class="st">"ttot.beva"</span>,<span class="st">"progression.mbc"</span>, <span class="st">"os"</span>,<span class="st">"idfs"</span>,<span class="st">"ttot.early"</span>,<span class="st">"remission"</span>,<span class="st">"recurrence"</span>,<span class="st">"start.early.mbc"</span>,<span class="st">"ae"</span>,<span class="st">"2ndline_mbc"</span><span class="op">)</span>,</span>
<span>               other_inp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"os.early"</span>,<span class="st">"os.mbc"</span><span class="op">)</span>,</span>
<span>               input<span class="op">=</span><span class="op">{</span> <span class="co">#intervention</span></span>
<span>    <span class="va">start</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    </span>
<span>    <span class="co">#Early</span></span>
<span>    </span>
<span>    <span class="va">idfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">2</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> </span>
<span>    <span class="va">ttot.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">2</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>,<span class="va">idfs</span><span class="op">)</span></span>
<span>    <span class="va">ttot.beva</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">2</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">os.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">3</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> </span>
<span>    </span>
<span>    <span class="co">#if patient has remission, check when will recurrence happen</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">fl.remission</span><span class="op">)</span> <span class="op">{</span> </span>
<span>      <span class="va">recurrence</span> <span class="op">&lt;-</span> <span class="va">idfs</span> <span class="op">+</span><span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">2</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">remission</span> <span class="op">&lt;-</span> <span class="va">idfs</span></span>
<span>      </span>
<span>      <span class="co">#if recurrence happens before death</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">os.early</span>,<span class="va">nat.os.s</span><span class="op">)</span><span class="op">&gt;</span><span class="va">recurrence</span><span class="op">)</span> <span class="op">{</span> </span>
<span>        </span>
<span>        <span class="co">#Late metastatic (after finishing idfs and recurrence)</span></span>
<span>        </span>
<span>        <span class="va">os.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">0.8</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">idfs</span>  <span class="op">+</span>  <span class="va">recurrence</span> </span>
<span>        </span>
<span>        <span class="va">progression.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">0.5</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">idfs</span> <span class="op">+</span>  <span class="va">recurrence</span> </span>
<span>        </span>
<span>        <span class="va">ttot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">0.5</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">idfs</span> <span class="op">+</span>  <span class="va">recurrence</span></span>
<span>        </span>
<span>        </span>
<span>      <span class="op">}</span></span>
<span>      </span>
<span>    <span class="op">}</span> <span class="kw">else</span><span class="op">{</span> <span class="co">#If early metastatic</span></span>
<span>      <span class="va">start.early.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">2.3</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">idfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">start.early.mbc</span><span class="op">&lt;</span><span class="va">idfs</span>,<span class="va">start.early.mbc</span>,<span class="va">idfs</span><span class="op">)</span></span>
<span>      <span class="va">ttot.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">start.early.mbc</span><span class="op">&lt;</span><span class="va">idfs</span>,<span class="va">start.early.mbc</span>,<span class="va">idfs</span><span class="op">)</span>,<span class="va">ttot.early</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">os.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">0.8</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">start.early.mbc</span></span>
<span>      </span>
<span>      <span class="va">progression.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">0.5</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">start.early.mbc</span></span>
<span>      </span>
<span>      <span class="va">ttot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">0.5</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">start.early.mbc</span></span>
<span>      </span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">os</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">os.mbc</span>,<span class="va">os.early</span>,<span class="va">nat.os.s</span><span class="op">)</span></span>
<span>    </span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="fu"><a href="../reference/add_tte.html">add_tte</a></span><span class="op">(</span>arm<span class="op">=</span><span class="st">"noint"</span>,</span>
<span>                       evts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"start"</span>,<span class="st">"ttot"</span>, <span class="st">"ttot.beva"</span>,<span class="st">"progression.mbc"</span>, <span class="st">"os"</span>,<span class="st">"idfs"</span>,<span class="st">"ttot.early"</span>,<span class="st">"remission"</span>,<span class="st">"recurrence"</span>,<span class="st">"start.early.mbc"</span><span class="op">)</span>,</span>
<span>                       other_inp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"os.early"</span>,<span class="st">"os.mbc"</span><span class="op">)</span>,                       </span>
<span>                       input<span class="op">=</span><span class="op">{</span>  <span class="co">#reference strategy</span></span>
<span>    <span class="va">start</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span>    <span class="co">#Early</span></span>
<span>    </span>
<span>    <span class="va">idfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">2</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>,beta_tx <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> </span>
<span>    <span class="va">ttot.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">2</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>,beta_tx <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span>,<span class="va">idfs</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">os.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">3</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>,beta_tx <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> </span>
<span>    </span>
<span>    <span class="co">#if patient has remission, check when will recurrence happen</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">fl.remission</span><span class="op">)</span> <span class="op">{</span> </span>
<span>      <span class="va">recurrence</span> <span class="op">&lt;-</span> <span class="va">idfs</span> <span class="op">+</span><span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">2</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">remission</span> <span class="op">&lt;-</span> <span class="va">idfs</span></span>
<span>      </span>
<span>      <span class="co">#if recurrence happens before death</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">os.early</span>,<span class="va">nat.os.s</span><span class="op">)</span><span class="op">&gt;</span><span class="va">recurrence</span><span class="op">)</span> <span class="op">{</span> </span>
<span>        </span>
<span>        <span class="co">#Late metastatic (after finishing idfs and recurrence)</span></span>
<span>        </span>
<span>        <span class="va">os.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">0.8</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">idfs</span>  <span class="op">+</span>  <span class="va">recurrence</span> </span>
<span>        </span>
<span>        <span class="va">progression.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">0.5</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">idfs</span> <span class="op">+</span>  <span class="va">recurrence</span> </span>
<span>        </span>
<span>        <span class="va">ttot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">0.5</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">idfs</span> <span class="op">+</span>  <span class="va">recurrence</span></span>
<span>        </span>
<span>      <span class="op">}</span></span>
<span>      </span>
<span>    <span class="op">}</span> <span class="kw">else</span><span class="op">{</span> <span class="co">#If early metastatic</span></span>
<span>      <span class="va">start.early.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">2.3</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">idfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">start.early.mbc</span><span class="op">&lt;</span><span class="va">idfs</span>,<span class="va">start.early.mbc</span>,<span class="va">idfs</span><span class="op">)</span></span>
<span>      <span class="va">ttot.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">start.early.mbc</span><span class="op">&lt;</span><span class="va">idfs</span>,<span class="va">start.early.mbc</span>,<span class="va">idfs</span><span class="op">)</span>,<span class="va">ttot.early</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">os.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">0.8</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">start.early.mbc</span></span>
<span>      </span>
<span>      <span class="va">progression.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">0.5</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">start.early.mbc</span></span>
<span>      </span>
<span>      <span class="va">ttot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="fl">0.5</span>, coef2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">start.early.mbc</span></span>
<span>      </span>
<span>      </span>
<span>    <span class="op">}</span>    </span>
<span>    <span class="va">os</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">os.mbc</span>,<span class="va">os.early</span>,<span class="va">nat.os.s</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="add-reaction-to-those-events">Add Reaction to Those Events<a class="anchor" aria-label="anchor" href="#add-reaction-to-those-events"></a>
</h3>
<p>Once the initial times of the events have been defined, we also need
to declare how events react and affect each other. To do so, we use the
<code>evt_react_list</code> object and the <code>add_reactevt</code>
function. This function just needs to state which event is affected, and
the actual reaction (usually setting flags to 1 or 0, or creating
new/adjusting events).</p>
<p>There are a series of objects that can be used in this context to
help with the reactions. Apart from the global objects and flags defined
above, we can also use <code>curtime</code> for the current event time,
<code>prevtime</code> for the time of the previous event,
<code>cur_evtlist</code> for the named vector of events that is yet to
happen for that patient, <code>arm</code> for the current treatment in
the loop, <code>evt</code> for the current event being processed,
<code>i</code> expresses the patient iteration, and
<code>simulation</code> the specific simulation (relevant when the
number of simulations is greater than 1). Furthermore, one can also call
any other input/item that has been created before or create new ones.
For example, we could even modify a cost/utility item by changing it
directly, e.g. through
<code>modify_item(list(cost.idfs.tx=500))</code>.</p>
<table class="table">
<colgroup>
<col width="48%">
<col width="52%">
</colgroup>
<thead><tr class="header">
<th>Item</th>
<th>What does it do</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>curtime</code></td>
<td>Current event time (numeric)</td>
</tr>
<tr class="even">
<td><code>prevtime</code></td>
<td>Time of the previous event (numeric)</td>
</tr>
<tr class="odd">
<td><code>cur_evtlist</code></td>
<td>Named vector of events that is yet to happen for that patient (named
numeric vector)</td>
</tr>
<tr class="even">
<td><code>evt</code></td>
<td>Current event being processed (character)</td>
</tr>
<tr class="odd">
<td><code>i</code></td>
<td>Patient being iterated (numeric)</td>
</tr>
<tr class="even">
<td><code>arm</code></td>
<td>Intervention being iterated (character)</td>
</tr>
<tr class="odd">
<td><code>simulation</code></td>
<td>Simulation being iterated (numeric)</td>
</tr>
<tr class="even">
<td><code>sens</code></td>
<td>Sensitivity analysis being iterated (numeric)</td>
</tr>
</tbody>
</table>
<p>The functions to add/modify events and inputs use lists. Whenever
several inputs/events are added or modified, it’s recommended to group
them within one function, as it reduces the computation cost. So rather
than use two <code>modify_item</code> with a list of one element, it’s
better to group them into a single <code>modify_item</code> with a list
of two elements.</p>
<p><code>new_event</code>allows to generate events and add them to the
vector of events. It accepts more than one event.
<code>modify_event</code> allows to modify events (e.g. delay death).
When adding an event, the name of the events and the time of the events
must be defined. When using <code>modify_event</code>, one must indicate
which events are affected and what are the new times of the events. If
the event specified does not exist or has already occurred, it will be
ignored. <code>modify_event</code> with
<code>create_if_null = TRUE</code> argument will also generate events if
they don’t exist. Note that one could potentially omit part of the
modeling set in <code>init_event_list</code> and actually define new
events dynamically through the reactions (we do that below for the
<code>"ae"</code> event). However, this can have an impact in
computation time, so if possible it’s always better to use
<code>init_event_list</code>.</p>
<p><code>modify_item</code> and <code>modify_item_seq</code>allow to
modify and add items. Elements defined within this function are not
evaluated sequentially in <code>modify_item</code> (i.e. defining
<code>modify_item(list(fl.new = 1, var1 = fl.new * 5)))</code> will give
an error if <code>fl.new</code> was not defined outside this function),
while <code>modify_item_seq</code> will do it sequentially at a slightly
bigger computational cost, so both are left as choices for the user.
Note that one can modify costs/utilities by using the construction
<code>type_name_category</code>, where type is either “qaly” or “cost”,
name is the name (e.g., “default”) and category is the category used
(e.g., “instant”), so one could pass <code>cost_default_instant</code>
and modify the cost.</p>
<p>The list of relevant functions to be used within
<code>add_reactevt</code> are:</p>
<table class="table">
<colgroup>
<col width="31%">
<col width="34%">
<col width="34%">
</colgroup>
<thead><tr class="header">
<th>Function</th>
<th>What does it do</th>
<th>How to use it</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../reference/modify_item.html">modify_item()</a></code></td>
<td>Adds &amp; Modifies items/flags/variables for future events</td>
<td><code>modify_item(list("fl.idfs.ontx"=0,"fl.tx.beva"=0))</code></td>
</tr>
<tr class="even">
<td><code><a href="../reference/modify_item_seq.html">modify_item_seq()</a></code></td>
<td>Adds &amp; Modifies items/flags/variables for future events
sequentially</td>
<td><code>modify_item_seq(list("fl.idfs.ontx"=0,"fl.tx.beva"=0))</code></td>
</tr>
<tr class="odd">
<td><code><a href="../reference/new_event.html">new_event()</a></code></td>
<td>Adds events to the vector of events for that patient</td>
<td><code>new_event(rep(list("ae"=curtime + 0.001),5))</code></td>
</tr>
<tr class="even">
<td><code><a href="../reference/modify_event.html">modify_event()</a></code></td>
<td>Modifies (or creates, with <code>create_if_null = TRUE</code>)
existing events by changing their time</td>
<td><code>modify_event(list("os"=curtime +5, "ttot"=curtime+0.0001))</code></td>
</tr>
</tbody>
</table>
<p>The model will run until <code>curtime</code> is set to
<code>Inf</code>, so the event that terminates the model (in this case,
<code>os</code>), should modify <code>curtime</code> and set it to
<code>Inf</code>.</p>
<p>Finally, note that there could be two different ways of accumulating
continuous outcomes, backwards (i.e., in the example below, we would set
q_default = util.sick at the sicker event, and modify the
<code>q_default</code> value in the death event) and forwards (as in the
example below). This option can be modified in the <code>run_sim</code>
function using the <code>accum_backwards</code> argument, which assumes
forwards by default.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">evt_react_list</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"start"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span><span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"ttot"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="va">cost.mbc.tx</span>  <span class="op">*</span> <span class="va">fl.mbcs.ontx</span> <span class="op">+</span> <span class="va">cost.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="va">cost.mbc.pps</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span> <span class="op">+</span> <span class="va">cost.2ndline</span><span class="op">*</span><span class="va">fl.mbcs_2ndline</span>,</span>
<span>                              <span class="st">"fl.mbcs.ontx"</span><span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co">#Flag that patient is now off-treatment</span></span>
<span>                 </span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"ttot.beva"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span><span class="va">cost.mbc.tx</span>  <span class="op">*</span> <span class="va">fl.mbcs.ontx</span> <span class="op">+</span> <span class="va">cost.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="va">cost.mbc.pps</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span> <span class="op">+</span> <span class="va">cost.2ndline</span><span class="op">*</span><span class="va">fl.mbcs_2ndline</span>,</span>
<span>                              <span class="st">"fl.tx.beva"</span><span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co">#Flag that patient is now off-treatment</span></span>
<span>                 </span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"progression.mbc"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="va">cost.mbc.tx</span>  <span class="op">*</span> <span class="va">fl.mbcs.ontx</span> <span class="op">+</span> <span class="va">cost.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="va">cost.mbc.pps</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span> <span class="op">+</span> <span class="va">cost.2ndline</span><span class="op">*</span><span class="va">fl.mbcs_2ndline</span>,</span>
<span>                              <span class="st">"fl.mbcs.progression.mbc"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"fl.mbcs_2ndline"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co">#Flag that patient is progressed and going in 2nd line</span></span>
<span>                 </span>
<span>                 <span class="fu"><a href="../reference/new_event.html">new_event</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"2ndline_mbc"</span> <span class="op">=</span> <span class="va">curtime</span> <span class="op">+</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'exp'</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.08</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span>                 </span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"idfs"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">arm</span><span class="op">==</span><span class="st">"noint"</span><span class="op">)</span><span class="op">{</span><span class="va">cost.idfs.txnoint</span><span class="op">*</span> <span class="va">fl.idfs.ontx</span>  <span class="op">+</span> <span class="va">cost.idfs</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="op">(</span><span class="va">cost.idfs.tx</span><span class="op">)</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="va">cost.tx.beva</span> <span class="op">*</span> <span class="va">fl.tx.beva</span> <span class="op">+</span> <span class="va">cost.idfs</span><span class="op">}</span>,</span>
<span>                              <span class="st">"fl.idfs"</span><span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>                 </span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"ttot.early"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">arm</span><span class="op">==</span><span class="st">"noint"</span><span class="op">)</span><span class="op">{</span><span class="va">cost.idfs.txnoint</span><span class="op">*</span> <span class="va">fl.idfs.ontx</span>  <span class="op">+</span> <span class="va">cost.idfs</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="op">(</span><span class="va">cost.idfs.tx</span><span class="op">)</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="va">cost.tx.beva</span> <span class="op">*</span> <span class="va">fl.tx.beva</span> <span class="op">+</span> <span class="va">cost.idfs</span><span class="op">}</span>,</span>
<span>                              <span class="st">"fl.idfs.ontx"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"fl.tx.beva"</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co">#Flag that patient is now off-treatment</span></span>
<span>                 </span>
<span>                 <span class="va">n_ae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">1</span>,lambda<span class="op">=</span><span class="fl">0.25</span><span class="op">*</span><span class="op">(</span><span class="va">curtime</span> <span class="op">-</span><span class="va">prevtime</span><span class="op">)</span><span class="op">)</span> <span class="co">#1 AE every 4 years</span></span>
<span>                 </span>
<span>                 <span class="kw">if</span> <span class="op">(</span><span class="va">n_ae</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                   <span class="fu"><a href="../reference/new_event.html">new_event</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"ae"</span> <span class="op">=</span> <span class="va">curtime</span> <span class="op">+</span> <span class="fl">0.0001</span><span class="op">)</span>,<span class="va">n_ae</span><span class="op">)</span><span class="op">)</span></span>
<span>                 <span class="op">}</span></span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"remission"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="va">cost.recurrence</span> <span class="op">*</span> <span class="va">fl.recurrence</span>,</span>
<span>                              <span class="st">"fl.remission"</span><span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>                 </span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"recurrence"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="va">cost.recurrence</span> <span class="op">*</span> <span class="va">fl.recurrence</span>,</span>
<span>                              <span class="st">"fl.recurrence"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"fl.remission"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"fl.mbcs"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"fl.mbcs.progression.mbc"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co">#ad-hoc for plot</span></span>
<span>                 </span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"start.early.mbc"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="va">cost.recurrence</span> <span class="op">*</span> <span class="va">fl.recurrence</span>,</span>
<span>                              <span class="st">"fl.mbcs"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"fl.mbcs.progression.mbc"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>                 </span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"2ndline_mbc"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="va">cost.mbc.tx</span>  <span class="op">*</span> <span class="va">fl.mbcs.ontx</span> <span class="op">+</span> <span class="va">cost.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="va">cost.mbc.pps</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span> <span class="op">+</span> <span class="va">cost.2ndline</span><span class="op">*</span><span class="va">fl.mbcs_2ndline</span>,</span>
<span>                              <span class="st">"fl.mbcs_2ndline"</span><span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>                 </span>
<span>                 <span class="va">n_ae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">1</span>,lambda<span class="op">=</span><span class="fl">0.25</span><span class="op">*</span><span class="op">(</span><span class="va">curtime</span> <span class="op">-</span><span class="va">prevtime</span><span class="op">)</span><span class="op">)</span> <span class="co">#1 AE every 4 years</span></span>
<span>                 </span>
<span>                 <span class="kw">if</span> <span class="op">(</span><span class="va">n_ae</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                   <span class="fu"><a href="../reference/new_event.html">new_event</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"ae"</span> <span class="op">=</span> <span class="va">curtime</span> <span class="op">+</span> <span class="fl">0.0001</span><span class="op">)</span>,<span class="va">n_ae</span><span class="op">)</span><span class="op">)</span></span>
<span>                 <span class="op">}</span></span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"ae"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                                  </span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="va">cost.mbc.tx</span>  <span class="op">*</span> <span class="va">fl.mbcs.ontx</span> <span class="op">+</span> <span class="va">cost.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="va">cost.mbc.pps</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span> <span class="op">+</span> <span class="va">cost.2ndline</span><span class="op">*</span><span class="va">fl.mbcs_2ndline</span>,</span>
<span>                              c_ae <span class="op">=</span> <span class="va">cost.ae</span><span class="op">)</span><span class="op">)</span></span>
<span>                 </span>
<span>                 <span class="fu"><a href="../reference/modify_event.html">modify_event</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"os"</span> <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">cur_evtlist</span><span class="op">[[</span><span class="st">"os"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fl">0.125</span>,<span class="va">curtime</span> <span class="op">+</span><span class="fl">0.0001</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span><span class="co">#each AE brings forward death by 1.5 months</span></span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"os"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="va">cost.mbc.tx</span>  <span class="op">*</span> <span class="va">fl.mbcs.ontx</span> <span class="op">+</span> <span class="va">cost.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="va">cost.mbc.pps</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span> <span class="op">+</span> <span class="va">cost.2ndline</span><span class="op">*</span><span class="va">fl.mbcs_2ndline</span>,</span>
<span>                              <span class="st">"fl.tx.beva"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"fl.mbcs.ontx"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"fl.idfs"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"fl.mbcs"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"curtime"</span><span class="op">=</span><span class="cn">Inf</span><span class="op">)</span><span class="op">)</span> </span>
<span>               <span class="op">}</span><span class="op">)</span> </span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="costs-and-utilities">Costs and Utilities<a class="anchor" aria-label="anchor" href="#costs-and-utilities"></a>
</h2>
<p>Costs and utilities are introduced below. However, it’s worth noting
that the model is able to run without costs or utilities.</p>
<p>Utilities/Costs/Other outputs are defined by declaring which object
belongs to utilities/costs/other outputs, and whether they need to be
discounted continuously or discretely (instantaneous). These will be
passed to the <code>run_sim</code> function. ## Utilities</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">util_ongoing</span> <span class="op">&lt;-</span> <span class="st">"q_default"</span></span></code></pre></div>
<div class="section level3">
<h3 id="costs">Costs<a class="anchor" aria-label="anchor" href="#costs"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="va">cost_ongoing</span> <span class="op">&lt;-</span> <span class="st">"c_default"</span></span>
<span></span>
<span><span class="va">cost_instant</span> <span class="op">&lt;-</span>  <span class="st">"c_ae"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="model">Model<a class="anchor" aria-label="anchor" href="#model"></a>
</h2>
<div class="section level3">
<h3 id="model-execution">Model Execution<a class="anchor" aria-label="anchor" href="#model-execution"></a>
</h3>
<p>The model can be run using the function <code>run_sim</code> below.
We must define the number of patients to be simulated, the number of
simulations, whether we want to run a PSA or not, the strategy list, the
inputs, events and reactions defined above, utilities, costs and also if
we want any extra output and the level of ipd data desired to be
exported.</p>
<p>It is worth noting that the <code>psa_bool</code> argument does not
run a PSA automatically, but is rather an additional input/flag of the
model that we use as a reference to determine whether we want to use a
deterministic or stochastic input. As such, it could also be defined in
<code>common_all_inputs</code> as the first item to be defined, and the
result would be the same. However, we recommend it to be defined in
<code>run_sim</code>.</p>
<p>Note that the distribution chosen, the number of events and the
interaction between events can have a substantial impact on the running
time of the model.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Logic is: per patient, per intervention, per event, react to that event.</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sim.html">run_sim</a></span><span class="op">(</span>  </span>
<span>  npats<span class="op">=</span><span class="fl">2000</span>,                              <span class="co"># number of patients to be simulated</span></span>
<span>  n_sim<span class="op">=</span><span class="fl">1</span>,                                  <span class="co"># number of simulations to run</span></span>
<span>  psa_bool <span class="op">=</span> <span class="cn">FALSE</span>,                         <span class="co"># use PSA or not. If n_sim &gt; 1 and psa_bool = FALSE, then difference in outcomes is due to sampling (number of pats simulated)  </span></span>
<span>  arm_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"noint"</span><span class="op">)</span>,             <span class="co"># intervention list</span></span>
<span>  common_all_inputs <span class="op">=</span> <span class="va">common_all_inputs</span>,    <span class="co"># inputs common that do not change within a simulation</span></span>
<span>  common_pt_inputs <span class="op">=</span> <span class="va">common_pt_inputs</span>,      <span class="co"># inputs that change within a simulation but are not affected by the intervention</span></span>
<span>  unique_pt_inputs <span class="op">=</span> <span class="va">unique_pt_inputs</span>,      <span class="co"># inputs that change within a simulation between interventions</span></span>
<span>  init_event_list <span class="op">=</span> <span class="va">init_event_list</span>,        <span class="co"># initial event list</span></span>
<span>  evt_react_list <span class="op">=</span> <span class="va">evt_react_list</span>,          <span class="co"># reaction of events</span></span>
<span>  util_ongoing_list <span class="op">=</span> <span class="va">util_ongoing</span>,</span>
<span>  cost_ongoing_list <span class="op">=</span> <span class="va">cost_ongoing</span>,</span>
<span>  cost_instant_list <span class="op">=</span> <span class="va">cost_instant</span>,</span>
<span>  input_out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>                            <span class="co"># list of additional outputs (Flags, etc) that the user wants to export for each patient and event</span></span>
<span>                <span class="st">"os.early"</span>,</span>
<span>                <span class="st">"os.mbc"</span>,</span>
<span>                <span class="st">"nat.os.s"</span>,</span>
<span>                <span class="st">"sex_pt"</span></span>
<span>                <span class="op">)</span></span>
<span>          <span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Analysis number: 1"</span></span>
<span><span class="co">#&gt; [1] "Simulation number: 1"</span></span>
<span><span class="co">#&gt; [1] "Time to run simulation 1: 3.45s"</span></span>
<span><span class="co">#&gt; [1] "Time to run analysis 1: 3.45s"</span></span>
<span><span class="co">#&gt; [1] "Total time to run: 3.45s"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="post-processing-of-model-outputs">Post-processing of Model Outputs<a class="anchor" aria-label="anchor" href="#post-processing-of-model-outputs"></a>
</h2>
<div class="section level3">
<h3 id="summary-of-results">Summary of Results<a class="anchor" aria-label="anchor" href="#summary-of-results"></a>
</h3>
<p>Once the model has been run, we can use the results and summarize
them using the <code>summary_results_det</code> to print the results of
the last simulation (if nsim=1, it’s the deterministic case), and
<code>summary_results_sim</code> to show the PSA results (with the
confidence intervals). We can also use the individual patient data
generated by the simulation, which we collect here to plot in the
<code>psa_ipd</code> object.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="fu"><a href="../reference/summary_results_det.html">summary_results_det</a></span><span class="op">(</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co">#will print the last simulation!</span></span>
<span><span class="co">#&gt;                         int      noint</span></span>
<span><span class="co">#&gt; costs             426382.73  240948.43</span></span>
<span><span class="co">#&gt; dcosts                 0.00  185434.30</span></span>
<span><span class="co">#&gt; lys                   13.54      12.25</span></span>
<span><span class="co">#&gt; dlys                   0.00       1.29</span></span>
<span><span class="co">#&gt; qalys                 10.82       9.78</span></span>
<span><span class="co">#&gt; dqalys                 0.00       1.04</span></span>
<span><span class="co">#&gt; ICER                     NA  143826.99</span></span>
<span><span class="co">#&gt; ICUR                     NA  178609.71</span></span>
<span><span class="co">#&gt; INMB                     NA -133523.82</span></span>
<span><span class="co">#&gt; costs_undisc      488683.12  268783.35</span></span>
<span><span class="co">#&gt; dcosts_undisc          0.00  219899.77</span></span>
<span><span class="co">#&gt; lys_undisc            17.62      15.42</span></span>
<span><span class="co">#&gt; dlys_undisc            0.00       2.20</span></span>
<span><span class="co">#&gt; qalys_undisc          14.22      12.40</span></span>
<span><span class="co">#&gt; dqalys_undisc          0.00       1.82</span></span>
<span><span class="co">#&gt; ICER_undisc              NA   99853.07</span></span>
<span><span class="co">#&gt; ICUR_undisc              NA  120862.93</span></span>
<span><span class="co">#&gt; INMB_undisc              NA -128929.04</span></span>
<span><span class="co">#&gt; c_ae                 481.78     580.83</span></span>
<span><span class="co">#&gt; dc_ae                  0.00     -99.05</span></span>
<span><span class="co">#&gt; c_ae_undisc          586.50     688.50</span></span>
<span><span class="co">#&gt; dc_ae_undisc           0.00    -102.00</span></span>
<span><span class="co">#&gt; c_default         425900.95  240367.60</span></span>
<span><span class="co">#&gt; dc_default             0.00  185533.35</span></span>
<span><span class="co">#&gt; c_default_undisc  488096.62  268094.85</span></span>
<span><span class="co">#&gt; dc_default_undisc      0.00  220001.77</span></span>
<span><span class="co">#&gt; nat.os.s              34.38      34.38</span></span>
<span><span class="co">#&gt; dnat.os.s              0.00       0.00</span></span>
<span><span class="co">#&gt; os.early              20.45      17.07</span></span>
<span><span class="co">#&gt; dos.early              0.00       3.38</span></span>
<span><span class="co">#&gt; os.mbc                21.66      19.55</span></span>
<span><span class="co">#&gt; dos.mbc                0.00       2.10</span></span>
<span><span class="co">#&gt; q_default             10.82       9.78</span></span>
<span><span class="co">#&gt; dq_default             0.00       1.04</span></span>
<span><span class="co">#&gt; q_default_undisc      14.22      12.40</span></span>
<span><span class="co">#&gt; dq_default_undisc      0.00       1.82</span></span>
<span></span>
<span><span class="fu"><a href="../reference/summary_results_sim.html">summary_results_sim</a></span><span class="op">(</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                                int</span></span>
<span><span class="co">#&gt; costs                   426,383 (426,383; 426,383)</span></span>
<span><span class="co">#&gt; dcosts                                    0 (0; 0)</span></span>
<span><span class="co">#&gt; lys                           13.54 (13.54; 13.54)</span></span>
<span><span class="co">#&gt; dlys                                      0 (0; 0)</span></span>
<span><span class="co">#&gt; qalys                         10.82 (10.82; 10.82)</span></span>
<span><span class="co">#&gt; dqalys                                    0 (0; 0)</span></span>
<span><span class="co">#&gt; ICER                                  NaN (NA; NA)</span></span>
<span><span class="co">#&gt; ICUR                                  NaN (NA; NA)</span></span>
<span><span class="co">#&gt; INMB                                  NaN (NA; NA)</span></span>
<span><span class="co">#&gt; costs_undisc            488,683 (488,683; 488,683)</span></span>
<span><span class="co">#&gt; dcosts_undisc                             0 (0; 0)</span></span>
<span><span class="co">#&gt; lys_undisc                    17.62 (17.62; 17.62)</span></span>
<span><span class="co">#&gt; dlys_undisc                               0 (0; 0)</span></span>
<span><span class="co">#&gt; qalys_undisc                  14.22 (14.22; 14.22)</span></span>
<span><span class="co">#&gt; dqalys_undisc                             0 (0; 0)</span></span>
<span><span class="co">#&gt; ICER_undisc                           NaN (NA; NA)</span></span>
<span><span class="co">#&gt; ICUR_undisc                           NaN (NA; NA)</span></span>
<span><span class="co">#&gt; INMB_undisc                           NaN (NA; NA)</span></span>
<span><span class="co">#&gt; c_ae                       481.78 (481.78; 481.78)</span></span>
<span><span class="co">#&gt; dc_ae                                     0 (0; 0)</span></span>
<span><span class="co">#&gt; c_ae_undisc                   586.5 (586.5; 586.5)</span></span>
<span><span class="co">#&gt; dc_ae_undisc                              0 (0; 0)</span></span>
<span><span class="co">#&gt; c_default               425,901 (425,901; 425,901)</span></span>
<span><span class="co">#&gt; dc_default                                0 (0; 0)</span></span>
<span><span class="co">#&gt; c_default_undisc  488,096.6 (488,096.6; 488,096.6)</span></span>
<span><span class="co">#&gt; dc_default_undisc                         0 (0; 0)</span></span>
<span><span class="co">#&gt; nat.os.s                      34.38 (34.38; 34.38)</span></span>
<span><span class="co">#&gt; dnat.os.s                                 0 (0; 0)</span></span>
<span><span class="co">#&gt; os.early                      20.45 (20.45; 20.45)</span></span>
<span><span class="co">#&gt; dos.early                                 0 (0; 0)</span></span>
<span><span class="co">#&gt; os.mbc                        21.66 (21.66; 21.66)</span></span>
<span><span class="co">#&gt; dos.mbc                                   0 (0; 0)</span></span>
<span><span class="co">#&gt; q_default                     10.82 (10.82; 10.82)</span></span>
<span><span class="co">#&gt; dq_default                                0 (0; 0)</span></span>
<span><span class="co">#&gt; q_default_undisc              14.22 (14.22; 14.22)</span></span>
<span><span class="co">#&gt; dq_default_undisc                         0 (0; 0)</span></span>
<span><span class="co">#&gt;                                              noint</span></span>
<span><span class="co">#&gt; costs                   240,948 (240,948; 240,948)</span></span>
<span><span class="co">#&gt; dcosts                  185,434 (185,434; 185,434)</span></span>
<span><span class="co">#&gt; lys                           12.25 (12.25; 12.25)</span></span>
<span><span class="co">#&gt; dlys                          1.289 (1.289; 1.289)</span></span>
<span><span class="co">#&gt; qalys                            9.78 (9.78; 9.78)</span></span>
<span><span class="co">#&gt; dqalys                        1.038 (1.038; 1.038)</span></span>
<span><span class="co">#&gt; ICER                    143,827 (143,827; 143,827)</span></span>
<span><span class="co">#&gt; ICUR                    178,610 (178,610; 178,610)</span></span>
<span><span class="co">#&gt; INMB                 -133,524 (-133,524; -133,524)</span></span>
<span><span class="co">#&gt; costs_undisc            268,783 (268,783; 268,783)</span></span>
<span><span class="co">#&gt; dcosts_undisc           219,900 (219,900; 219,900)</span></span>
<span><span class="co">#&gt; lys_undisc                    15.42 (15.42; 15.42)</span></span>
<span><span class="co">#&gt; dlys_undisc                   2.202 (2.202; 2.202)</span></span>
<span><span class="co">#&gt; qalys_undisc                     12.4 (12.4; 12.4)</span></span>
<span><span class="co">#&gt; dqalys_undisc                 1.819 (1.819; 1.819)</span></span>
<span><span class="co">#&gt; ICER_undisc                99,853 (99,853; 99,853)</span></span>
<span><span class="co">#&gt; ICUR_undisc             120,863 (120,863; 120,863)</span></span>
<span><span class="co">#&gt; INMB_undisc          -128,929 (-128,929; -128,929)</span></span>
<span><span class="co">#&gt; c_ae                       580.83 (580.83; 580.83)</span></span>
<span><span class="co">#&gt; dc_ae                   -99.051 (-99.051; -99.051)</span></span>
<span><span class="co">#&gt; c_ae_undisc                   688.5 (688.5; 688.5)</span></span>
<span><span class="co">#&gt; dc_ae_undisc                     -102 (-102; -102)</span></span>
<span><span class="co">#&gt; c_default         240,367.6 (240,367.6; 240,367.6)</span></span>
<span><span class="co">#&gt; dc_default        185,533.3 (185,533.3; 185,533.3)</span></span>
<span><span class="co">#&gt; c_default_undisc  268,094.8 (268,094.8; 268,094.8)</span></span>
<span><span class="co">#&gt; dc_default_undisc 220,001.8 (220,001.8; 220,001.8)</span></span>
<span><span class="co">#&gt; nat.os.s                      34.38 (34.38; 34.38)</span></span>
<span><span class="co">#&gt; dnat.os.s                                 0 (0; 0)</span></span>
<span><span class="co">#&gt; os.early                      17.07 (17.07; 17.07)</span></span>
<span><span class="co">#&gt; dos.early                     3.385 (3.385; 3.385)</span></span>
<span><span class="co">#&gt; os.mbc                        19.55 (19.55; 19.55)</span></span>
<span><span class="co">#&gt; dos.mbc                       2.104 (2.104; 2.104)</span></span>
<span><span class="co">#&gt; q_default                        9.78 (9.78; 9.78)</span></span>
<span><span class="co">#&gt; dq_default                    1.038 (1.038; 1.038)</span></span>
<span><span class="co">#&gt; q_default_undisc                 12.4 (12.4; 12.4)</span></span>
<span><span class="co">#&gt; dq_default_undisc             1.819 (1.819; 1.819)</span></span>
<span></span>
<span><span class="va">psa_ipd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"merged_df"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">psa_ipd</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>bootstrap_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
evtname
</th>
<th style="text-align:right;">
evttime
</th>
<th style="text-align:right;">
prevtime
</th>
<th style="text-align:right;">
pat_id
</th>
<th style="text-align:left;">
arm
</th>
<th style="text-align:right;">
total_lys
</th>
<th style="text-align:right;">
total_qalys
</th>
<th style="text-align:right;">
total_costs
</th>
<th style="text-align:right;">
total_costs_undisc
</th>
<th style="text-align:right;">
total_qalys_undisc
</th>
<th style="text-align:right;">
total_lys_undisc
</th>
<th style="text-align:right;">
lys
</th>
<th style="text-align:right;">
qalys
</th>
<th style="text-align:right;">
costs
</th>
<th style="text-align:right;">
lys_undisc
</th>
<th style="text-align:right;">
qalys_undisc
</th>
<th style="text-align:right;">
costs_undisc
</th>
<th style="text-align:right;">
os.early
</th>
<th style="text-align:right;">
os.mbc
</th>
<th style="text-align:right;">
nat.os.s
</th>
<th style="text-align:left;">
sex_pt
</th>
<th style="text-align:right;">
c_default
</th>
<th style="text-align:right;">
c_ae
</th>
<th style="text-align:right;">
q_default
</th>
<th style="text-align:right;">
c_default_undisc
</th>
<th style="text-align:right;">
q_default_undisc
</th>
<th style="text-align:right;">
c_ae_undisc
</th>
<th style="text-align:right;">
nexttime
</th>
<th style="text-align:right;">
simulation
</th>
<th style="text-align:right;">
sensitivity
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
start
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
16.67640
</td>
<td style="text-align:right;">
14.076524
</td>
<td style="text-align:right;">
477729.9
</td>
<td style="text-align:right;">
570720.4
</td>
<td style="text-align:right;">
19.647494
</td>
<td style="text-align:right;">
22.97504
</td>
<td style="text-align:right;">
6.214891
</td>
<td style="text-align:right;">
4.6611685
</td>
<td style="text-align:right;">
372893.48
</td>
<td style="text-align:right;">
6.866962
</td>
<td style="text-align:right;">
5.1502211
</td>
<td style="text-align:right;">
412017.69
</td>
<td style="text-align:right;">
22.97504
</td>
<td style="text-align:right;">
27.18718
</td>
<td style="text-align:right;">
41.40393
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
372893.48
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4.6611685
</td>
<td style="text-align:right;">
412017.69
</td>
<td style="text-align:right;">
5.1502211
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6.866962
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
idfs
</td>
<td style="text-align:right;">
6.866962
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
16.67640
</td>
<td style="text-align:right;">
14.076524
</td>
<td style="text-align:right;">
477729.9
</td>
<td style="text-align:right;">
570720.4
</td>
<td style="text-align:right;">
19.647494
</td>
<td style="text-align:right;">
22.97504
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
22.97504
</td>
<td style="text-align:right;">
27.18718
</td>
<td style="text-align:right;">
41.40393
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6.866962
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
ttot.early
</td>
<td style="text-align:right;">
6.866962
</td>
<td style="text-align:right;">
6.866962
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
16.67640
</td>
<td style="text-align:right;">
14.076524
</td>
<td style="text-align:right;">
477729.9
</td>
<td style="text-align:right;">
570720.4
</td>
<td style="text-align:right;">
19.647494
</td>
<td style="text-align:right;">
22.97504
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
22.97504
</td>
<td style="text-align:right;">
27.18718
</td>
<td style="text-align:right;">
41.40393
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6.866962
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
remission
</td>
<td style="text-align:right;">
6.866962
</td>
<td style="text-align:right;">
6.866962
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
16.67640
</td>
<td style="text-align:right;">
14.076524
</td>
<td style="text-align:right;">
477729.9
</td>
<td style="text-align:right;">
570720.4
</td>
<td style="text-align:right;">
19.647494
</td>
<td style="text-align:right;">
22.97504
</td>
<td style="text-align:right;">
2.911379
</td>
<td style="text-align:right;">
2.6202415
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
3.768932
</td>
<td style="text-align:right;">
3.3920387
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
22.97504
</td>
<td style="text-align:right;">
27.18718
</td>
<td style="text-align:right;">
41.40393
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2.6202415
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
3.3920387
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10.635893
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
ttot.beva
</td>
<td style="text-align:right;">
10.635893
</td>
<td style="text-align:right;">
6.866962
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
16.67640
</td>
<td style="text-align:right;">
14.076524
</td>
<td style="text-align:right;">
477729.9
</td>
<td style="text-align:right;">
570720.4
</td>
<td style="text-align:right;">
19.647494
</td>
<td style="text-align:right;">
22.97504
</td>
<td style="text-align:right;">
4.558107
</td>
<td style="text-align:right;">
4.1022962
</td>
<td style="text-align:right;">
104836.46
</td>
<td style="text-align:right;">
6.900118
</td>
<td style="text-align:right;">
6.2101065
</td>
<td style="text-align:right;">
158702.72
</td>
<td style="text-align:right;">
22.97504
</td>
<td style="text-align:right;">
27.18718
</td>
<td style="text-align:right;">
41.40393
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
104836.46
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4.1022962
</td>
<td style="text-align:right;">
158702.72
</td>
<td style="text-align:right;">
6.2101065
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
17.536012
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
recurrence
</td>
<td style="text-align:right;">
17.536012
</td>
<td style="text-align:right;">
10.635893
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
16.67640
</td>
<td style="text-align:right;">
14.076524
</td>
<td style="text-align:right;">
477729.9
</td>
<td style="text-align:right;">
570720.4
</td>
<td style="text-align:right;">
19.647494
</td>
<td style="text-align:right;">
22.97504
</td>
<td style="text-align:right;">
2.992019
</td>
<td style="text-align:right;">
2.6928174
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
5.439031
</td>
<td style="text-align:right;">
4.8951278
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
22.97504
</td>
<td style="text-align:right;">
27.18718
</td>
<td style="text-align:right;">
41.40393
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2.6928174
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
4.8951278
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
22.975043
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
os
</td>
<td style="text-align:right;">
22.975043
</td>
<td style="text-align:right;">
17.536012
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
16.67640
</td>
<td style="text-align:right;">
14.076524
</td>
<td style="text-align:right;">
477729.9
</td>
<td style="text-align:right;">
570720.4
</td>
<td style="text-align:right;">
19.647494
</td>
<td style="text-align:right;">
22.97504
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
22.97504
</td>
<td style="text-align:right;">
27.18718
</td>
<td style="text-align:right;">
41.40393
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
22.975043
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
start
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
10.19439
</td>
<td style="text-align:right;">
7.102671
</td>
<td style="text-align:right;">
463567.6
</td>
<td style="text-align:right;">
529144.0
</td>
<td style="text-align:right;">
8.322397
</td>
<td style="text-align:right;">
12.13115
</td>
<td style="text-align:right;">
5.865836
</td>
<td style="text-align:right;">
4.3993770
</td>
<td style="text-align:right;">
351950.16
</td>
<td style="text-align:right;">
6.442032
</td>
<td style="text-align:right;">
4.8315241
</td>
<td style="text-align:right;">
386521.92
</td>
<td style="text-align:right;">
23.38690
</td>
<td style="text-align:right;">
12.13115
</td>
<td style="text-align:right;">
34.88245
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
351950.16
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4.3993770
</td>
<td style="text-align:right;">
386521.92
</td>
<td style="text-align:right;">
4.8315241
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6.442032
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
ttot.early
</td>
<td style="text-align:right;">
6.442032
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
10.19439
</td>
<td style="text-align:right;">
7.102671
</td>
<td style="text-align:right;">
463567.6
</td>
<td style="text-align:right;">
529144.0
</td>
<td style="text-align:right;">
8.322397
</td>
<td style="text-align:right;">
12.13115
</td>
<td style="text-align:right;">
1.075007
</td>
<td style="text-align:right;">
0.8062555
</td>
<td style="text-align:right;">
64500.44
</td>
<td style="text-align:right;">
1.326153
</td>
<td style="text-align:right;">
0.9946144
</td>
<td style="text-align:right;">
79569.15
</td>
<td style="text-align:right;">
23.38690
</td>
<td style="text-align:right;">
12.13115
</td>
<td style="text-align:right;">
34.88245
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
64500.44
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.8062555
</td>
<td style="text-align:right;">
79569.15
</td>
<td style="text-align:right;">
0.9946144
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7.768185
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
ttot.beva
</td>
<td style="text-align:right;">
7.768185
</td>
<td style="text-align:right;">
6.442032
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
10.19439
</td>
<td style="text-align:right;">
7.102671
</td>
<td style="text-align:right;">
463567.6
</td>
<td style="text-align:right;">
529144.0
</td>
<td style="text-align:right;">
8.322397
</td>
<td style="text-align:right;">
12.13115
</td>
<td style="text-align:right;">
1.050940
</td>
<td style="text-align:right;">
1.0509402
</td>
<td style="text-align:right;">
24171.63
</td>
<td style="text-align:right;">
1.348740
</td>
<td style="text-align:right;">
1.3487400
</td>
<td style="text-align:right;">
31021.02
</td>
<td style="text-align:right;">
23.38690
</td>
<td style="text-align:right;">
12.13115
</td>
<td style="text-align:right;">
34.88245
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
24171.63
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.0509402
</td>
<td style="text-align:right;">
31021.02
</td>
<td style="text-align:right;">
1.3487400
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
9.116925
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>We can also check what has been the absolute number of events per
strategy.</p>
<table class="table table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
arm
</th>
<th style="text-align:left;">
evtname
</th>
<th style="text-align:right;">
n
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
int
</td>
<td style="text-align:left;">
os
</td>
<td style="text-align:right;">
2000
</td>
</tr>
<tr>
<td style="text-align:left;">
int
</td>
<td style="text-align:left;">
start
</td>
<td style="text-align:right;">
2000
</td>
</tr>
<tr>
<td style="text-align:left;">
int
</td>
<td style="text-align:left;">
ttot.early
</td>
<td style="text-align:right;">
1970
</td>
</tr>
<tr>
<td style="text-align:left;">
int
</td>
<td style="text-align:left;">
idfs
</td>
<td style="text-align:right;">
1961
</td>
</tr>
<tr>
<td style="text-align:left;">
int
</td>
<td style="text-align:left;">
ttot.beva
</td>
<td style="text-align:right;">
1951
</td>
</tr>
<tr>
<td style="text-align:left;">
int
</td>
<td style="text-align:left;">
remission
</td>
<td style="text-align:right;">
1574
</td>
</tr>
<tr>
<td style="text-align:left;">
int
</td>
<td style="text-align:left;">
recurrence
</td>
<td style="text-align:right;">
1334
</td>
</tr>
<tr>
<td style="text-align:left;">
int
</td>
<td style="text-align:left;">
ae
</td>
<td style="text-align:right;">
1173
</td>
</tr>
<tr>
<td style="text-align:left;">
int
</td>
<td style="text-align:left;">
ttot
</td>
<td style="text-align:right;">
574
</td>
</tr>
<tr>
<td style="text-align:left;">
int
</td>
<td style="text-align:left;">
progression.mbc
</td>
<td style="text-align:right;">
559
</td>
</tr>
<tr>
<td style="text-align:left;">
int
</td>
<td style="text-align:left;">
start.early.mbc
</td>
<td style="text-align:right;">
384
</td>
</tr>
<tr>
<td style="text-align:left;">
int
</td>
<td style="text-align:left;">
2ndline_mbc
</td>
<td style="text-align:right;">
244
</td>
</tr>
<tr>
<td style="text-align:left;">
noint
</td>
<td style="text-align:left;">
os
</td>
<td style="text-align:right;">
2000
</td>
</tr>
<tr>
<td style="text-align:left;">
noint
</td>
<td style="text-align:left;">
start
</td>
<td style="text-align:right;">
2000
</td>
</tr>
<tr>
<td style="text-align:left;">
noint
</td>
<td style="text-align:left;">
ttot.early
</td>
<td style="text-align:right;">
1975
</td>
</tr>
<tr>
<td style="text-align:left;">
noint
</td>
<td style="text-align:left;">
idfs
</td>
<td style="text-align:right;">
1969
</td>
</tr>
<tr>
<td style="text-align:left;">
noint
</td>
<td style="text-align:left;">
remission
</td>
<td style="text-align:right;">
1581
</td>
</tr>
<tr>
<td style="text-align:left;">
noint
</td>
<td style="text-align:left;">
ae
</td>
<td style="text-align:right;">
1377
</td>
</tr>
<tr>
<td style="text-align:left;">
noint
</td>
<td style="text-align:left;">
recurrence
</td>
<td style="text-align:right;">
1204
</td>
</tr>
<tr>
<td style="text-align:left;">
noint
</td>
<td style="text-align:left;">
ttot
</td>
<td style="text-align:right;">
469
</td>
</tr>
<tr>
<td style="text-align:left;">
noint
</td>
<td style="text-align:left;">
progression.mbc
</td>
<td style="text-align:right;">
463
</td>
</tr>
<tr>
<td style="text-align:left;">
noint
</td>
<td style="text-align:left;">
start.early.mbc
</td>
<td style="text-align:right;">
369
</td>
</tr>
<tr>
<td style="text-align:left;">
noint
</td>
<td style="text-align:left;">
2ndline_mbc
</td>
<td style="text-align:right;">
206
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="plots">Plots<a class="anchor" aria-label="anchor" href="#plots"></a>
</h3>
<p>We now use the data output to plot the histograms/densities of the
simulation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">data_plot</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">merged_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">evtname</span> <span class="op">!=</span> <span class="st">"start"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">arm</span>,<span class="va">evtname</span>,<span class="va">simulation</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">evttime</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Density</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_plot</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">arm</span>, x <span class="op">=</span> <span class="va">evttime</span><span class="op">)</span>,</span>
<span>                 alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept<span class="op">=</span><span class="va">median</span>,col<span class="op">=</span><span class="va">arm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">evtname</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_eBC_files/figure-html/post-processing_plots1-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We can also plot the patient level QALY/costs. Note that there are
several clusters in the distribution of patients according to their
QALY/costs based on the pathway they took (early metastatic
vs. remission and cure or recurrence).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">data_qaly_cost</span><span class="op">&lt;-</span> <span class="va">psa_ipd</span><span class="op">[</span>,<span class="va">.SD</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,by<span class="op">=</span><span class="fu">.</span><span class="op">(</span><span class="va">pat_id</span>,<span class="va">arm</span>,<span class="va">simulation</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">arm</span>,qaly<span class="op">=</span><span class="va">total_qalys</span>,cost<span class="op">=</span><span class="va">total_costs</span>,<span class="va">pat_id</span>,<span class="va">simulation</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">data_qaly_cost</span><span class="op">[</span>,<span class="va">ps_id</span><span class="op">:=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">pat_id</span>,<span class="va">simulation</span>,sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="va">mean_data_qaly_cost</span> <span class="op">&lt;-</span> <span class="va">data_qaly_cost</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">arm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>,<span class="va">mean</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_qaly_cost</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">qaly</span>, y <span class="op">=</span> <span class="va">cost</span>, col <span class="op">=</span> <span class="va">arm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.15</span>,shape <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">mean_data_qaly_cost</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">qaly</span>, y <span class="op">=</span> <span class="va">cost</span>, fill <span class="op">=</span> <span class="va">arm</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">21</span>,col<span class="op">=</span><span class="st">"black"</span>,size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_eBC_files/figure-html/post-processing_plots-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Javier Sanchez Alvarez.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
