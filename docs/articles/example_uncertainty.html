<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="RDICE">
<title>Structural and Parametric Uncertainty â€¢ RDICE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Structural and Parametric Uncertainty">
<meta property="og:description" content="RDICE">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">RDICE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/example_ssd.html">Example in a Sick-Sicker-Dead Model</a>
    <a class="dropdown-item" href="../articles/example_eBC.html">Example in Early Breast Cancer</a>
    <a class="dropdown-item" href="../articles/example_markov.html">Example in a Markov Model</a>
    <a class="dropdown-item" href="../articles/example_uncertainty.html">Structural and Parametric Uncertainty</a>
    <a class="dropdown-item" href="../articles/example_ipd.html">Example for Individual Patient Data</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/javiersanchezalvarezevidera/RDICE">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="example_uncertainty_files/kePrint-0.0.1/kePrint.js"></script><link href="example_uncertainty_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Structural and Parametric Uncertainty</h1>
                        <h4 data-toc-skip class="author">Javier Sanchez
Alvarez and Valerie Aponte Ribero</h4>
            
            <h4 data-toc-skip class="date">April 29, 2024</h4>
      
      
      <div class="d-none name"><code>example_uncertainty.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document runs a discrete event simulation model in the context
of early breast cancer to show how uncertainty behaves in a simulation
setting and how it complements with a standard PSA. As the model is
extremely similar to the example in early breast cancer, the user can
check the original model for details on functions, parameters etc.</p>
<div class="section level3">
<h3 id="main-options">Main options<a class="anchor" aria-label="anchor" href="#main-options"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">RDICE</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'dplyr' was built under R version 4.3.2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'tidyr' was built under R version 4.3.2</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chjackson/flexsurv-dev" class="external-link">flexsurv</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'flexsurv' was built under R version 4.3.2</span></span>
<span><span class="co">#&gt; Loading required package: survival</span></span>
<span><span class="co">#&gt; Warning: package 'survival' was built under R version 4.3.2</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'ggplot2' was built under R version 4.3.3</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'kableExtra' was built under R version 4.3.2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'kableExtra'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     group_rows</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load-data">Load Data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h3>
<p>The dummy data for costs and utility is generated below.</p>
</div>
</div>
<div class="section level2">
<h2 id="general-inputs-with-delayed-execution">General inputs with delayed execution<a class="anchor" aria-label="anchor" href="#general-inputs-with-delayed-execution"></a>
</h2>
<p>Initial inputs and flags that will be used in the model can be
defined below. This is exactly the same as in the original model, the
only difference is that now we are adding an extra chunk which reflects
the uncertainty of parameters to draw distributions. Furthermore,
utilities and costs also have a distribution.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Each patient is identified through "i"</span></span>
<span><span class="co">#Items used in the model should be unnamed numeric/vectors! otherwise if they are processed by model it can lead to strangely named outcomes</span></span>
<span><span class="co">#In this case, util_v is a named vector, but it's not processed by the model. We extract unnamed numerics from it.</span></span>
<span></span>
<span><span class="co">#Put objects here that do not change on any patient or intervention loop</span></span>
<span><span class="va">common_all_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span> <span class="co">#utilities</span></span>
<span>    util_v <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">psa_bool</span><span class="op">)</span><span class="op">{</span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">util.data</span><span class="op">$</span><span class="va">value</span>,<span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">util.data</span><span class="op">$</span><span class="va">se</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,<span class="va">util.data</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="co">#in this case I choose a multivariate normal with no correlation</span></span>
<span>             <span class="op">}</span> <span class="kw">else</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">util.data</span><span class="op">$</span><span class="va">value</span>,<span class="va">util.data</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">}</span>,</span>
<span>    util.idfs.ontx <span class="op">=</span> <span class="va">util_v</span><span class="op">[[</span><span class="st">"util.idfs.ontx"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>    util.idfs.offtx  <span class="op">=</span> <span class="va">util_v</span><span class="op">[[</span><span class="st">"util.idfs.offtx"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    util.remission <span class="op">=</span> <span class="va">util_v</span><span class="op">[[</span><span class="st">"util.remission"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    util.recurrence <span class="op">=</span> <span class="va">util_v</span><span class="op">[[</span><span class="st">"util.recurrence"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    util.mbc.progression.mbc <span class="op">=</span> <span class="va">util_v</span><span class="op">[[</span><span class="st">"util.mbc.progression.mbc"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    util.mbc.pps <span class="op">=</span> <span class="va">util_v</span><span class="op">[[</span><span class="st">"util.mbc.pps"</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span> <span class="co">#costs</span></span>
<span>    cost_v <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">psa_bool</span><span class="op">)</span><span class="op">{</span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="../reference/rgamma_mse.html">rgamma_mse</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">cost.data</span><span class="op">$</span><span class="va">value</span>,<span class="va">cost.data</span><span class="op">$</span><span class="va">se</span><span class="op">)</span>,<span class="va">cost.data</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="co">#in this case I choose a gamma distribution</span></span>
<span>             <span class="op">}</span> <span class="kw">else</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">cost.data</span><span class="op">$</span><span class="va">value</span>,<span class="va">cost.data</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">}</span>,</span>
<span>    cost.idfs.tx  <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.idfs.tx"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    cost.recurrence  <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.recurrence"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    cost.mbc.tx  <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.mbc.tx"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    cost.tx.beva  <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.tx.beva"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    cost.idfs.txnoint <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.idfs.txnoint"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    cost.idfs <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.idfs"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    cost.mbc.progression.mbc <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.mbc.progression.mbc"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    cost.mbc.pps <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.mbc.pps"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    cost.2ndline <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.2ndline"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    cost.ae <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.ae"</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span> <span class="co">#parameter uncertainty</span></span>
<span>    coef11_psa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">psa_bool</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">0.1</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>    coef12_psa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">psa_bool</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">0.1</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>    coef13_psa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">psa_bool</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.8</span>,<span class="fl">0.05</span><span class="op">)</span>,<span class="fl">0.8</span><span class="op">)</span>,</span>
<span>    coef14_psa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">psa_bool</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.5</span>,<span class="fl">0.05</span><span class="op">)</span>,<span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    coef15_psa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">psa_bool</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2.3</span>,<span class="fl">0.1</span><span class="op">)</span>,<span class="fl">2.3</span><span class="op">)</span>,</span>
<span>    coef16_psa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">psa_bool</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.08</span>,<span class="fl">0.005</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.08</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    coef2_psa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">psa_bool</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.2</span>,<span class="fl">0.01</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    hr_psa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">psa_bool</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1.2</span><span class="op">)</span>,<span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>,<span class="fl">1.2</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co">#Put objects here that do not change as we loop through interventions for a patient</span></span>
<span><span class="va">common_pt_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span>sex_pt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,p<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,<span class="st">"male"</span>,<span class="st">"female"</span><span class="op">)</span>,</span>
<span>                             nat.os.s <span class="op">=</span> <span class="fu"><a href="../reference/rresgompertz.html">rresgompertz</a></span><span class="op">(</span><span class="fl">1</span>,</span>
<span>                                                     shape<span class="op">=</span><span class="kw">if</span><span class="op">(</span><span class="va">sex_pt</span><span class="op">==</span><span class="st">"male"</span><span class="op">)</span><span class="op">{</span><span class="fl">0.102</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="fl">0.115</span><span class="op">}</span>,</span>
<span>                                                     rate<span class="op">=</span><span class="kw">if</span><span class="op">(</span><span class="va">sex_pt</span><span class="op">==</span><span class="st">"male"</span><span class="op">)</span><span class="op">{</span><span class="fl">0.000016</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="fl">0.0000041</span><span class="op">}</span>,</span>
<span>                                                     lower_bound <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">)</span> <span class="co">#in years, for a patient who is 50yo</span></span>
<span></span>
<span><span class="co">#Put objects here that change as we loop through treatments for each patient (e.g. events can affect fl.tx, but events do not affect nat.os.s)</span></span>
<span><span class="co">#common across arm but changes per pt could be implemented here (if (arm==)... )</span></span>
<span><span class="va">unique_pt_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span></span>
<span>  fl.idfs.ontx             <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  fl.idfs                  <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  fl.mbcs.ontx             <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  fl.mbcs.progression.mbc  <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  fl.tx.beva               <span class="op">=</span> <span class="fl">1</span>,  </span>
<span>  fl.mbcs                  <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  fl.mbcs_2ndline          <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  fl.recurrence            <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  fl.remission             <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0.8</span><span class="op">)</span>, <span class="co">#80% probability of going into remission</span></span>
<span>  q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>  c_default <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">arm</span><span class="op">==</span><span class="st">"noint"</span><span class="op">)</span><span class="op">{</span><span class="va">cost.idfs.txnoint</span><span class="op">*</span> <span class="va">fl.idfs.ontx</span>  <span class="op">+</span> <span class="va">cost.idfs</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="op">(</span><span class="va">cost.idfs.tx</span><span class="op">)</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="va">cost.tx.beva</span> <span class="op">*</span> <span class="va">fl.tx.beva</span> <span class="op">+</span> <span class="va">cost.idfs</span><span class="op">}</span>,</span>
<span>  c_ae <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="events">Events<a class="anchor" aria-label="anchor" href="#events"></a>
</h2>
<div class="section level3">
<h3 id="add-initial-events">Add Initial Events<a class="anchor" aria-label="anchor" href="#add-initial-events"></a>
</h3>
<p>Events are generated as before, the only difference being that the
parameters are not a simple number but the objects created as part of
<code>common_all_inputs</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">init_event_list</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/add_tte.html">add_tte</a></span><span class="op">(</span>arm<span class="op">=</span><span class="st">"int"</span>,</span>
<span>               evts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"start"</span>,<span class="st">"ttot"</span>, <span class="st">"ttot.beva"</span>,<span class="st">"progression.mbc"</span>, <span class="st">"os"</span>,<span class="st">"idfs"</span>,<span class="st">"ttot.early"</span>,<span class="st">"remission"</span>,<span class="st">"recurrence"</span>,<span class="st">"start.early.mbc"</span><span class="op">)</span>,</span>
<span>               other_inp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"os.early"</span>,<span class="st">"os.mbc"</span><span class="op">)</span>,</span>
<span>               input<span class="op">=</span><span class="op">{</span> <span class="co">#intervention</span></span>
<span>    <span class="va">start</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    </span>
<span>    <span class="co">#Early</span></span>
<span>    </span>
<span>    <span class="va">idfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef11_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> </span>
<span>    <span class="va">ttot.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef11_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span>,<span class="va">idfs</span><span class="op">)</span></span>
<span>    <span class="va">ttot.beva</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef11_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">os.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef12_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> </span>
<span>    </span>
<span>    <span class="co">#if patient has remission, check when will recurrence happen</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">fl.remission</span><span class="op">)</span> <span class="op">{</span> </span>
<span>      <span class="va">recurrence</span> <span class="op">&lt;-</span> <span class="va">idfs</span> <span class="op">+</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef11_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span></span>
<span>      <span class="va">remission</span> <span class="op">&lt;-</span> <span class="va">idfs</span></span>
<span>      </span>
<span>      <span class="co">#if recurrence happens before death</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">os.early</span>,<span class="va">nat.os.s</span><span class="op">)</span><span class="op">&gt;</span><span class="va">recurrence</span><span class="op">)</span> <span class="op">{</span> </span>
<span>        </span>
<span>        <span class="co">#Late metastatic (after finishing idfs and recurrence)</span></span>
<span>        </span>
<span>        <span class="va">os.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef13_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">idfs</span>  <span class="op">+</span>  <span class="va">recurrence</span> </span>
<span>        </span>
<span>        <span class="va">progression.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef14_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">idfs</span> <span class="op">+</span>  <span class="va">recurrence</span> </span>
<span>        </span>
<span>        <span class="va">ttot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef14_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">idfs</span> <span class="op">+</span>  <span class="va">recurrence</span></span>
<span>        </span>
<span>        </span>
<span>      <span class="op">}</span></span>
<span>      </span>
<span>    <span class="op">}</span> <span class="kw">else</span><span class="op">{</span> <span class="co">#If early metastatic</span></span>
<span>      <span class="va">start.early.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef15_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">idfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">start.early.mbc</span><span class="op">&lt;</span><span class="va">idfs</span>,<span class="va">start.early.mbc</span>,<span class="va">idfs</span><span class="op">)</span></span>
<span>      <span class="va">ttot.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">start.early.mbc</span><span class="op">&lt;</span><span class="va">idfs</span>,<span class="va">start.early.mbc</span>,<span class="va">idfs</span><span class="op">)</span>,<span class="va">ttot.early</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">os.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef13_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">start.early.mbc</span></span>
<span>      </span>
<span>      <span class="va">progression.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef14_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">start.early.mbc</span></span>
<span>      </span>
<span>      <span class="va">ttot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef14_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">start.early.mbc</span></span>
<span>      </span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">os</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">os.mbc</span>,<span class="va">os.early</span>,<span class="va">nat.os.s</span><span class="op">)</span></span>
<span>    </span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="fu"><a href="../reference/add_tte.html">add_tte</a></span><span class="op">(</span>arm<span class="op">=</span><span class="st">"noint"</span>,</span>
<span>                       evts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"start"</span>,<span class="st">"ttot"</span>, <span class="st">"ttot.beva"</span>,<span class="st">"progression.mbc"</span>, <span class="st">"os"</span>,<span class="st">"idfs"</span>,<span class="st">"ttot.early"</span>,<span class="st">"remission"</span>,<span class="st">"recurrence"</span>,<span class="st">"start.early.mbc"</span><span class="op">)</span>,</span>
<span>                       other_inp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"os.early"</span>,<span class="st">"os.mbc"</span><span class="op">)</span>,                       </span>
<span>                       input<span class="op">=</span><span class="op">{</span>  <span class="co">#reference strategy</span></span>
<span>    <span class="va">start</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span>    <span class="co">#Early</span></span>
<span>    </span>
<span>    <span class="va">idfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef11_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span>,beta_tx <span class="op">=</span> <span class="va">hr_psa</span><span class="op">)</span> </span>
<span>    <span class="va">ttot.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef11_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span>,beta_tx <span class="op">=</span> <span class="va">hr_psa</span><span class="op">)</span>,<span class="va">idfs</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">os.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef12_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span>,beta_tx <span class="op">=</span> <span class="va">hr_psa</span><span class="op">)</span> </span>
<span>    </span>
<span>    <span class="co">#if patient has remission, check when will recurrence happen</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">fl.remission</span><span class="op">)</span> <span class="op">{</span> </span>
<span>      <span class="va">recurrence</span> <span class="op">&lt;-</span> <span class="va">idfs</span> <span class="op">+</span><span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef11_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span></span>
<span>      <span class="va">remission</span> <span class="op">&lt;-</span> <span class="va">idfs</span></span>
<span>      </span>
<span>      <span class="co">#if recurrence happens before death</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">os.early</span>,<span class="va">nat.os.s</span><span class="op">)</span><span class="op">&gt;</span><span class="va">recurrence</span><span class="op">)</span> <span class="op">{</span> </span>
<span>        </span>
<span>        <span class="co">#Late metastatic (after finishing idfs and recurrence)</span></span>
<span>        </span>
<span>        <span class="va">os.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef13_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">idfs</span>  <span class="op">+</span>  <span class="va">recurrence</span> </span>
<span>        </span>
<span>        <span class="va">progression.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef14_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">idfs</span> <span class="op">+</span>  <span class="va">recurrence</span> </span>
<span>        </span>
<span>        <span class="va">ttot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef14_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">idfs</span> <span class="op">+</span>  <span class="va">recurrence</span></span>
<span>        </span>
<span>      <span class="op">}</span></span>
<span>      </span>
<span>    <span class="op">}</span> <span class="kw">else</span><span class="op">{</span> <span class="co">#If early metastatic</span></span>
<span>      <span class="va">start.early.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef15_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">idfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">start.early.mbc</span><span class="op">&lt;</span><span class="va">idfs</span>,<span class="va">start.early.mbc</span>,<span class="va">idfs</span><span class="op">)</span></span>
<span>      <span class="va">ttot.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">start.early.mbc</span><span class="op">&lt;</span><span class="va">idfs</span>,<span class="va">start.early.mbc</span>,<span class="va">idfs</span><span class="op">)</span>,<span class="va">ttot.early</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">os.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef13_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">start.early.mbc</span></span>
<span>      </span>
<span>      <span class="va">progression.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef14_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">start.early.mbc</span></span>
<span>      </span>
<span>      <span class="va">ttot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef14_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">start.early.mbc</span></span>
<span>      </span>
<span>      </span>
<span>    <span class="op">}</span>    </span>
<span>    <span class="va">os</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">os.mbc</span>,<span class="va">os.early</span>,<span class="va">nat.os.s</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="add-reaction-to-those-events">Add Reaction to Those Events<a class="anchor" aria-label="anchor" href="#add-reaction-to-those-events"></a>
</h3>
<p>The reactions are set in the same fashion as in the original model. A
small modification has been made in generating the event
<code>2ndline_mbc</code>, which now also uses a random parameter if the
PSA option is active.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">evt_react_list</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"start"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span><span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"ttot"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">arm</span><span class="op">==</span><span class="st">"noint"</span><span class="op">)</span><span class="op">{</span><span class="va">cost.idfs.txnoint</span><span class="op">*</span> <span class="va">fl.idfs.ontx</span>  <span class="op">+</span> <span class="va">cost.idfs</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="op">(</span><span class="va">cost.idfs.tx</span><span class="op">)</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="va">cost.tx.beva</span> <span class="op">*</span> <span class="va">fl.tx.beva</span> <span class="op">+</span> <span class="va">cost.idfs</span><span class="op">}</span>,</span>
<span>                              <span class="st">"fl.mbcs.ontx"</span><span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co">#Flag that patient is now off-treatment</span></span>
<span>                 </span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"ttot.beva"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="va">cost.mbc.tx</span>  <span class="op">*</span> <span class="va">fl.mbcs.ontx</span> <span class="op">+</span> <span class="va">cost.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="va">cost.mbc.pps</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span> <span class="op">+</span> <span class="va">cost.2ndline</span><span class="op">*</span><span class="va">fl.mbcs_2ndline</span>,</span>
<span>                              <span class="st">"fl.tx.beva"</span><span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co">#Flag that patient is now off-treatment</span></span>
<span>                 </span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"progression.mbc"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="va">cost.mbc.tx</span>  <span class="op">*</span> <span class="va">fl.mbcs.ontx</span> <span class="op">+</span> <span class="va">cost.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="va">cost.mbc.pps</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span> <span class="op">+</span> <span class="va">cost.2ndline</span><span class="op">*</span><span class="va">fl.mbcs_2ndline</span>,</span>
<span>                              <span class="st">"fl.mbcs.progression.mbc"</span><span class="op">=</span><span class="fl">0</span>,</span>
<span>                              <span class="st">"fl.mbcs_2ndline"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co">#Flag that patient is progressed and going in 2nd line</span></span>
<span>                 </span>
<span>                 <span class="fu"><a href="../reference/new_event.html">new_event</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"2ndline_mbc"</span> <span class="op">=</span> <span class="va">curtime</span> <span class="op">+</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'exp'</span>, <span class="va">coef16_psa</span><span class="op">)</span><span class="op">/</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span>                 </span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"idfs"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">arm</span><span class="op">==</span><span class="st">"noint"</span><span class="op">)</span><span class="op">{</span><span class="va">cost.idfs.txnoint</span><span class="op">*</span> <span class="va">fl.idfs.ontx</span>  <span class="op">+</span> <span class="va">cost.idfs</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="op">(</span><span class="va">cost.idfs.tx</span><span class="op">)</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="va">cost.tx.beva</span> <span class="op">*</span> <span class="va">fl.tx.beva</span> <span class="op">+</span> <span class="va">cost.idfs</span><span class="op">}</span>,</span>
<span>                              <span class="st">"fl.idfs"</span><span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>                 </span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"ttot.early"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">arm</span><span class="op">==</span><span class="st">"noint"</span><span class="op">)</span><span class="op">{</span><span class="va">cost.idfs.txnoint</span><span class="op">*</span> <span class="va">fl.idfs.ontx</span>  <span class="op">+</span> <span class="va">cost.idfs</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="op">(</span><span class="va">cost.idfs.tx</span><span class="op">)</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="va">cost.tx.beva</span> <span class="op">*</span> <span class="va">fl.tx.beva</span> <span class="op">+</span> <span class="va">cost.idfs</span><span class="op">}</span>,</span>
<span>                              <span class="st">"fl.idfs.ontx"</span><span class="op">=</span><span class="fl">0</span>,</span>
<span>                              <span class="st">"fl.tx.beva"</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co">#Flag that patient is now off-treatment</span></span>
<span>                 </span>
<span>                 <span class="va">n_ae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">1</span>,lambda<span class="op">=</span><span class="fl">0.25</span><span class="op">*</span><span class="op">(</span><span class="va">curtime</span> <span class="op">-</span><span class="va">prevtime</span><span class="op">)</span><span class="op">)</span> <span class="co">#1 AE every 4 years</span></span>
<span>                 </span>
<span>                 <span class="kw">if</span> <span class="op">(</span><span class="va">n_ae</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                   <span class="fu"><a href="../reference/new_event.html">new_event</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"ae"</span> <span class="op">=</span> <span class="va">curtime</span> <span class="op">+</span> <span class="fl">0.0001</span><span class="op">)</span>,<span class="va">n_ae</span><span class="op">)</span><span class="op">)</span></span>
<span>                 <span class="op">}</span></span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"remission"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="va">cost.recurrence</span> <span class="op">*</span> <span class="va">fl.recurrence</span>,</span>
<span>                              <span class="st">"fl.remission"</span><span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>                 </span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"recurrence"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="va">cost.recurrence</span> <span class="op">*</span> <span class="va">fl.recurrence</span>,</span>
<span>                              <span class="st">"fl.recurrence"</span><span class="op">=</span><span class="fl">1</span>,</span>
<span>                              <span class="st">"fl.remission"</span><span class="op">=</span><span class="fl">0</span>,</span>
<span>                              <span class="st">"fl.mbcs"</span><span class="op">=</span><span class="fl">1</span>,</span>
<span>                              <span class="st">"fl.mbcs.progression.mbc"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co">#ad-hoc for plot</span></span>
<span>                 </span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"start.early.mbc"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="va">cost.recurrence</span> <span class="op">*</span> <span class="va">fl.recurrence</span>,</span>
<span>                              <span class="st">"fl.mbcs"</span><span class="op">=</span><span class="fl">1</span>,</span>
<span>                              <span class="st">"fl.mbcs.progression.mbc"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>                 </span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"2ndline_mbc"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="va">cost.mbc.tx</span>  <span class="op">*</span> <span class="va">fl.mbcs.ontx</span> <span class="op">+</span> <span class="va">cost.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="va">cost.mbc.pps</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span> <span class="op">+</span> <span class="va">cost.2ndline</span><span class="op">*</span><span class="va">fl.mbcs_2ndline</span>,</span>
<span>                              <span class="st">"fl.mbcs_2ndline"</span><span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>                 </span>
<span>                 <span class="va">n_ae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">1</span>,lambda<span class="op">=</span><span class="fl">0.25</span><span class="op">*</span><span class="op">(</span><span class="va">curtime</span> <span class="op">-</span><span class="va">prevtime</span><span class="op">)</span><span class="op">)</span> <span class="co">#1 AE every 4 years</span></span>
<span>                 </span>
<span>                 <span class="kw">if</span> <span class="op">(</span><span class="va">n_ae</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                   <span class="fu"><a href="../reference/new_event.html">new_event</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"ae"</span> <span class="op">=</span> <span class="va">curtime</span> <span class="op">+</span> <span class="fl">0.0001</span><span class="op">)</span>,<span class="va">n_ae</span><span class="op">)</span><span class="op">)</span></span>
<span>                 <span class="op">}</span></span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"ae"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 </span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="va">cost.mbc.tx</span>  <span class="op">*</span> <span class="va">fl.mbcs.ontx</span> <span class="op">+</span> <span class="va">cost.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="va">cost.mbc.pps</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span> <span class="op">+</span> <span class="va">cost.2ndline</span><span class="op">*</span><span class="va">fl.mbcs_2ndline</span>,</span>
<span>                              c_ae <span class="op">=</span> <span class="va">cost.ae</span><span class="op">)</span><span class="op">)</span></span>
<span>                 </span>
<span>                 <span class="fu"><a href="../reference/modify_event.html">modify_event</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                              <span class="st">"os"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">cur_evtlist</span><span class="op">[[</span><span class="st">"os"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fl">0.125</span>,<span class="va">curtime</span> <span class="op">+</span><span class="fl">0.0001</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span><span class="co">#each AE brings forward death by 1.5 months</span></span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"os"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>q_default <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> </span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span></span>
<span>                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span></span>
<span>                              <span class="op">}</span>,</span>
<span>                              c_default <span class="op">=</span> <span class="va">cost.mbc.tx</span>  <span class="op">*</span> <span class="va">fl.mbcs.ontx</span> <span class="op">+</span> <span class="va">cost.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="va">cost.mbc.pps</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span> <span class="op">+</span> <span class="va">cost.2ndline</span><span class="op">*</span><span class="va">fl.mbcs_2ndline</span>,</span>
<span>                              <span class="st">"fl.tx.beva"</span><span class="op">=</span><span class="fl">0</span>,</span>
<span>                              <span class="st">"fl.mbcs.ontx"</span><span class="op">=</span><span class="fl">0</span>,</span>
<span>                              <span class="st">"fl.idfs"</span><span class="op">=</span><span class="fl">0</span>,</span>
<span>                              <span class="st">"fl.mbcs"</span><span class="op">=</span><span class="fl">0</span>,</span>
<span>                              <span class="st">"curtime"</span><span class="op">=</span><span class="cn">Inf</span><span class="op">)</span><span class="op">)</span> </span>
<span>               <span class="op">}</span><span class="op">)</span> </span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="costs-and-utilities">Costs and Utilities<a class="anchor" aria-label="anchor" href="#costs-and-utilities"></a>
</h2>
<p>Costs and utilities are introduced below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">util_ongoing</span> <span class="op">&lt;-</span> <span class="st">"q_default"</span></span>
<span></span>
<span><span class="va">cost_ongoing</span> <span class="op">&lt;-</span> <span class="st">"c_default"</span></span>
<span></span>
<span><span class="va">cost_instant</span> <span class="op">&lt;-</span>  <span class="st">"c_ae"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model">Model<a class="anchor" aria-label="anchor" href="#model"></a>
</h2>
<p>The model can now be executed as normal. Given that this modeling
exercise relies on sampling from distributions and simulating a finite
number of patients, there is some randomness involved that can affect
the results, even under the assumption that the parameters are fixed.
However, running more patients also means the simulation is slower, so
there is a trade-off between accuracy and speed. An important question
here is to understand how much of the uncertainty we observe when
running a PSA comes from the parametric uncertainty and how much comes
from the fact that we are simulating a finite sample.</p>
<div class="section level3">
<h3 id="structural-uncertainty">Structural Uncertainty<a class="anchor" aria-label="anchor" href="#structural-uncertainty"></a>
</h3>
<p>One way to test this is to run a few simulations for an increasing
number of patients simulated. For example, below we run 50 deterministic
simulations for 100, 1,000, 5,000 and 10,000 patients, to show how the
model outcome can change depending on the random seed used. Note that
this exercise can be very time consuming. Itâ€™s important to note that
the optimal number of patients simulated will depend on the dispersion
of the distributions, the patient pathway, the number of possible
outcomes and the difference among these. For example, an event with low
probability but high impact and variability implies a higher number of
patients simulated in order to obtain stable outcomes.</p>
<p>To do this test, we set <code>psa_bool = FALSE</code> and (optional)
we set <code>ipd = FALSE</code>. This last option means that we are not
exporting IPD data from all these simulations, but rather the aggregate
outcomes (and the last simulation, which is included by default). This
is important when simulating a large number of patients with a lot of
simulations, which can generate very large objects (&gt;1 GB). This
option can also be especially relevant when running a PSA, which would
require <code>psa_bool = TRUE</code> and a high number of
simulations.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sample_sizes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">100</span>,<span class="fl">500</span>,<span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_size_df</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">sample_size</span> <span class="kw">in</span> <span class="va">sample_sizes</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span> <span class="co">#run without warnings</span></span>
<span>      <span class="fu"><a href="../reference/run_sim_parallel.html">run_sim_parallel</a></span><span class="op">(</span>  </span>
<span>    npats<span class="op">=</span><span class="va">sample_size</span>,                        <span class="co"># number of patients to be simulated</span></span>
<span>    n_sim<span class="op">=</span><span class="fl">6</span>,                                <span class="co"># number of simulations to run</span></span>
<span>    psa_bool <span class="op">=</span> <span class="cn">FALSE</span>,                         <span class="co"># use PSA or not. If n_sim &gt; 1 and psa_bool = FALSE, then difference in outcomes is due to sampling (number of pats simulated)</span></span>
<span>    arm_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"noint"</span><span class="op">)</span>,             <span class="co"># intervention list</span></span>
<span>    common_all_inputs <span class="op">=</span> <span class="va">common_all_inputs</span>,    <span class="co"># inputs common that do not change within a simulation</span></span>
<span>    common_pt_inputs <span class="op">=</span> <span class="va">common_pt_inputs</span>,      <span class="co"># inputs that change within a simulation but are not affected by the intervention</span></span>
<span>    unique_pt_inputs <span class="op">=</span> <span class="va">unique_pt_inputs</span>,      <span class="co"># inputs that change within a simulation between interventions</span></span>
<span>    init_event_list <span class="op">=</span> <span class="va">init_event_list</span>,        <span class="co"># initial event list</span></span>
<span>    evt_react_list <span class="op">=</span> <span class="va">evt_react_list</span>,          <span class="co"># reaction of events</span></span>
<span>    util_ongoing_list <span class="op">=</span> <span class="va">util_ongoing</span>,</span>
<span>    cost_ongoing_list <span class="op">=</span> <span class="va">cost_ongoing</span>,</span>
<span>    cost_instant_list <span class="op">=</span> <span class="va">cost_instant</span>,</span>
<span>    ncores <span class="op">=</span> <span class="fl">6</span>, <span class="co"># number of cores to use, recommended not to use all</span></span>
<span>    ipd<span class="op">=</span><span class="cn">FALSE</span>                                 <span class="co"># Return IPD data through merged_df? Set to FALSE as it's not of interest here and it makes code slower</span></span>
<span>  <span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span>  <span class="co">#We're extracting the overall ICER/ICUR and also costs/qalys/lys for the "noint" intervention</span></span>
<span>  <span class="va">loop_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/extract_psa_result.html">extract_psa_result</a></span><span class="op">(</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="st">"total_costs"</span><span class="op">)</span>,</span>
<span>                   <span class="fu"><a href="../reference/extract_psa_result.html">extract_psa_result</a></span><span class="op">(</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="st">"total_lys"</span><span class="op">)</span>,</span>
<span>                   <span class="fu"><a href="../reference/extract_psa_result.html">extract_psa_result</a></span><span class="op">(</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="st">"total_qalys"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">loop_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">loop_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int"</span>,<span class="st">"noint"</span><span class="op">)</span>,names_to<span class="op">=</span><span class="st">"arm"</span><span class="op">)</span>,</span>
<span>                   <span class="va">loop_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dif <span class="op">=</span> <span class="va">int</span> <span class="op">-</span> <span class="va">noint</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">simulation</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">dif</span><span class="op">[</span><span class="va">element</span><span class="op">==</span><span class="st">"total_costs"</span><span class="op">]</span><span class="op">/</span><span class="va">dif</span><span class="op">[</span><span class="va">element</span><span class="op">==</span><span class="st">"total_qalys"</span><span class="op">]</span>,element <span class="op">=</span> <span class="st">"ICUR"</span>, arm<span class="op">=</span><span class="st">"noint"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">element</span>, <span class="va">arm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span></span>
<span>  <span class="va">loop_df</span><span class="op">$</span><span class="va">sample_size</span> <span class="op">&lt;-</span> <span class="va">sample_size</span></span>
<span>  <span class="va">sim_size_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">sim_size_df</span>,<span class="va">loop_df</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>We can then plot the results (in this case, the costs, lys and qalys
are for the â€œnointâ€ intervention)
<img src="example_uncertainty_files/figure-html/struct_uncertainty2-1.png" width="960"></p>
<p>We can also try to understand what is the relative size of the
uncertainty provided by the sampling. We compute the coefficient of
variation for the outcomes exported (costs, qalys, lys, ICER and ICUR).
The first thing to be noticed is that the ICER and ICUR CV is much
higher than for costs/lys/qalys. This is because of the incremental
nature of ICER/ICUR, which means itâ€™s more sensitive to small variations
of these outputs. So while the costs/qalys/lys are quite precise with a
reduced number of simulations (~1,000), in order to have a precise
ICER/ICUR we would need to go higher (~5,000/10,000). However, one could
see that the mean would be quite stable at ~5,000 patients.</p>
<table class="table table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
element
</th>
<th style="text-align:left;">
sample_size
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
CV (%)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
ICUR
</td>
<td style="text-align:left;">
50
</td>
<td style="text-align:right;">
135794.54
</td>
<td style="text-align:right;">
104475.47
</td>
<td style="text-align:right;">
76.94
</td>
</tr>
<tr>
<td style="text-align:left;">
ICUR
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:right;">
119107.25
</td>
<td style="text-align:right;">
46662.04
</td>
<td style="text-align:right;">
39.18
</td>
</tr>
<tr>
<td style="text-align:left;">
ICUR
</td>
<td style="text-align:left;">
500
</td>
<td style="text-align:right;">
99404.32
</td>
<td style="text-align:right;">
14334.98
</td>
<td style="text-align:right;">
14.42
</td>
</tr>
<tr>
<td style="text-align:left;">
ICUR
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:right;">
97884.08
</td>
<td style="text-align:right;">
10982.59
</td>
<td style="text-align:right;">
11.22
</td>
</tr>
<tr>
<td style="text-align:left;">
total_costs
</td>
<td style="text-align:left;">
50
</td>
<td style="text-align:right;">
268909.65
</td>
<td style="text-align:right;">
7897.76
</td>
<td style="text-align:right;">
2.94
</td>
</tr>
<tr>
<td style="text-align:left;">
total_costs
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:right;">
270478.48
</td>
<td style="text-align:right;">
7644.47
</td>
<td style="text-align:right;">
2.83
</td>
</tr>
<tr>
<td style="text-align:left;">
total_costs
</td>
<td style="text-align:left;">
500
</td>
<td style="text-align:right;">
271155.77
</td>
<td style="text-align:right;">
2397.17
</td>
<td style="text-align:right;">
0.88
</td>
</tr>
<tr>
<td style="text-align:left;">
total_costs
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:right;">
271579.34
</td>
<td style="text-align:right;">
1517.40
</td>
<td style="text-align:right;">
0.56
</td>
</tr>
<tr>
<td style="text-align:left;">
total_lys
</td>
<td style="text-align:left;">
50
</td>
<td style="text-align:right;">
12.16
</td>
<td style="text-align:right;">
0.43
</td>
<td style="text-align:right;">
3.51
</td>
</tr>
<tr>
<td style="text-align:left;">
total_lys
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:right;">
12.14
</td>
<td style="text-align:right;">
0.39
</td>
<td style="text-align:right;">
3.23
</td>
</tr>
<tr>
<td style="text-align:left;">
total_lys
</td>
<td style="text-align:left;">
500
</td>
<td style="text-align:right;">
12.23
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
0.59
</td>
</tr>
<tr>
<td style="text-align:left;">
total_lys
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:right;">
12.26
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
0.62
</td>
</tr>
<tr>
<td style="text-align:left;">
total_qalys
</td>
<td style="text-align:left;">
50
</td>
<td style="text-align:right;">
8.98
</td>
<td style="text-align:right;">
0.47
</td>
<td style="text-align:right;">
5.26
</td>
</tr>
<tr>
<td style="text-align:left;">
total_qalys
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:right;">
9.11
</td>
<td style="text-align:right;">
0.41
</td>
<td style="text-align:right;">
4.48
</td>
</tr>
<tr>
<td style="text-align:left;">
total_qalys
</td>
<td style="text-align:left;">
500
</td>
<td style="text-align:right;">
9.25
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
1.04
</td>
</tr>
<tr>
<td style="text-align:left;">
total_qalys
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:right;">
9.26
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
1.04
</td>
</tr>
</tbody>
</table>
<p>We can plot the CV to see this more clearly:
<img src="example_uncertainty_files/figure-html/struct_uncertainty4-1.png" width="960"></p>
</div>
<div class="section level3">
<h3 id="parameter-uncertainty">Parameter Uncertainty<a class="anchor" aria-label="anchor" href="#parameter-uncertainty"></a>
</h3>
<p>Structural uncertainty is not the only type of uncertainty that the
model can have. Parameters can also be changed across simulations by
using the <code>psa_bool = TRUE</code> option. Letâ€™s see what happens
when we compare the true PSA to the structural uncertainty with 1,000
patients.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sample_sizes</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="va">sim_size_psa_df</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">sample_size</span> <span class="kw">in</span> <span class="va">sample_sizes</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span> <span class="co">#run without warnings</span></span>
<span>      <span class="fu"><a href="../reference/run_sim_parallel.html">run_sim_parallel</a></span><span class="op">(</span>  </span>
<span>    npats<span class="op">=</span><span class="va">sample_size</span>,                        <span class="co"># number of patients to be simulated</span></span>
<span>    n_sim<span class="op">=</span><span class="fl">6</span>,                                <span class="co"># number of simulations to run</span></span>
<span>    psa_bool <span class="op">=</span> <span class="cn">TRUE</span>,                         <span class="co"># use PSA or not. If n_sim &gt; 1 and psa_bool = FALSE, then difference in outcomes is due to sampling (number of pats simulated)</span></span>
<span>    arm_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"noint"</span><span class="op">)</span>,             <span class="co"># intervention list</span></span>
<span>    common_all_inputs <span class="op">=</span> <span class="va">common_all_inputs</span>,    <span class="co"># inputs common that do not change within a simulation</span></span>
<span>    common_pt_inputs <span class="op">=</span> <span class="va">common_pt_inputs</span>,      <span class="co"># inputs that change within a simulation but are not affected by the intervention</span></span>
<span>    unique_pt_inputs <span class="op">=</span> <span class="va">unique_pt_inputs</span>,      <span class="co"># inputs that change within a simulation between interventions</span></span>
<span>    init_event_list <span class="op">=</span> <span class="va">init_event_list</span>,        <span class="co"># initial event list</span></span>
<span>    evt_react_list <span class="op">=</span> <span class="va">evt_react_list</span>,          <span class="co"># reaction of events</span></span>
<span>    util_ongoing_list <span class="op">=</span> <span class="va">util_ongoing</span>,</span>
<span>    cost_ongoing_list <span class="op">=</span> <span class="va">cost_ongoing</span>,</span>
<span>    cost_instant_list <span class="op">=</span> <span class="va">cost_instant</span>,</span>
<span>    ncores <span class="op">=</span> <span class="fl">6</span>, <span class="co"># number of cores to use, recommended not to use all</span></span>
<span>    ipd<span class="op">=</span><span class="cn">FALSE</span>                                 <span class="co"># Return IPD data through merged_df? Set to FALSE as it's not of interest here and it makes code slower</span></span>
<span>  <span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span>  <span class="co">#We're extracting the overall ICER/ICUR and also costs/qalys/lys for the "noint" intervention</span></span>
<span>  <span class="va">loop_psa_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/extract_psa_result.html">extract_psa_result</a></span><span class="op">(</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="st">"total_costs"</span><span class="op">)</span>,</span>
<span>                   <span class="fu"><a href="../reference/extract_psa_result.html">extract_psa_result</a></span><span class="op">(</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="st">"total_lys"</span><span class="op">)</span>,</span>
<span>                   <span class="fu"><a href="../reference/extract_psa_result.html">extract_psa_result</a></span><span class="op">(</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="st">"total_qalys"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">loop_psa_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">loop_psa_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int"</span>,<span class="st">"noint"</span><span class="op">)</span>,names_to<span class="op">=</span><span class="st">"arm"</span><span class="op">)</span>,</span>
<span>                   <span class="va">loop_psa_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dif <span class="op">=</span> <span class="va">int</span> <span class="op">-</span> <span class="va">noint</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">simulation</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">dif</span><span class="op">[</span><span class="va">element</span><span class="op">==</span><span class="st">"total_costs"</span><span class="op">]</span><span class="op">/</span><span class="va">dif</span><span class="op">[</span><span class="va">element</span><span class="op">==</span><span class="st">"total_qalys"</span><span class="op">]</span>,element <span class="op">=</span> <span class="st">"ICUR"</span>, arm<span class="op">=</span><span class="st">"noint"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">element</span>, <span class="va">arm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">loop_psa_df</span><span class="op">$</span><span class="va">sample_size</span>  <span class="op">&lt;-</span>  <span class="va">sample_size</span></span>
<span>  <span class="va">sim_size_psa_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">sim_size_psa_df</span>,<span class="va">loop_psa_df</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now the uncertainty is much bigger when compared to the same case
with 1,000 iterations and no parameter uncertainty.</p>
<table class="table table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
element
</th>
<th style="text-align:left;">
sample_size
</th>
<th style="text-align:left;">
uncertainty
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
CV (%)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
ICUR
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
structural
</td>
<td style="text-align:right;">
97884.08
</td>
<td style="text-align:right;">
10982.59
</td>
<td style="text-align:right;">
11.22
</td>
</tr>
<tr>
<td style="text-align:left;">
ICUR
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
structural + parameter
</td>
<td style="text-align:right;">
114547.14
</td>
<td style="text-align:right;">
31492.38
</td>
<td style="text-align:right;">
27.49
</td>
</tr>
<tr>
<td style="text-align:left;">
total_costs
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
structural
</td>
<td style="text-align:right;">
271579.34
</td>
<td style="text-align:right;">
1517.40
</td>
<td style="text-align:right;">
0.56
</td>
</tr>
<tr>
<td style="text-align:left;">
total_costs
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
structural + parameter
</td>
<td style="text-align:right;">
240153.94
</td>
<td style="text-align:right;">
24739.90
</td>
<td style="text-align:right;">
10.30
</td>
</tr>
<tr>
<td style="text-align:left;">
total_lys
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
structural
</td>
<td style="text-align:right;">
12.26
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
0.62
</td>
</tr>
<tr>
<td style="text-align:left;">
total_lys
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
structural + parameter
</td>
<td style="text-align:right;">
12.00
</td>
<td style="text-align:right;">
0.32
</td>
<td style="text-align:right;">
2.67
</td>
</tr>
<tr>
<td style="text-align:left;">
total_qalys
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
structural
</td>
<td style="text-align:right;">
9.26
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
1.04
</td>
</tr>
<tr>
<td style="text-align:left;">
total_qalys
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
structural + parameter
</td>
<td style="text-align:right;">
9.05
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
3.76
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="ceacceaf-and-evpi">CEAC/CEAF and EVPI<a class="anchor" aria-label="anchor" href="#ceacceaf-and-evpi"></a>
</h2>
<p>When a PSA is run, additional analyses can be performed to understand
the importance and behavior of uncertainty.</p>
<div class="section level3">
<h3 id="ceacceaf">CEAC/CEAF<a class="anchor" aria-label="anchor" href="#ceacceaf"></a>
</h3>
<p>We can now use the <code>ceac_des</code> function with a vector of
willingness to pay and the results of our PSA to generate the CEAC and
CEAF plots.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">wtp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">0</span>,to<span class="op">=</span><span class="fl">150000</span>,by<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">ceac_out</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/ceac_des.html">ceac_des</a></span><span class="op">(</span><span class="va">wtp</span>,<span class="va">results</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ceac_out</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">wtp</span>,y<span class="op">=</span><span class="va">prob_best</span>,group<span class="op">=</span><span class="va">comparator</span>,col<span class="op">=</span><span class="va">comparator</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Willingness to Pay"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Probability of being cost-effective"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Cost Effectiveness Acceptability Curve (CEAC)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_uncertainty_files/figure-html/ceac_ceaf-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ceac_out</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">wtp</span>,y<span class="op">=</span><span class="va">prob_best</span>,group<span class="op">=</span><span class="va">comparator</span>,col<span class="op">=</span><span class="va">comparator</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Willingness to Pay"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Probability of being cost-effective"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Cost Effectiveness Acceptability Frontier (CEAF)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_uncertainty_files/figure-html/ceac_ceaf-2.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="evpi">EVPI<a class="anchor" aria-label="anchor" href="#evpi"></a>
</h3>
<p>Similarly to <code>ceac_des</code>, the function
<code>evpi_des</code> also allows to compute the EVPI.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">evpi_out</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/evpi_des.html">evpi_des</a></span><span class="op">(</span><span class="va">wtp</span>,<span class="va">results</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">evpi_out</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">wtp</span>,y<span class="op">=</span><span class="va">evpi</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Willingness to Pay"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"EVPI"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Expected Value of Perfect Information (EVPI)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_uncertainty_files/figure-html/evpi-1.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Javier Sanchez Alvarez.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
